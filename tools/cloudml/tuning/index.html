<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>Hyperparameter Tuning</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/tools/cloudml/tuning/><meta name=author content="J.J. Allaire"><meta property=og:url content=/tools/cloudml/tuning/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/cloudml class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=search-button><i class="fa fa-lg fa-search"></i></div></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/cloudml class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training with Keras</a></li></ul></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li><li><a href=/guide/keras/mixed_precision/>Mixed Precision Training</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href=/guide/tfhub/examples/>Examples</a></li><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/cloudml/>Cloud ML</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/cloudml/getting_started/>Getting Started</a></li><li><a href=/tools/cloudml/training/>Training with CloudML</a></li><li><a href=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/cloudml/storage/>Google Cloud Storage</a></li><li><a href=/tools/cloudml/deployment/>Deploying Models</a></li></ul><li><a href=/tools/tensorboard/>Tensorboard</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tensorboard/tensorboard/>Getting started</a></li><li><a href=/tools/tensorboard/hparams/>HParams Dashboard</a></li></ul></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/cloudml/>cloudml</a></li><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a></li><li class=side-menu__item><a href=/guide/tfhub/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class=side-menu__item><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class="side-menu__item active"><a href=/tools/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Cloud ML</p></a><ul class=side-menu__sub><span style=display:none>tools</span><li class=side-menu__sub__item><a id=menu-link-/tools/cloudml/getting_started/ class=side-menu__sub__item__text href=/tools/cloudml/getting_started/ data-url=/tools/cloudml/getting_started/>Getting Started</a></li><span style=display:none>tools</span><li class=side-menu__sub__item><a id=menu-link-/tools/cloudml/training/ class=side-menu__sub__item__text href=/tools/cloudml/training/ data-url=/tools/cloudml/training/>Training with CloudML</a></li><span style=display:none>tools</span><li class="side-menu__sub__item active"><a id=menu-link-/tools/cloudml/tuning/ class=side-menu__sub__item__text href=/tools/cloudml/tuning/ data-url=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><span style=display:none>tools</span><li class=side-menu__sub__item><a id=menu-link-/tools/cloudml/storage/ class=side-menu__sub__item__text href=/tools/cloudml/storage/ data-url=/tools/cloudml/storage/>Google Cloud Storage</a></li><span style=display:none>tools</span><li class=side-menu__sub__item><a id=menu-link-/tools/cloudml/deployment/ class=side-menu__sub__item__text href=/tools/cloudml/deployment/ data-url=/tools/cloudml/deployment/>Deploying Models</a></li></ul></li><li class=side-menu__item><a href=/tools/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Tensorboard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>cloudml</p></a></li><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>Hyperparameter Tuning</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><div id=overview class="section level2"><h2>Overview</h2><p>This article describes hyperparameter tuning, which is the automated model enhancer provided by Cloud Machine Learning Engine. Hyperparameter tuning takes advantage of the processing infrastructure of Google Cloud Platform to test different hyperparameter configurations when training your model. It can give you optimized values for hyperparameters, which maximizes your model’s predictive accuracy.</p></div><div id=whats-a-hyperparameter class="section level2"><h2>What’s a hyperparameter?</h2><p>If you’re new to machine learning, you may have never encountered the term <em>hyperparameters</em> before. Your trainer handles three categories of data as it trains your model:</p><ul><li><p>Your input data (also called training data) is a collection of individual records (instances) containing the features important to your machine learning problem. This data is used during training to configure your model to accurately make predictions about new instances of similar data. However, the actual values in your input data never directly become part of your model.</p></li><li><p>Your model’s parameters are the variables that your chosen machine learning technique uses to adjust to your data. For example, a deep neural network (DNN) is composed of processing nodes (neurons), each with an operation performed on data as it travels through the network. When your DNN is trained, each node has a weight value that tells your model how much impact it has on the final prediction. Those weights are an example of your model’s parameters. In many ways, your model’s parameters are the model—they are what distinguishes your particular model from other models of the same type working on similar data.</p></li><li><p>If model parameters are variables that get adjusted by training with existing data, your hyperparameters are the variables about the training process itself. For example, part of setting up a deep neural network is deciding how many “hidden” layers of nodes to use between the input layer and the output layer, as well as how many nodes each layer should use. These variables are not directly related to the training data at all. They are configuration variables. Another difference is that parameters change during a training job, while the hyperparameters are usually constant during a job.</p></li></ul><p>Your model parameters are optimized (you could say “tuned”) by the training process: you run data through the operations of the model, compare the resulting prediction with the actual value for each data instance, evaluate the accuracy, and adjust until you find the best values. Hyperparameters are similarly tuned by running your whole training job, looking at the aggregate accuracy, and adjusting. In both cases you are modifying the composition of your model in an effort to find the best combination to handle your problem.</p><p>Without an automated technology like Cloud ML Engine hyperparameter tuning, you need to make manual adjustments to the hyperparameters over the course of many training runs to arrive at the optimal values. Hyperparameter tuning makes the process of determining the best hyperparameter settings easier and less tedious.</p></div><div id=how-it-works class="section level2"><h2>How it works</h2><p>Hyperparameter tuning works by running multiple <em>trials</em> in a single training job. Each trial is a complete execution of your training application with values for your chosen hyperparameters set within limits you specify. The Cloud ML Engine training service keeps track of the results of each trial and makes adjustments for subsequent trials. When the job is finished, you can get a summary of all the trials along with the most effective configuration of values according to the criteria you specify.</p><p>Hyperparameter tuning requires more explicit communication between the Cloud ML Engine training service and your training application. You define all the information that your model needs in your training application. The best way to think about this interaction is that you define the hyperparameters (variables) that you want to adjust and you define a target value.</p><p>To learn more about how Bayesian optimization is used for hyperparameter tuning in Cloud ML Engine, read the August 2017 Google Cloud Big Data and Machine Learning Blog post named <a href=https://cloud.google.com/blog/big-data/2017/08/hyperparameter-tuning-in-cloud-machine-learning-engine-using-bayesian-optimization>Hyperparameter Tuning in Cloud Machine Learning Engine using Bayesian Optimization</a>.</p></div><div id=what-it-optimizes class="section level2"><h2>What it optimizes</h2><p>Hyperparameter tuning optimizes a single target variable (also called the hyperparameter metric) that you specify. The accuracy of the model, as calculated from an evaluation pass, is a common metric. The metric must be a numeric value, and you can specify whether you want to tune your model to maximize or minimize your metric.</p><p>When you start a job with hyperparameter tuning, you establish the name of your hyperparameter metric. The appropriate name will depend on whether you are using <a href=https://tensorflow.rstudio.com/keras/>keras</a>, <a href=https://tensorflow.rstudio.com/keras/>tfestimators</a>, or the <a href=https://tensorflow.rstudio.com/tensorflow/>core</a> TensorFlow API. This will be covered below in the section on [Hyperparameter tuning configuration].</p><div id=how-cloud-ml-engine-gets-your-metric class="section level3"><h3>How Cloud ML Engine gets your metric</h3><p>You may notice that there are no instructions in this documentation for passing your hyperparameter metric to the Cloud ML Engine training service. That’s because the service automatically monitors TensorFlow summary events generated by your trainer and retrieves the metric.</p></div><div id=the-flow-of-hyperparameter-values class="section level3"><h3>The flow of hyperparameter values</h3><p>Without hyperparameter tuning, you can set your hyperparameters by whatever means you like in your trainer. You might configure them according to command-line arguments to your main application module, or feed them to your application in a configuration file, for example. When you use hyperparameter tuning, you must set the values of the hyperparameters that you’re using for tuning with a specific procedure:</p><ul><li><p>Define a <a href=https://tensorflow.rstudio.com/tools/training_flags.html>training flag</a> within your training script for each tuned hyperparameter.</p></li><li><p>Use the value passed for those arguments to set the corresponding hyperparameter in your training code.</p></li></ul><p>When you configure a training job with hyperparameter tuning, you define each hyperparameter to tune, its type, and the range of values to try. You identify each hyperparameter using exactly the same name as the corresponding argument you defined in your main module. The training service includes command-line arguments using these names when it runs your trainer, which are in turn propagated to the <code>FLAGS</code> within your script.</p></div></div><div id=selecting-hyperparameters class="section level2"><h2>Selecting hyperparameters</h2><p>There is very little universal advice to give about how to choose which hyperparameters you should tune. If you have experience with the machine learning technique that you’re using, you may have insight into how its hyperparameters behave. You may also be able to find advice from machine learning communities.</p><p>However you choose them, it’s important to understand the implications. Every hyperparameter that you choose to tune has the potential to exponentially increase the number of trials required for a successful tuning job. When you train on Cloud ML Engine you are charged for the duration of the job, so careless assignment of hyperparameters to tune can greatly increase the cost of training your model.</p></div><div id=preparing-your-script class="section level2"><h2>Preparing your script</h2><p>To prepare your training script for tuning, you should define a <a href=https://tensorflow.rstudio.com/tools/training_flags.html>training flag</a> within your script for each tuned hyperparameter. For example:</p><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb1-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(keras)</a>
<a class=sourceLine id=cb1-2 data-line-number=2></a>
<a class=sourceLine id=cb1-3 data-line-number=3>FLAGS &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/reexports.html>flags</a></span>(</a>
<a class=sourceLine id=cb1-4 data-line-number=4>  <span class=kw><a href=../../keras/reference/reexports.html>flag_integer</a></span>(<span class=st>"dense_units1"</span>, <span class=dv>128</span>),</a>
<a class=sourceLine id=cb1-5 data-line-number=5>  <span class=kw><a href=../../keras/reference/reexports.html>flag_numeric</a></span>(<span class=st>"dropout1"</span>, <span class=fl>0.4</span>),</a>
<a class=sourceLine id=cb1-6 data-line-number=6>  <span class=kw><a href=../../keras/reference/reexports.html>flag_integer</a></span>(<span class=st>"dense_units2"</span>, <span class=dv>128</span>),</a>
<a class=sourceLine id=cb1-7 data-line-number=7>  <span class=kw><a href=../../keras/reference/reexports.html>flag_numeric</a></span>(<span class=st>"dropout2"</span>, <span class=fl>0.3</span>)</a>
<a class=sourceLine id=cb1-8 data-line-number=8>)</a></code></pre></div><p>These flags would then used within a script as follows:</p><div class=sourceCode id=cb2><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb2-1 data-line-number=1>model &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/keras_model_sequential.html>keras_model_sequential</a></span>() <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb2-2 data-line-number=2><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> FLAGS<span class=op>$</span>dense_units1, <span class=dt>activation =</span> <span class=st>'relu'</span>, </a>
<a class=sourceLine id=cb2-3 data-line-number=3>              <span class=dt>input_shape =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>784</span>)) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb2-4 data-line-number=4><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dropout.html>layer_dropout</a></span>(<span class=dt>rate =</span> FLAGS<span class=op>$</span>dropout1) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb2-5 data-line-number=5><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> FLAGS<span class=op>$</span>dense_units2, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb2-6 data-line-number=6><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dropout.html>layer_dropout</a></span>(<span class=dt>rate =</span> FLAGS<span class=op>$</span>dropout2) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb2-7 data-line-number=7><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> <span class=dv>10</span>, <span class=dt>activation =</span> <span class=st>'softmax'</span>)</a></code></pre></div><p>Note that instead of literal values for the various parameters we want to vary we now reference members of the <code>FLAGS</code> list returned from the <code><a href=../../keras/reference/reexports.html>flags()</a></code> function.</p></div><div id=tuning-configuration class="section level2"><h2>Tuning configuration</h2><p>Before you submit you training script you need to create a configuration file that determines both the name of the metric to optimize as well as the training flags and corresponding values to use for optimization. The exact semantics of specifying a metric differ depending on what interface you are using, here we’ll use a Keras example (see the section on <a href=#optimization-metrics>Optimization metrics</a> for details on other interfaces).</p><p>With Keras, any named metric (as defined by the <code>metrics</code> argument passed to the <code><a href=../../keras/reference/reexports.html>compile()</a></code> function) can be used as the target for optimization. For example, if this was the call to <code><a href=../../keras/reference/reexports.html>compile()</a></code>:</p><div class=sourceCode id=cb3><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb3-1 data-line-number=1>model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../keras/reference/reexports.html>compile</a></span>(</a>
<a class=sourceLine id=cb3-2 data-line-number=2>  <span class=dt>loss =</span> <span class=st>'categorical_crossentropy'</span>,</a>
<a class=sourceLine id=cb3-3 data-line-number=3>  <span class=dt>optimizer =</span> <span class=kw><a href=../../keras/reference/optimizer_rmsprop.html>optimizer_rmsprop</a></span>(),</a>
<a class=sourceLine id=cb3-4 data-line-number=4>  <span class=dt>metrics =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>'accuracy'</span>)</a>
<a class=sourceLine id=cb3-5 data-line-number=5>)</a></code></pre></div><p>Then you could use the following as your CloudML training configuration file for a scenario where you wanted to explore the impact of different dropout ratios:</p><p><strong>tuning.yml</strong></p><div class=sourceCode id=cb4><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class=sourceLine id=cb4-1 data-line-number=1><span class=fu>trainingInput:</span></a>
<a class=sourceLine id=cb4-2 data-line-number=2>  <span class=fu>scaleTier:</span><span class=at> CUSTOM</span></a>
<a class=sourceLine id=cb4-3 data-line-number=3>  <span class=fu>masterType:</span><span class=at> standard_gpu</span></a>
<a class=sourceLine id=cb4-4 data-line-number=4>  <span class=fu>hyperparameters:</span></a>
<a class=sourceLine id=cb4-5 data-line-number=5>    <span class=fu>goal:</span><span class=at> MAXIMIZE</span></a>
<a class=sourceLine id=cb4-6 data-line-number=6>    <span class=fu>hyperparameterMetricTag:</span><span class=at> acc</span></a>
<a class=sourceLine id=cb4-7 data-line-number=7>    <span class=fu>maxTrials:</span><span class=at> 10</span></a>
<a class=sourceLine id=cb4-8 data-line-number=8>    <span class=fu>maxParallelTrials:</span><span class=at> 2</span></a>
<a class=sourceLine id=cb4-9 data-line-number=9>    <span class=fu>params:</span></a>
<a class=sourceLine id=cb4-10 data-line-number=10>      <span class=kw><a href=https://rdrr.io/r/base/Arithmetic.html>-</a></span> <span class=fu>parameterName:</span><span class=at> dropout1</span></a>
<a class=sourceLine id=cb4-11 data-line-number=11>        <span class=fu>type:</span><span class=at> DOUBLE</span></a>
<a class=sourceLine id=cb4-12 data-line-number=12>        <span class=fu>minValue:</span><span class=at> 0.2</span></a>
<a class=sourceLine id=cb4-13 data-line-number=13>        <span class=fu>maxValue:</span><span class=at> 0.6</span></a>
<a class=sourceLine id=cb4-14 data-line-number=14>        <span class=fu>scaleType:</span><span class=at> UNIT_LINEAR_SCALE</span></a>
<a class=sourceLine id=cb4-15 data-line-number=15>      <span class=kw><a href=https://rdrr.io/r/base/Arithmetic.html>-</a></span> <span class=fu>parameterName:</span><span class=at> dropout2</span></a>
<a class=sourceLine id=cb4-16 data-line-number=16>        <span class=fu>type:</span><span class=at> DOUBLE</span></a>
<a class=sourceLine id=cb4-17 data-line-number=17>        <span class=fu>minValue:</span><span class=at> 0.1</span></a>
<a class=sourceLine id=cb4-18 data-line-number=18>        <span class=fu>maxValue:</span><span class=at> 0.5</span></a>
<a class=sourceLine id=cb4-19 data-line-number=19>        <span class=fu>scaleType:</span><span class=at> UNIT_LINEAR_SCALE</span></a></code></pre></div><p>We specified <code>hyperparameterMetricTag: acc</code> as the metric to optimize for. Note that whenever attempting to optimize accuracy with Keras specify <code>acc</code> rather than <code>accuracy</code> as that is the standard abbreviation used by Keras for this metric.</p><p>The <code>type</code> field can be one of:</p><ul><li><code>INTEGER</code></li><li><code>DOUBLE</code></li><li><code>CATEGORICAL</code></li><li><code>DISCRETE</code></li></ul><p>The <code>scaleType</code> field for numerical types can be one of:</p><ul><li><code>UNIT_LINEAR_SCALE</code></li><li><code>UNIT_LOG_SCALE</code></li><li><code>UNIT_REVERSE_LOG_SCALE</code></li></ul><p>If you are using <code>CATEGORICAL</code> or <code>DISCRETE</code> types you will need to pass the possible values to <code>categoricalValues</code> or <code>discreteValues</code> parameter. For example, you could have an hyperparameter defined like this:</p><pre><code>- parameterName: activation
  type: CATEGORICAL
  categoricalValues: [relu, tanh, sigmoid]</code></pre><p>Note also that configuration for the compute resources to use for the job can also be provided in the config file (e.g. the <code>masterType</code> field).</p><p>Complete details on available options can be found in the <a href=https://cloud.google.com/ml-engine/reference/rest/v1/projects.jobs#HyperparameterSpec>HyperparameterSpec</a> documentation.</p></div><div id=submitting-a-tuning-job class="section level2"><h2>Submitting a tuning job</h2><p>To submit a hyperparmaeter tuning job, pass the name of the CloudML configuration file containing your hyperparmeters to <code>cloudml_train()</code>:</p><div class=sourceCode id=cb6><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb6-1 data-line-number=1><span class=kw>cloudml_train</span>(<span class=st>"mnist_mlp.R"</span>, <span class=dt>config =</span> <span class=st>"tuning.yml"</span>)</a></code></pre></div><p>The job will proceed as normal, and you can monitor it’s results within an RStudio terminal or via the <code>job_status()</code> and <code>job_stream_logs()</code> functions.</p></div><div id=collecting-trials class="section level2"><h2>Collecting trials</h2><p>Once the job is completed you can inspect all of the job trails using the <code>job_trials()</code> function. For example:</p><div class=sourceCode id=cb7><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb7-1 data-line-number=1><span class=kw>job_trials</span>(<span class=st>"cloudml_2018_01_08_142717956"</span>)</a></code></pre></div><pre><code>finalMetric.objectiveValue finalMetric.trainingStep hyperparameters.dropout1 hyperparameters.dropout2 trialId
1                    0.973854                       19       0.2011326172916916      0.32774705750441724      10
2                    0.973458                       19      0.20090378506439671      0.10079321757280404       3
3                    0.973354                       19       0.5476299090261757      0.49998941144858033       6
4                    0.972875                       19        0.597820322273044       0.4074512354566201       7
5                    0.972729                       19      0.25969787952729828      0.42851076497180118       1
6                    0.972417                       19      0.20045494784980847      0.15927383711937335       4
7                    0.972188                       19      0.33367593781223304      0.10077055587860367       5
8                    0.972188                       19      0.59880072314674071      0.10476853415572558       9
9                    0.972021                       19         0.40078175292512      0.49982245025905447       8
10                   0.971792                       19      0.46984175786143262      0.25901078861553267       2</code></pre><p>You can collect jobs executed as part of a hyperparameter tunning run using the ’job_collect()` function:</p><div class=sourceCode id=cb9><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb9-1 data-line-number=1><span class=kw>job_collect</span>(<span class=st>"cloudml_2018_01_08_142717956"</span>)</a></code></pre></div><p>By default this will only collect the job trial with the best metric (<code>trials = "best"</code>). You can pass <code>trials = "all"</code> to download all trials. For example:</p><div class=sourceCode id=cb10><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb10-1 data-line-number=1><span class=kw>job_collect</span>(<span class=st>"cloudml_2018_01_08_142717956"</span>, <span class=dt>trials =</span> <span class=st>"all"</span>)</a></code></pre></div><p>You can also pass vector of trial IDs to download specific trials. For example, this code would download the top 5 performing trials:</p><div class=sourceCode id=cb11><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb11-1 data-line-number=1>trials &lt;-<span class=st> </span><span class=kw>job_trials</span>(<span class=st>"cloudml_2018_01_08_142717956"</span>)</a>
<a class=sourceLine id=cb11-2 data-line-number=2><span class=kw>job_collect</span>(<span class=st>"cloudml_2018_01_08_142717956"</span>, <span class=dt>trials =</span> trials<span class=op>$</span>trialId[<span class=dv>1</span><span class=op>:</span><span class=dv>5</span>])</a></code></pre></div></div><div id=optimization-metrics class="section level2"><h2>Optimization metrics</h2><p>The <code>hyperparameterMetricTag</code> is the TensorFlow summary tag name used for optimizing trials. For current versions of TensorFlow, this tag name should exactly match what is shown in TensorBoard, including all scopes.</p><p>You can open Tensorboard by running <code><a href=../../keras/reference/reexports.html>tensorboard()</a></code> over a completed run and inspecting the available metrics.</p><p>Tags vary across models but some common ones follow:</p><table><thead><tr class=header><th>package</th><th>tag</th></tr></thead><tbody><tr class=odd><td>keras</td><td>acc</td></tr><tr class=even><td>keras</td><td>loss</td></tr><tr class=odd><td>keras</td><td>val_acc</td></tr><tr class=even><td>keras</td><td>val_loss</td></tr><tr class=odd><td>tfestimators</td><td>average_loss</td></tr><tr class=even><td>tfestimators</td><td>global_step</td></tr><tr class=odd><td>tfestimators</td><td>loss</td></tr></tbody></table><p>When using the Core TensorFlow API summary tags can be added explicitly as follows:</p><div class=sourceCode id=cb12><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb12-1 data-line-number=1>summary &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/groupGeneric.html>Summary</a></span>()</a>
<a class=sourceLine id=cb12-2 data-line-number=2>summary<span class=op>$</span>value<span class=op>$</span><span class=kw>add</span>(<span class=dt>tag =</span> <span class=st>"accuracy"</span>, <span class=dt>simple_value =</span> accuracy)</a>
<a class=sourceLine id=cb12-3 data-line-number=3>summary_writer<span class=op>$</span><span class=kw>add_summary</span>(summary, iteration_number)</a></code></pre></div><p>You can see examples training scripts and corresponding <code>tuning.yml</code> files for the various TensorFlow APIs here:</p><ul><li><p><a href=https://github.com/rstudio/cloudml/tree/master/inst/examples/keras>keras</a></p></li><li><p><a href=https://github.com/rstudio/cloudml/tree/master/inst/examples/tfestimators>tfestimators</a></p></li><li><p><a href=https://github.com/rstudio/cloudml/tree/master/inst/examples/mnist>tensorflow</a></p></li></ul></div></div></div></div><footer>Copyright © 2015-2019 The TensorFlow Authors and RStudio, Inc.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>