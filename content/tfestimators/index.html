---
title: "R Interface to TensorFlow Estimators"
output: html_document
type: docs
repo: https://github.com/rstudio/tfestimators
menu:
  main:
    name: "Overview"
    identifier: "tfestimators-overview"
    parent: "tfestimators-using-tfestimators"
    weight: 10
---



<div id="r-interface-to-tensorflow-estimators" class="section level1">
<h1>R Interface to TensorFlow Estimators</h1>
<div id="build-status">
<p><a href="https://travis-ci.org/rstudio/tfestimators.svg"><img src="https://travis-ci.org/rstudio/tfestimators.svg?branch=master" alt="Travis-CI Build Status"></a></p>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p><img src="articles/images/tensorflow-architecture.png" align="right" width="50%" style="margin-left: 15px;"></p>
<p>The <strong>tfestimators</strong> package is an R interface to TensorFlow Estimators, a high-level API that provides:</p>
<ul>
<li><p>Implementations of many different model types including linear models and deep neural networks. More models are coming soon such as state saving recurrent neural networks, dynamic recurrent neural networks, support vector machines, random forest, KMeans clustering, etc.</p></li>
<li><p>A flexible framework for defining arbitrary new model types as custom estimators.</p></li>
</ul>
<p><br></p>
<p>The following canned estimators are currently available:</p>
<table>
<thead><tr class="header">
<th>Estimator</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../tfestimators/reference/linear_estimators.html">linear_regressor()</a></code></td>
<td>Linear regressor model.</td>
</tr>
<tr class="even">
<td><code><a href="../tfestimators/reference/linear_estimators.html">linear_classifier()</a></code></td>
<td>Linear classifier model.</td>
</tr>
<tr class="odd">
<td><code><a href="../tfestimators/reference/dnn_estimators.html">dnn_regressor()</a></code></td>
<td>DNN Regression.</td>
</tr>
<tr class="even">
<td><code><a href="../tfestimators/reference/dnn_estimators.html">dnn_classifier()</a></code></td>
<td>DNN Classification.</td>
</tr>
<tr class="odd">
<td><code><a href="../tfestimators/reference/dnn_linear_combined_estimators.html">dnn_linear_combined_regressor()</a></code></td>
<td>DNN Linear Combined Regression.</td>
</tr>
<tr class="even">
<td><code><a href="../tfestimators/reference/dnn_linear_combined_estimators.html">dnn_linear_combined_classifier()</a></code></td>
<td>DNN Linear Combined Classification.</td>
</tr>
</tbody>
</table>
<p>For more details on the architecture and design of TensorFlow Estimators, please see the white paper: <a href="http://terrytangyuan.github.io/data/papers/tf-estimators-kdd-paper.pdf">TensorFlow Estimators: Managing Simplicity vs. Flexibility in High-Level Machine Learning Frameworks</a>.</p>
</div>
<div id="quick-start" class="section level2">
<h2>Quick Start</h2>
<div id="installation" class="section level3">
<h3>Installation</h3>
<p>To use <strong>tfestimators</strong>, you need to install both the R package as well as <a href="https://tensorflow.rstudio.com/">TensorFlow</a> itself.</p>
<p>First, install the tfestimators R package from CRAN as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"tfestimators"</span>)</code></pre>
<p>Then, use the <code><a href="../tfestimators/reference/reexports.html">install_tensorflow()</a></code> function to install TensorFlow:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install_tensorflow</span>()</code></pre>
<p>This will provide you with a default installation of TensorFlow suitable for getting started. See the <a href="https://tensorflow.rstudio.com/installation.html">article on installation</a> to learn about more advanced options, including installing a version of TensorFlow that takes advantage of NVIDIA GPUs if you have the correct CUDA libraries installed.</p>
</div>
<div id="simple-example" class="section level3">
<h3>Simple Example</h3>
<p>Let’s create a simple linear regression model with the <code>mtcars</code> dataset to demonstrate the use of estimators. We’ll illustrate how ‘input functions’ can be constructed and used to feed data to an estimator, how ‘feature columns’ can be used to specify a set of transformations to apply to input data, and how these pieces come together in the Estimator interface.</p>
<div id="input-function" class="section level4">
<h4>Input Function</h4>
<p>Estimators can accept data from arbitrary data sources through an ‘input function’. The input function selects feature and response columns from the input source as well as defines how data will be drawn (e.g. batch size, epochs, etc.). The <strong>tfestimators</strong> package provides the <code><a href="../tfestimators/reference/input_fn.html">input_fn()</a></code> helper function for generating input functions from common R data structures, e.g. R matrices and data frames.</p>
<p>Here, we define a helper function that will return an input function for a subset of our <code>mtcars</code> data set.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tfestimators)

<span class="co"># return an input_fn for a given subset of data</span>
mtcars_input_fn &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">num_epochs =</span> <span class="dv">1</span>) {
  <span class="kw"><a href="../tfestimators/reference/input_fn.html">input_fn</a></span>(data, 
           <span class="dt">features =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"disp"</span>, <span class="st">"cyl"</span>), 
           <span class="dt">response =</span> <span class="st">"mpg"</span>,
           <span class="dt">batch_size =</span> <span class="dv">32</span>,
           <span class="dt">num_epochs =</span> num_epochs)
}</code></pre>
</div>
<div id="feature-columns" class="section level4">
<h4>Feature Columns</h4>
<p>Next, we define the feature columns for our model. Feature columns are mappings of raw input data to the data that we’ll actually feed into our training, evaluation, and prediction steps. Here, we create a list of feature columns containing the <code>disp</code> and <code>cyl</code> variables:</p>
<pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/feature_columns.html">feature_columns</a></span>(
  <span class="kw"><a href="../tfestimators/reference/column_numeric.html">column_numeric</a></span>(<span class="st">"disp"</span>),
  <span class="kw"><a href="../tfestimators/reference/column_numeric.html">column_numeric</a></span>(<span class="st">"cyl"</span>)
)</code></pre>
<p>You can also define multiple feature columns at once:</p>
<pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/feature_columns.html">feature_columns</a></span>( 
  <span class="kw"><a href="../tfestimators/reference/column_numeric.html">column_numeric</a></span>(<span class="st">"disp"</span>, <span class="st">"cyl"</span>)
)</code></pre>
<p>By using the family of <a href="reference/index.html#section-feature-columns">feature column functions</a> we can define various transformations on the data before using it for modeling.</p>
</div>
<div id="estimator" class="section level4">
<h4>Estimator</h4>
<p>Next, we create the estimator by calling the <code><a href="../tfestimators/reference/linear_estimators.html">linear_regressor()</a></code> function and passing it a set of feature columns:</p>
<pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/linear_estimators.html">linear_regressor</a></span>(<span class="dt">feature_columns =</span> cols)</code></pre>
</div>
<div id="training" class="section level4">
<h4>Training</h4>
<p>We’re now ready to train our model, using the <code><a href="../tfestimators/reference/reexports.html">train()</a></code> function. We’ll partition the <code>mtcars</code> data set into separate training and validation data sets, and feed the training data set into <code><a href="../tfestimators/reference/reexports.html">train()</a></code>. We’ll hold 20% of the data aside for validation.</p>
<pre class="sourceCode r"><code class="sourceCode r">indices &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(mtcars), <span class="dt">size =</span> <span class="fl">0.80</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(mtcars))
train &lt;-<span class="st"> </span>mtcars[indices, ]
test  &lt;-<span class="st"> </span>mtcars[<span class="op">-</span>indices, ]

<span class="co"># train the model</span>
model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../tfestimators/reference/reexports.html">train</a></span>(<span class="kw">mtcars_input_fn</span>(train, <span class="dt">num_epochs =</span> <span class="dv">10</span>))</code></pre>
</div>
<div id="evaluation" class="section level4">
<h4>Evaluation</h4>
<p>We can evaluate the model’s accuracy using the <code><a href="../tfestimators/reference/reexports.html">evaluate()</a></code> function, using our ‘test’ data set for validation.</p>
<pre class="sourceCode r"><code class="sourceCode r">model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../tfestimators/reference/reexports.html">evaluate</a></span>(<span class="kw">mtcars_input_fn</span>(test))</code></pre>
</div>
<div id="prediction" class="section level4">
<h4>Prediction</h4>
<p>After we’ve finished training our model, we can use it to generate predictions from new data.</p>
<pre class="sourceCode r"><code class="sourceCode r">obs &lt;-<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]
model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="kw">mtcars_input_fn</span>(obs))</code></pre>
</div>
<div id="model-persistence" class="section level4">
<h4>Model Persistence</h4>
<p>Models created via <code>tfestimators</code> are persisted on disk. To obtain the location of where the model artifacts are stored, we can call <code><a href="../tfestimators/reference/model_dir.html">model_dir()</a></code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">saved_model_dir &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/model_dir.html">model_dir</a></span>(model)</code></pre>
<p>And subsequently load the saved model (in a new session) by passing the directory to the <code>model_dir</code> argument of the model constructor and use it for prediction or continue training:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tfestimators)
cols &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/feature_columns.html">feature_columns</a></span>( 
  <span class="kw"><a href="../tfestimators/reference/column_numeric.html">column_numeric</a></span>(<span class="st">"disp"</span>, <span class="st">"cyl"</span>)
)
loaded_model &lt;-<span class="st"> </span><span class="kw"><a href="../tfestimators/reference/linear_estimators.html">linear_regressor</a></span>(<span class="dt">feature_columns =</span> cols,
                                 <span class="dt">model_dir =</span> saved_model_dir)
loaded_model</code></pre>
</div>
</div>
</div>
<div id="learning-more" class="section level2">
<h2>Learning More</h2>
<p>These articles cover the basics of using TensorFlow Estimators:</p>
<ul>
<li><a href="articles/estimator_basics.html">Estimator Basics</a></li>
<li><a href="articles/input_functions.html">Input Functions</a></li>
<li><a href="articles/feature_columns.html">Feature Columns</a></li>
</ul>
<!--
These articles provide in depth documentation and example uses of canned estimators:

- [Linear Models](articles/linear_estimators.html)
- [Linear/DNN Models](articles/linear_dnn_combined_estimators.html)
- [Support Vector Machines](articles/support_vector_machines.html)
- [Recurrent Neural Networks](articles/recurrent_neural_networks.html)
--><p>These articles describe more advanced topics/usage:</p>
<ul>
<li>
<a href="articles/run_hooks.html">Run Hooks</a>
<!--
- [Run Configuration](articles/run_configuration.html)
- [Experiments](articles/experiments.html)
-->
</li>
<li><a href="articles/creating_estimators.html">Custom Estimators</a></li>
<li><a href="articles/layers.html">TensorFlow Layers</a></li>
<li><a href="articles/tensorboard.html">TensorBoard Visualization</a></li>
<li><a href="articles/parsing_spec.html">Parsing Utilities</a></li>
</ul>
<p>One of the best ways to learn is from reviewing and experimenting with examples. See the <a href="articles/examples/index.html">Examples</a> page for a variety of examples to help you get started.</p>
<!--
When you have built your model and are ready to deploy it, see the [Deployment](articles/deployment.html) page for an in-depth review of deployment options.
-->
</div>
</div>
