---
title: "Variables: Creation, Initialization, Saving, and Loading"
output: 
  html_document:
    toc: false
    toc_float: false
type: docs
menu:
  main:
    name: "Tensor Variables"
    identifier: "tensorflow-using-tensorflow-variables"
    parent: "tensorflow-using-tensorflow"
    weight: 30
aliases:
  - howto_variables.html
---



<p>When you train a model, you use <a href="https://www.tensorflow.org/api_docs/python/state_ops.html">variables</a>
to hold and update parameters. Variables are in-memory buffers containing
tensors. They must be explicitly initialized and can be saved to disk during
and after training. You can later restore saved values to exercise or analyze
the model.</p>
<p>This document references the following TensorFlow classes. Follow the links to
their reference manual for a complete description of their API:</p>
<ul>
<li>The <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Variable"><code>tf$Variable</code></a> class.</li>
<li>The <a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Saver"><code>tf$train$Saver</code></a> class.</li>
</ul>
<div id="creation" class="section level2">
<h2>Creation</h2>
<p>When you create a <a href="https://www.tensorflow.org/api_docs/python/state_ops.html">Variable</a> you pass a
<code>Tensor</code> as its initial value to the <code>Variable()</code> constructor. TensorFlow
provides a collection of ops that produce tensors often used for initialization
from <a href="https://www.tensorflow.org/api_docs/python/constant_op.html">constants or random values</a>.</p>
<p>Note that all these ops require you to specify the shape of the tensors. That
shape automatically becomes the shape of the variable. Variables generally
have a fixed shape, but TensorFlow provides advanced mechanisms to reshape
variables.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create two variables.</span>
weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">random_normal</span>(<span class="kw">shape</span>(784L, 200L), <span class="dt">stddev=</span><span class="fl">0.35</span>),
                       <span class="dt">name=</span><span class="st">"weights"</span>)
biases &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw">shape</span>(200L), <span class="dt">name=</span><span class="st">"biases"</span>))</code></pre>
<p>Calling <code>tf$Variable()</code> adds several ops to the graph:</p>
<ul>
<li>A <code>variable</code> op that holds the variable value.</li>
<li>An initializer op that sets the variable to its initial value. This is
actually a <code>tf$assign</code> op.</li>
<li>The ops for the initial value, such as the <code>zeros</code> op for the <code>biases</code>
variable in the example are also added to the graph.</li>
</ul>
<p>The value returned by <code>tf$Variable()</code> value is an instance of the Python class
<code>tf$Variable</code>.</p>
<div id="device-placement" class="section level3">
<h3>Device placement</h3>
<p>A variable can be pinned to a particular device when it is created, using a
<a href="https://www.tensorflow.org/api_docs/python/framework.html#device"><code><a href="https://www.rdocumentation.org/packages/base/topics/with">with(tf$device(...), {})</a></code></a> block:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pin a variable to CPU.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/Devices">device</a></span>(<span class="st">"/cpu:0"</span>), {
  v &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(...)
})
 

<span class="co"># Pin a variable to GPU.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/Devices">device</a></span>(<span class="st">"/gpu:0"</span>), {
  v &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(...)
})

<span class="co"># Pin a variable to a particular parameter server task.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/Devices">device</a></span>(<span class="st">"/job:ps/task:7"</span>), {
  v &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(...)
})</code></pre>
<p><strong>N.B.</strong> Operations that mutate a variable, such as
<a href="https://www.tensorflow.org/api_docs/python/state.html#Variable.assign"><code>v$assign()</code></a> and the parameter
update operations in a
<a href="https://www.tensorflow.org/api_docs/python/train.html#Optimizer"><code>tf$train$Optimizer</code></a> <em>must</em> run on
the same device as the variable. Incompatible device placement directives will
be ignored when creating these operations.</p>
<p>Device placement is particularly important when running in a replicated
setting. See
<a href="https://www.tensorflow.org/api_docs/python/train.html#replica_device_setter"><code>tf$train$replica_device_setter()</code></a>
for details of a device function that can simplify the configuration for devices
for a replicated model.</p>
</div>
</div>
<div id="initialization" class="section level2">
<h2>Initialization</h2>
<p>Variable initializers must be run explicitly before other ops in your model can
be run. The easiest way to do that is to add an op that runs all the variable
initializers, and run that op before using the model.</p>
<p>You can alternatively restore variable values from a checkpoint file, see
below.</p>
<p>Use <code>tf$global_variables_initializer()</code> to add an op to run variable initializers.
Only run that op after you have fully constructed your model and launched it in
a session.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create two variables.</span>
weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">random_normal</span>(<span class="kw">shape</span>(784L, 200L), <span class="dt">stddev=</span><span class="fl">0.35</span>),
                       <span class="dt">name=</span><span class="st">"weights"</span>)
biases &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw">shape</span>(<span class="dv">200</span>), <span class="dt">name=</span><span class="st">"biases"</span>))

<span class="co"># Add an op to initialize the variables.</span>
init_op &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">global_variables_initializer</span>()

<span class="co"># Later, when launching the model</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">Session</span>() <span class="op">%as%</span><span class="st"> </span>sess, {
  <span class="co"># Run the init operation.</span>
  sess<span class="op">$</span><span class="kw">run</span>(init_op)
  <span class="co"># Use the model</span>
  <span class="co"># ...</span>
})</code></pre>
<div id="initialization-from-another-variable" class="section level3">
<h3>Initialization from another Variable</h3>
<p>You sometimes need to initialize a variable from the initial value of another
variable. As the op added by <code>tf$global_variables_initializer()</code> initializes all
variables in parallel you have to be careful when this is needed.</p>
<p>To initialize a new variable from the value of another variable use the other
variableâ€™s <code>initialized_value()</code> property. You can use the initialized value
directly as the initial value for the new variable, or you can use it as any
other tensor to compute a value for the new variable.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a variable with a random value.</span>
weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">random_normal</span>(<span class="kw">shape</span>(784L, 200L), <span class="dt">stddev=</span><span class="fl">0.35</span>),
                       <span class="dt">name=</span><span class="st">"weights"</span>)
<span class="co"># Create another variable with the same value as 'weights'.</span>
w2 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(weights<span class="op">$</span><span class="kw">initialized_value</span>(), <span class="dt">name=</span><span class="st">"w2"</span>)
<span class="co"># Create another variable with twice the value of 'weights'</span>
w_twice &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(weights<span class="op">$</span><span class="kw">initialized_value</span>() <span class="op">*</span><span class="st"> </span><span class="fl">2.0</span>, <span class="dt">name=</span><span class="st">"w_twice"</span>)</code></pre>
</div>
<div id="custom-initialization" class="section level3">
<h3>Custom Initialization</h3>
<p>The convenience function <code>tf$global_variables_initializer()</code> adds an op to
initialize <em>all variables</em> in the model. You can also pass it an explicit list
of variables to initialize. See the
<a href="https://www.tensorflow.org/api_docs/python/state_ops.html">Variables Documentation</a> for more options,
including checking if variables are initialized.</p>
</div>
</div>
<div id="saving-and-restoring" class="section level2">
<h2>Saving and Restoring</h2>
<p>The easiest way to save and restore a model is to use a <code>tf$train$Saver</code> object.
The constructor adds <code>save</code> and <code>restore</code> ops to the graph for all, or a
specified list, of the variables in the graph. The saver object provides
methods to run these ops, specifying paths for the checkpoint files to write to
or read from.</p>
<div id="checkpoint-files" class="section level3">
<h3>Checkpoint Files</h3>
<p>Variables are saved in binary files that, roughly, contain a map from variable
names to tensor values.</p>
<p>When you create a <code>Saver</code> object, you can optionally choose names for the
variables in the checkpoint files. By default, it uses the value of the
<a href="https://www.tensorflow.org/api_docs/python/state_ops.html#Variable.name"><code>Variable.name</code></a> property for
each variable.</p>
<p>To understand what variables are in a checkpoint, you can use the
<a href="https://www.tensorflow.org/code/tensorflow/python/tools/inspect_checkpoint.py"><code>inspect_checkpoint</code></a>
library, and in particular, the <code>print_tensors_in_checkpoint_file</code> function.</p>
</div>
<div id="saving-variables" class="section level3">
<h3>Saving Variables</h3>
<p>Create a <code>Saver</code> with <code>tf$train$Saver()</code> to manage all variables in
the model.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create some variables.</span>
v1 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v1"</span>)
v2 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v2"</span>)
...
<span class="co"># Add an op to initialize the variables.</span>
init_op &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">global_variables_initializer</span>()

<span class="co"># Add ops to save and restore all the variables.</span>
saver &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">Saver</span>()

<span class="co"># Later, launch the model, initialize the variables, do some work, save the</span>
<span class="co"># variables to disk.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">Session</span>() <span class="op">%as%</span><span class="st"> </span>sess, {
  sess<span class="op">$</span><span class="kw">run</span>(init_op)
  <span class="co"># Do some work with the model.</span>
  ..
  <span class="co"># Save the variables to disk.</span>
  save_path &lt;-<span class="st"> </span>saver<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(sess, <span class="st">"/tmp/model.ckpt"</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"Model saved in file: %s</span><span class="ch">\n</span><span class="st">"</span>, save_path))
})</code></pre>
</div>
<div id="restoring-variables" class="section level3">
<h3>Restoring Variables</h3>
<p>The same <code>Saver</code> object is used to restore variables. Note that when you
restore variables from a file you do not have to initialize them beforehand.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create some variables.</span>
v1 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v1"</span>)
v2 =<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v2"</span>)
...
<span class="co"># Add ops to save and restore all the variables.</span>
saver &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">Saver</span>()

<span class="co"># Later, launch the model, use the saver to restore variables from disk, and</span>
<span class="co"># do some work with the model.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">Session</span>() <span class="op">%as%</span><span class="st"> </span>sess, {
  <span class="co"># Restore variables from disk.</span>
  saver<span class="op">$</span><span class="kw">restore</span>(sess, <span class="st">"/tmp/model.ckpt"</span>)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Model restored.</span><span class="ch">\n</span><span class="st">"</span>)
  <span class="co"># Do some work with the model</span>
  ...
})</code></pre>
</div>
<div id="choosing-which-variables-to-save-and-restore" class="section level3">
<h3>Choosing which Variables to Save and Restore</h3>
<p>If you do not pass any argument to <code>tf$train$Saver()</code> the saver handles all
variables in the graph. Each one of them is saved under the name that was
passed when the variable was created.</p>
<p>It is sometimes useful to explicitly specify names for variables in the
checkpoint files. For example, you may have trained a model with a variable
named <code>"weights"</code> whose value you want to restore in a new variable named
<code>"params"</code>.</p>
<p>It is also sometimes useful to only save or restore a subset of the variables
used by a model. For example, you may have trained a neural net with 5 layers,
and you now want to train a new model with 6 layers, restoring the parameters
from the 5 layers of the previously trained model into the first 5 layers of
the new model.</p>
<p>You can easily specify the names and variables to save by passing to the
<code>tf$train$Saver()</code> constructor a named list with the appropirate names and values.</p>
<p>Notes:</p>
<ul>
<li><p>You can create as many saver objects as you want if you need to save and
restore different subsets of the model variables. The same variable can be
listed in multiple saver objects, its value is only changed when the saver
<code>restore()</code> method is run.</p></li>
<li>
<p>If you only restore a subset of the model variables at the start
of a session, you have to run an initialize op for the other variables. See
<a href="https://www.tensorflow.org/api_docs/python/state_ops.html#initialize_variables"><code>tf$initialize_variables()</code></a>
for more information.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create some variables.</span>
v1 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v1"</span>)
v2 &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(..., <span class="dt">name=</span><span class="st">"v2"</span>)

<span class="co"># Add ops to save and restore only 'v2' using the name "my_v2"</span>
saver &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">Saver</span>(<span class="kw">dict</span>(<span class="dt">my_v2 =</span> v2))
<span class="co"># Use the saver object normally after that.</span></code></pre>
</li>
</ul>
</div>
</div>
