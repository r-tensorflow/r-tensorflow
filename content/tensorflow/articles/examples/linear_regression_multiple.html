---
title: linear_regression_multiple
type: docs
menu:
  main:
    parent: tensorflow-examples
---



<p>Illustrate how a multiple linear regression (Y ~ XW + b) might be fit using TensorFlow.</p>
<p>This example was adapted from:
<a href="https://github.com/aymericdamien/TensorFlow-Examples/blob/master/examples/2_BasicModels/linear_regression.py" class="uri">https://github.com/aymericdamien/TensorFlow-Examples/blob/master/examples/2_BasicModels/linear_regression.py</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tensorflow)

<span class="co"># 'X' and 'Y' are placeholders for input data, output data.</span>
<span class="co"># We'll fit a regression model using 3 predictors, so our</span>
<span class="co"># input matrix 'X' will have three columns.</span>
p &lt;-<span class="st"> </span>3L
X &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(<span class="st">"float"</span>, <span class="dt">shape =</span> <span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(<span class="ot">NULL</span>, p), <span class="dt">name =</span> <span class="st">"x-data"</span>)
Y &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(<span class="st">"float"</span>, <span class="dt">name =</span> <span class="st">"y-data"</span>)

<span class="co"># Define the weights for each column in X. Since we will</span>
<span class="co"># have 3 predictors, our 'W' matrix of coefficients will</span>
<span class="co"># have 3 elements. We use a 3 x 1 matrix here, rather than</span>
<span class="co"># a vector, to ensure TensorFlow understands how to perform</span>
<span class="co"># matrix multiplication on 'W' and 'X'.</span>
W &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(p, 1L)))
b &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(1L)))

<span class="co"># Define the model (how estimates of 'Y' are produced)</span>
Y_hat &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">add</span>(tf<span class="op">$</span><span class="kw">matmul</span>(X, W), b)

<span class="co"># Define the cost function.</span>
<span class="co"># We seek to minimize the mean-squared error.</span>
cost &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">reduce_mean</span>(tf<span class="op">$</span><span class="kw">square</span>(Y_hat <span class="op">-</span><span class="st"> </span>Y))

<span class="co"># Define the mechanism used to optimize the loss function.</span>
<span class="co"># Although normally we'd just use ordinary least squares,</span>
<span class="co"># we'll instead use a gradient descent optimizer (since, in</span>
<span class="co"># a more typical learning situation, we won't have an easy</span>
<span class="co"># mechanism for directly computing the values of coefficients)</span>
generator &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">GradientDescentOptimizer</span>(<span class="dt">learning_rate =</span> <span class="fl">0.01</span>)
optimizer &lt;-<span class="st"> </span>generator<span class="op">$</span><span class="kw">minimize</span>(cost)

<span class="co"># Initialize a TensorFlow session for our regression.</span>
init &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">global_variables_initializer</span>()
session &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Session</span>()
session<span class="op">$</span><span class="kw">run</span>(init)

<span class="co"># Generate some data. The 'true' model will be 'y = 2x + 1';</span>
<span class="co"># that is, the 'slope' parameter is '2', and the intercept is '1'.</span>
<span class="co"># The variable 'y' will only be associated with the first variable;</span>
<span class="co"># the other two variables are just noise.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">250</span>
x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(p <span class="op">*</span><span class="st"> </span>n), <span class="dt">nrow =</span> n)
y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x[, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(n, <span class="dt">sd =</span> <span class="fl">0.25</span>)))

<span class="co"># Repeatedly run optimizer until the cost is no longer changing.</span>
<span class="co"># (We can take advantage of this since we're using gradient descent</span>
<span class="co"># as our optimizer)</span>
feed_dict &lt;-<span class="st"> </span><span class="kw"><a href="../../../tensorflow/reference/reexports.html">dict</a></span>(<span class="dt">X =</span> x, <span class="dt">Y =</span> y)
epsilon &lt;-<span class="st"> </span>.Machine<span class="op">$</span>double.eps
last_cost &lt;-<span class="st"> </span><span class="ot">Inf</span>
<span class="cf">while</span> (<span class="ot">TRUE</span>) {
  session<span class="op">$</span><span class="kw">run</span>(optimizer, <span class="dt">feed_dict =</span> feed_dict)
  current_cost &lt;-<span class="st"> </span>session<span class="op">$</span><span class="kw">run</span>(cost, <span class="dt">feed_dict =</span> feed_dict)
  <span class="cf">if</span> (last_cost <span class="op">-</span><span class="st"> </span>current_cost <span class="op">&lt;</span><span class="st"> </span>epsilon) <span class="cf">break</span>
  last_cost &lt;-<span class="st"> </span>current_cost
}

<span class="co"># Generate an R model and compare coefficients from each fit</span>
r_model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y <span class="op">~</span><span class="st"> </span>x)

<span class="co"># Collect coefficients from TensorFlow model fit</span>
tf_coef &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(session<span class="op">$</span><span class="kw">run</span>(b), session<span class="op">$</span><span class="kw">run</span>(W))
r_coef  &lt;-<span class="st"> </span>r_model<span class="op">$</span>coefficients

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(tf_coef, r_coef))</code></pre>
