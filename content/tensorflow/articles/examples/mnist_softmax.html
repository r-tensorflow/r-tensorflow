---
title: mnist_softmax
type: docs
menu:
  main:
    parent: tensorflow-examples
---



<p>Use softmax regression to train a model to look at MNIST images and predict what digits they are.</p>
<p>See the <a href="../tutorial_mnist_beginners.html">MNIST For ML Beginners</a> tutorial for an in-depth
explanation of the code in this example.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tensorflow)

<span class="co"># Create the model</span>
x &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(tf<span class="op">$</span>float32, <span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(<span class="ot">NULL</span>, 784L))
W &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(784L, 10L)))
b &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(10L)))

y &lt;-<span class="st"> </span>tf<span class="op">$</span>nn<span class="op">$</span><span class="kw">softmax</span>(tf<span class="op">$</span><span class="kw">matmul</span>(x, W) <span class="op">+</span><span class="st"> </span>b)

<span class="co"># Define loss and optimizer</span>
y_ &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(tf<span class="op">$</span>float32, <span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(<span class="ot">NULL</span>, 10L))
cross_entropy &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">reduce_mean</span>(<span class="op">-</span>tf<span class="op">$</span><span class="kw">reduce_sum</span>(y_ <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(y), <span class="dt">reduction_indices=</span>1L))
train_step &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">GradientDescentOptimizer</span>(<span class="fl">0.5</span>)<span class="op">$</span><span class="kw">minimize</span>(cross_entropy)

<span class="co"># Create session and initialize  variables</span>
sess &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Session</span>()
sess<span class="op">$</span><span class="kw">run</span>(tf<span class="op">$</span><span class="kw">global_variables_initializer</span>())

<span class="co"># Load mnist data    )</span>
datasets &lt;-<span class="st"> </span>tf<span class="op">$</span>contrib<span class="op">$</span>learn<span class="op">$</span>datasets
mnist &lt;-<span class="st"> </span>datasets<span class="op">$</span>mnist<span class="op">$</span><span class="kw">read_data_sets</span>(<span class="st">"MNIST-data"</span>, <span class="dt">one_hot =</span> <span class="ot">TRUE</span>)

<span class="co"># Train</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>) {
  batches &lt;-<span class="st"> </span>mnist<span class="op">$</span>train<span class="op">$</span><span class="kw">next_batch</span>(100L)
  batch_xs &lt;-<span class="st"> </span>batches[[<span class="dv">1</span>]]
  batch_ys &lt;-<span class="st"> </span>batches[[<span class="dv">2</span>]]
  sess<span class="op">$</span><span class="kw">run</span>(train_step,
           <span class="dt">feed_dict =</span> <span class="kw"><a href="../../../tensorflow/reference/reexports.html">dict</a></span>(<span class="dt">x =</span> batch_xs, <span class="dt">y_ =</span> batch_ys))
}

<span class="co"># Test trained model</span>
correct_prediction &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">equal</span>(tf<span class="op">$</span><span class="kw">argmax</span>(y, 1L), tf<span class="op">$</span><span class="kw">argmax</span>(y_, 1L))
accuracy &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">reduce_mean</span>(tf<span class="op">$</span><span class="kw">cast</span>(correct_prediction, tf<span class="op">$</span>float32))
sess<span class="op">$</span><span class="kw">run</span>(accuracy,
         <span class="dt">feed_dict =</span> <span class="kw"><a href="../../../tensorflow/reference/reexports.html">dict</a></span>(<span class="dt">x =</span> mnist<span class="op">$</span>test<span class="op">$</span>images, <span class="dt">y_ =</span> mnist<span class="op">$</span>test<span class="op">$</span>labels))</code></pre>
