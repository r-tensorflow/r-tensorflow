---
title: mnist_fully_connected_feed
type: docs
menu:
  main:
    parent: tensorflow-examples
---



<p>Trains and Evaluates the MNIST network using a feed dictionary.</p>
<p>See the <a href="../tutorial_tensorflow_mechanics.html">TensorFlow Mechanics 101</a> tutorial for an in-depth
explanation of the code in this example.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tensorflow)

<span class="co"># The MNIST dataset has 10 classes, representing the digits 0 through 9.</span>
NUM_CLASSES &lt;-<span class="st"> </span>10L

<span class="co"># The MNIST images are always 28x28 pixels.</span>
IMAGE_SIZE &lt;-<span class="st"> </span>28L
IMAGE_PIXELS &lt;-<span class="st"> </span>IMAGE_SIZE <span class="op">*</span><span class="st"> </span>IMAGE_SIZE

<span class="co"># Basic model parameters as external flags.</span>
FLAGS &lt;-<span class="st"> </span><span class="kw"><a href="../../../tensorflow/reference/reexports.html">flags</a></span>(
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_numeric</a></span>(<span class="st">'learning_rate'</span>, <span class="fl">0.01</span>, <span class="st">'Initial learning rate.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_integer</a></span>(<span class="st">'max_steps'</span>, 5000L, <span class="st">'Number of steps to run trainer.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_integer</a></span>(<span class="st">'hidden1'</span>, 128L, <span class="st">'Number of units in hidden layer 1.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_integer</a></span>(<span class="st">'hidden2'</span>, 32L, <span class="st">'Number of units in hidden layer 2.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_integer</a></span>(<span class="st">'batch_size'</span>, 100L, <span class="st">'Batch size. Must divide evenly into the dataset sizes.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_string</a></span>(<span class="st">'train_dir'</span>, <span class="st">'MNIST-data'</span>, <span class="st">'Directory to put the training data.'</span>),
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">flag_boolean</a></span>(<span class="st">'fake_data'</span>, <span class="ot">FALSE</span>, <span class="st">'If true, uses fake data for unit testing.'</span>)
)

<span class="co"># input_data</span>
input_data &lt;-<span class="st"> </span>tf<span class="op">$</span>contrib<span class="op">$</span>learn<span class="op">$</span>datasets<span class="op">$</span>mnist


<span class="co"># Functions to builds the MNIST network.</span>
<span class="co">#</span>
<span class="co"># Implements the inference/loss/training pattern for model building.</span>
<span class="co">#</span>
<span class="co"># 1. inference() - Builds the model as far as is required for running the network</span>
<span class="co"># forward to make predictions.</span>
<span class="co"># 2. loss() - Adds to the inference model the layers required to generate loss.</span>
<span class="co"># 3. training() - Adds to the loss model the Ops required to generate and</span>
<span class="co"># apply gradients.</span>

<span class="co"># Build the MNIST model up to where it may be used for inference.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   images: Images placeholder, from inputs().</span>
<span class="co">#   hidden1_units: Size of the first hidden layer.</span>
<span class="co">#   hidden2_units: Size of the second hidden layer.</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   softmax_linear: Output tensor with the computed logits.</span>
<span class="co">#</span>
inference &lt;-<span class="st"> </span><span class="cf">function</span>(images, hidden1_units, hidden2_units) {
  
  <span class="co"># Hidden 1</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">name_scope</span>(<span class="st">'hidden1'</span>), {
    weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(
      tf<span class="op">$</span><span class="kw">truncated_normal</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(IMAGE_PIXELS, hidden1_units),
                          <span class="dt">stddev =</span> <span class="fl">1.0</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(IMAGE_PIXELS)),
      <span class="dt">name =</span> <span class="st">'weights'</span>
    )
    biases &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(hidden1_units),
                                   <span class="dt">name =</span> <span class="st">'biases'</span>))
    hidden1 &lt;-<span class="st"> </span>tf<span class="op">$</span>nn<span class="op">$</span><span class="kw">relu</span>(tf<span class="op">$</span><span class="kw">matmul</span>(images, weights) <span class="op">+</span><span class="st"> </span>biases)
  })
  
  <span class="co"># Hidden 2</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">name_scope</span>(<span class="st">'hidden2'</span>), {
    weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(
      tf<span class="op">$</span><span class="kw">truncated_normal</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(hidden1_units, hidden2_units),
                          <span class="dt">stddev =</span> <span class="fl">1.0</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(hidden1_units)),
      <span class="dt">name =</span> <span class="st">'weights'</span>)
    biases &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(hidden2_units)),
                          <span class="dt">name =</span> <span class="st">'biases'</span>)
    hidden2 &lt;-<span class="st"> </span>tf<span class="op">$</span>nn<span class="op">$</span><span class="kw">relu</span>(tf<span class="op">$</span><span class="kw">matmul</span>(hidden1, weights) <span class="op">+</span><span class="st"> </span>biases)
  })
  
  <span class="co"># Linear</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">name_scope</span>(<span class="st">'softmax_linear'</span>), {
    weights &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(
      tf<span class="op">$</span><span class="kw">truncated_normal</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(hidden2_units, NUM_CLASSES),
                          <span class="dt">stddev =</span> <span class="fl">1.0</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(hidden2_units)),
      <span class="dt">name =</span> <span class="st">'weights'</span>)
    biases &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(tf<span class="op">$</span><span class="kw">zeros</span>(<span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(NUM_CLASSES)),
                          <span class="dt">name =</span> <span class="st">'biases'</span>)
    logits &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">matmul</span>(hidden2, weights) <span class="op">+</span><span class="st"> </span>biases
  })
  
  <span class="co"># return logits</span>
  logits
}

<span class="co"># Calculates the loss from the logits and the labels.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   logits: Logits tensor, float - [batch_size, NUM_CLASSES].</span>
<span class="co">#   labels: Labels tensor, int32 - [batch_size].</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   loss: Loss tensor of type float.</span>
<span class="co">#</span>
loss &lt;-<span class="st"> </span><span class="cf">function</span>(logits, labels) {
  labels &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">to_int64</span>(labels)
  cross_entropy &lt;-<span class="st"> </span>tf<span class="op">$</span>nn<span class="op">$</span><span class="kw">sparse_softmax_cross_entropy_with_logits</span>(
    <span class="dt">logits =</span> logits, <span class="dt">labels =</span> labels, <span class="dt">name =</span> <span class="st">'xentropy'</span>)
  tf<span class="op">$</span><span class="kw">reduce_mean</span>(cross_entropy, <span class="dt">name =</span> <span class="st">'xentropy_mean'</span>)
}

<span class="co"># Sets up the training Ops.</span>
<span class="co">#</span>
<span class="co"># Creates a summarizer to track the loss over time in TensorBoard.</span>
<span class="co">#</span>
<span class="co"># Creates an optimizer and applies the gradients to all trainable variables.</span>
<span class="co">#</span>
<span class="co"># The Op returned by this function is what must be passed to the</span>
<span class="co"># `sess.run()` call to cause the model to train.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   loss: Loss tensor, from loss().</span>
<span class="co">#   learning_rate: The learning rate to use for gradient descent.</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   train_op: The Op for training.</span>
<span class="co">#</span>
training &lt;-<span class="st"> </span><span class="cf">function</span>(loss, learning_rate) {
  
  <span class="co"># Add a scalar summary for the snapshot loss.</span>
  tf<span class="op">$</span>summary<span class="op">$</span><span class="kw">scalar</span>(loss<span class="op">$</span>op<span class="op">$</span>name, loss)
  
  <span class="co"># Create the gradient descent optimizer with the given learning rate.</span>
  optimizer &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">GradientDescentOptimizer</span>(learning_rate)
  
  <span class="co"># Create a variable to track the global step.</span>
  global_step &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Variable</span>(0L, <span class="dt">name =</span> <span class="st">'global_step'</span>, <span class="dt">trainable =</span> <span class="ot">FALSE</span>)
  
  <span class="co"># Use the optimizer to apply the gradients that minimize the loss</span>
  <span class="co"># (and also increment the global step counter) as a single training step.</span>
  optimizer<span class="op">$</span><span class="kw">minimize</span>(loss, <span class="dt">global_step =</span> global_step)
}

<span class="co"># Evaluate the quality of the logits at predicting the label.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   logits: Logits tensor, float - [batch_size, NUM_CLASSES].</span>
<span class="co">#   labels: Labels tensor, int32 - [batch_size], with values in the</span>
<span class="co">#           range [0, NUM_CLASSES).</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   A scalar int32 tensor with the number of examples (out of batch_size)</span>
<span class="co">#   that were predicted correctly.</span>
evaluation &lt;-<span class="st"> </span><span class="cf">function</span>(logits, labels) {
  
  <span class="co"># For a classifier model, we can use the in_top_k Op.</span>
  <span class="co"># It returns a bool tensor with shape [batch_size] that is true for</span>
  <span class="co"># the examples where the label is in the top k (here k=1)</span>
  <span class="co"># of all logits for that example.</span>
  correct &lt;-<span class="st"> </span>tf<span class="op">$</span>nn<span class="op">$</span><span class="kw">in_top_k</span>(logits, labels, 1L)
  tf<span class="op">$</span><span class="kw">reduce_sum</span>(tf<span class="op">$</span><span class="kw">cast</span>(correct, tf<span class="op">$</span>int32))
}

<span class="co"># Generate placeholder variables to represent the input tensors.</span>
<span class="co">#</span>
<span class="co"># These placeholders are used as inputs by the rest of the model building</span>
<span class="co"># code and will be fed from the downloaded data in the .run() loop, below.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   batch_size: The batch size will be baked into both placeholders.</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   placeholders$images: Images placeholder.</span>
<span class="co">#   placeholders$labels: Labels placeholder.</span>
<span class="co">#</span>
placeholder_inputs &lt;-<span class="st"> </span><span class="cf">function</span>(batch_size) {

  <span class="co"># Note that the shapes of the placeholders match the shapes of the full</span>
  <span class="co"># image and label tensors, except the first dimension is now batch_size</span>
  <span class="co"># rather than the full size of the train or test data sets.</span>
  images &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(tf<span class="op">$</span>float32, <span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(batch_size, IMAGE_PIXELS))
  labels &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">placeholder</span>(tf<span class="op">$</span>int32, <span class="kw"><a href="../../../tensorflow/reference/shape.html">shape</a></span>(batch_size))

  <span class="co"># return both placeholders</span>
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">images =</span> images, <span class="dt">labels =</span> labels)
}

<span class="co"># Fills the feed_dict for training the given step.</span>
<span class="co">#</span>
<span class="co"># A feed_dict takes the form of:</span>
<span class="co">#   feed_dict = dict(</span>
<span class="co">#     &lt;placeholder = &lt;tensor of values to be passed for placeholder&gt;,</span>
<span class="co">#     ....</span>
<span class="co">#   )</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   data_set: The set of images and labels, from input_data.read_data_sets()</span>
<span class="co">#   images_pl: The images placeholder, from placeholder_inputs().</span>
<span class="co">#   labels_pl: The labels placeholder, from placeholder_inputs().</span>
<span class="co">#</span>
<span class="co"># Returns:</span>
<span class="co">#   feed_dict: The feed dictionary mapping from placeholders to values.</span>
<span class="co">#</span>
fill_feed_dict &lt;-<span class="st"> </span><span class="cf">function</span>(data_set, images_pl, labels_pl) {
  <span class="co"># Create the feed_dict for the placeholders filled with the next</span>
  <span class="co"># `batch size` examples.</span>
  batch &lt;-<span class="st"> </span>data_set<span class="op">$</span><span class="kw">next_batch</span>(FLAGS<span class="op">$</span>batch_size, FLAGS<span class="op">$</span>fake_data)
  images_feed &lt;-<span class="st"> </span>batch[[<span class="dv">1</span>]]
  labels_feed &lt;-<span class="st"> </span>batch[[<span class="dv">2</span>]]
  <span class="kw"><a href="../../../tensorflow/reference/reexports.html">dict</a></span>(
    <span class="dt">images_pl =</span> images_feed,
    <span class="dt">labels_pl =</span> labels_feed
  )
}

<span class="co"># Runs one evaluation against the full epoch of data.</span>
<span class="co">#</span>
<span class="co"># Args:</span>
<span class="co">#   sess: The session in which the model has been trained.</span>
<span class="co">#   eval_correct: The Tensor that returns the number of correct predictions.</span>
<span class="co">#   images_placeholder: The images placeholder.</span>
<span class="co">#   labels_placeholder: The labels placeholder.</span>
<span class="co">#   data_set: The set of images and labels to evaluate,</span>
<span class="co">#             from input_data.read_data_sets().</span>
<span class="co">#</span>
do_eval &lt;-<span class="st"> </span><span class="cf">function</span>(sess,
                    eval_correct,
                    images_placeholder,
                    labels_placeholder,
                    data_set) {
  <span class="co"># And run one epoch of eval.</span>
  true_count &lt;-<span class="st"> </span><span class="dv">0</span>  <span class="co"># Counts the number of correct predictions.</span>
  steps_per_epoch &lt;-<span class="st"> </span>data_set<span class="op">$</span>num_examples <span class="op">%/%</span><span class="st"> </span>FLAGS<span class="op">$</span>batch_size
  num_examples &lt;-<span class="st"> </span>steps_per_epoch <span class="op">*</span><span class="st"> </span>FLAGS<span class="op">$</span>batch_size
  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>steps_per_epoch) {
    feed_dict &lt;-<span class="st"> </span><span class="kw">fill_feed_dict</span>(data_set,
                                images_placeholder,
                                labels_placeholder)
    true_count &lt;-<span class="st"> </span>true_count <span class="op">+</span><span class="st"> </span>sess<span class="op">$</span><span class="kw">run</span>(eval_correct, <span class="dt">feed_dict=</span>feed_dict)
  }

  precision &lt;-<span class="st"> </span>true_count <span class="op">/</span><span class="st"> </span>num_examples
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">'  Num examples: %d  Num correct: %d  Precision @ 1: %0.04f</span><span class="ch">\n</span><span class="st">'</span>,
              num_examples, true_count, precision))
}


<span class="co"># Train MNIST for a number of steps.</span>

<span class="co"># Get the sets of images and labels for training, validation, and</span>
<span class="co"># test on MNIST.</span>
data_sets &lt;-<span class="st"> </span>input_data<span class="op">$</span><span class="kw">read_data_sets</span>(FLAGS<span class="op">$</span>train_dir, FLAGS<span class="op">$</span>fake_data)

<span class="co"># Tell TensorFlow that the model will be built into the default Graph.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(tf<span class="op">$</span><span class="kw">Graph</span>()<span class="op">$</span><span class="kw">as_default</span>(), {

  <span class="co"># Generate placeholders for the images and labels.</span>
  placeholders &lt;-<span class="st"> </span><span class="kw">placeholder_inputs</span>(FLAGS<span class="op">$</span>batch_size)

  <span class="co"># Build a Graph that computes predictions from the inference model.</span>
  logits &lt;-<span class="st"> </span><span class="kw">inference</span>(placeholders<span class="op">$</span>images, FLAGS<span class="op">$</span>hidden1, FLAGS<span class="op">$</span>hidden2)

  <span class="co"># Add to the Graph the Ops for loss calculation.</span>
  loss &lt;-<span class="st"> </span><span class="kw">loss</span>(logits, placeholders<span class="op">$</span>labels)

  <span class="co"># Add to the Graph the Ops that calculate and apply gradients.</span>
  train_op &lt;-<span class="st"> </span><span class="kw">training</span>(loss, FLAGS<span class="op">$</span>learning_rate)

  <span class="co"># Add the Op to compare the logits to the labels during evaluation.</span>
  eval_correct &lt;-<span class="st"> </span><span class="kw">evaluation</span>(logits, placeholders<span class="op">$</span>labels)

  <span class="co"># Build the summary Tensor based on the TF collection of Summaries.</span>
  summary &lt;-<span class="st"> </span>tf<span class="op">$</span>summary<span class="op">$</span><span class="kw">merge_all</span>()

  <span class="co"># Add the variable initializer Op.</span>
  init &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">global_variables_initializer</span>()

  <span class="co"># Create a saver for writing training checkpoints.</span>
  saver &lt;-<span class="st"> </span>tf<span class="op">$</span>train<span class="op">$</span><span class="kw">Saver</span>()

  <span class="co"># Create a session for running Ops on the Graph.</span>
  sess &lt;-<span class="st"> </span>tf<span class="op">$</span><span class="kw">Session</span>()

  <span class="co"># Instantiate a SummaryWriter to output summaries and the Graph.</span>
  summary_writer &lt;-<span class="st"> </span>tf<span class="op">$</span>summary<span class="op">$</span><span class="kw">FileWriter</span>(FLAGS<span class="op">$</span>train_dir, sess<span class="op">$</span>graph)

  <span class="co"># And then after everything is built:</span>

  <span class="co"># Run the Op to initialize the variables.</span>
  sess<span class="op">$</span><span class="kw">run</span>(init)

  <span class="co"># Start the training loop.</span>
  <span class="cf">for</span> (step <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>FLAGS<span class="op">$</span>max_steps) {

    start_time &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>()

    <span class="co"># Fill a feed dictionary with the actual set of images and labels</span>
    <span class="co"># for this particular training step.</span>
    feed_dict &lt;-<span class="st"> </span><span class="kw">fill_feed_dict</span>(data_sets<span class="op">$</span>train,
                                placeholders<span class="op">$</span>images,
                                placeholders<span class="op">$</span>labels)

    <span class="co"># Run one step of the model.  The return values are the activations</span>
    <span class="co"># from the `train_op` (which is discarded) and the `loss` Op.  To</span>
    <span class="co"># inspect the values of your Ops or variables, you may include them</span>
    <span class="co"># in the list passed to sess.run() and the value tensors will be</span>
    <span class="co"># returned in the tuple from the call.</span>
    values &lt;-<span class="st"> </span>sess<span class="op">$</span><span class="kw">run</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(train_op, loss), <span class="dt">feed_dict =</span> feed_dict)
    loss_value &lt;-<span class="st"> </span>values[[<span class="dv">2</span>]]

    duration &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>() <span class="op">-</span><span class="st"> </span>start_time

    <span class="co"># Write the summaries and print an overview fairly often.</span>
    <span class="cf">if</span> (step <span class="op">%%</span><span class="st"> </span><span class="dv">100</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
      <span class="co"># Print status to stdout.</span>
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">'Step %d: loss = %.2f (%.3f sec)</span><span class="ch">\n</span><span class="st">'</span>,
                  step, loss_value, duration))
      <span class="co"># Update the events file.</span>
      summary_str &lt;-<span class="st"> </span>sess<span class="op">$</span><span class="kw">run</span>(summary, <span class="dt">feed_dict=</span>feed_dict)
      summary_writer<span class="op">$</span><span class="kw">add_summary</span>(summary_str, step)
      summary_writer<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">flush</a></span>()
    }

    <span class="co"># Save a checkpoint and evaluate the model periodically.</span>
    <span class="cf">if</span> ((step <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1000</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span>(step <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">==</span><span class="st"> </span>FLAGS<span class="op">$</span>max_steps) {
      checkpoint_file &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(FLAGS<span class="op">$</span>train_dir, <span class="st">'checkpoint'</span>)
      saver<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(sess, checkpoint_file, <span class="dt">global_step=</span>step)
      <span class="co"># Evaluate against the training set.</span>
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">'Training Data Eval:</span><span class="ch">\n</span><span class="st">'</span>)
      <span class="kw">do_eval</span>(sess,
              eval_correct,
              placeholders<span class="op">$</span>images,
              placeholders<span class="op">$</span>labels,
              data_sets<span class="op">$</span>train)
      <span class="co"># Evaluate against the validation set.</span>
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">'Validation Data Eval:</span><span class="ch">\n</span><span class="st">'</span>)
      <span class="kw">do_eval</span>(sess,
              eval_correct,
              placeholders<span class="op">$</span>images,
              placeholders<span class="op">$</span>labels,
              data_sets<span class="op">$</span>validation)
      <span class="co"># Evaluate against the test set.</span>
      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">'Test Data Eval:</span><span class="ch">\n</span><span class="st">'</span>)
      <span class="kw">do_eval</span>(sess,
              eval_correct,
              placeholders<span class="op">$</span>images,
              placeholders<span class="op">$</span>labels,
              data_sets<span class="op">$</span>test)
    }
  }
})</code></pre>
