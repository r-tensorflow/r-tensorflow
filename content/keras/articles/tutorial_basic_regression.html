---
title: "Tutorial: Basic Regression"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial: Basic Regression}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
type: docs
repo: https://github.com/rstudio/keras
menu:
  main:
    name: "Tutorial: Basic Regression"
    identifier: "keras-tutorial-basic-regression"
    parent: "keras-getting-started"
    weight: 40
---



<p>In a regression problem, we aim to predict the output of a continuous value, like a price or a probability. Contrast this with a classification problem, where we aim to predict a discrete label (for example, where a picture contains an apple or an orange).</p>
<p>This notebook builds a model to predict the median price of homes in a Boston suburb during the mid-1970s. To do this, we’ll provide the model with some data points about the suburb, such as the crime rate and the local property tax rate.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(keras)</code></pre>
<div id="the-boston-housing-prices-dataset" class="section level2">
<h2>The Boston Housing Prices dataset</h2>
<p>The <a href="https://www.cs.toronto.edu/~delve/data/boston/bostonDetail.html">Boston Housing Prices dataset</a> is accessible directly from keras.</p>
<pre class="sourceCode r"><code class="sourceCode r">boston_housing &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dataset_boston_housing.html">dataset_boston_housing</a></span>()

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(train_data, train_labels) <span class="op">%&lt;-%</span><span class="st"> </span>boston_housing<span class="op">$</span>train
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(test_data, test_labels) <span class="op">%&lt;-%</span><span class="st"> </span>boston_housing<span class="op">$</span>test</code></pre>
<div id="examples-and-features" class="section level3">
<h3>Examples and features</h3>
<p>This dataset is much smaller than the others we’ve worked with so far: it has 506 total examples that are split between 404 training examples and 102 test examples:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"Training entries: "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(train_data), <span class="st">", labels: "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(train_labels))</code></pre>
<pre><code>[1] "Training entries: 5252, labels: 404"</code></pre>
<p>The dataset contains 13 different features:</p>
<ul>
<li>Per capita crime rate.</li>
<li>The proportion of residential land zoned for lots over 25,000 square feet.</li>
<li>The proportion of non-retail business acres per town.</li>
<li>Charles River dummy variable (= 1 if tract bounds river; 0 otherwise).</li>
<li>Nitric oxides concentration (parts per 10 million).</li>
<li>The average number of rooms per dwelling.</li>
<li>The proportion of owner-occupied units built before 1940.</li>
<li>Weighted distances to five Boston employment centers.</li>
<li>Index of accessibility to radial highways.</li>
<li>Full-value property-tax rate per $10,000.</li>
<li>Pupil-teacher ratio by town.</li>
<li>1000 * (Bk - 0.63) ** 2 where Bk is the proportion of Black people by town.</li>
<li>Percentage lower status of the population.</li>
</ul>
<p>Each one of these input data features is stored using a different scale. Some features are represented by a proportion between 0 and 1, other features are ranges between 1 and 12, some are ranges between 0 and 100, and so on.</p>
<pre class="sourceCode r"><code class="sourceCode r">train_data[<span class="dv">1</span>, ] <span class="co"># Display sample features, notice the different scales</span></code></pre>
<pre><code>[1]   1.23247   0.00000   8.14000   0.00000   0.53800   6.14200  91.70000   3.97690
[9]   4.00000 307.00000  21.00000 396.90000  18.72000</code></pre>
<p>Let’s add column names for better data inspection.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tibble)

column_names &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'CRIM'</span>, <span class="st">'ZN'</span>, <span class="st">'INDUS'</span>, <span class="st">'CHAS'</span>, <span class="st">'NOX'</span>, <span class="st">'RM'</span>, <span class="st">'AGE'</span>, 
                  <span class="st">'DIS'</span>, <span class="st">'RAD'</span>, <span class="st">'TAX'</span>, <span class="st">'PTRATIO'</span>, <span class="st">'B'</span>, <span class="st">'LSTAT'</span>)
train_df &lt;-<span class="st"> </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(train_data)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(train_df) &lt;-<span class="st"> </span>column_names

train_df</code></pre>
<pre><code># A tibble: 404 x 13
     CRIM    ZN INDUS  CHAS   NOX    RM   AGE   DIS   RAD   TAX PTRATIO     B LSTAT
    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 1.23     0    8.14     0 0.538  6.14  91.7  3.98     4   307    21    397. 18.7 
 2 0.0218  82.5  2.03     0 0.415  7.61  15.7  6.27     2   348    14.7  395.  3.11
 3 4.90     0   18.1      0 0.631  4.97 100    1.33    24   666    20.2  376.  3.26
 4 0.0396   0    5.19     0 0.515  6.04  34.5  5.99     5   224    20.2  397.  8.01
 5 3.69     0   18.1      0 0.713  6.38  88.4  2.57    24   666    20.2  391. 14.6 
 6 0.284    0    7.38     0 0.493  5.71  74.3  4.72     5   287    19.6  391. 11.7 
 7 9.19     0   18.1      0 0.7    5.54 100    1.58    24   666    20.2  397. 23.6 
 8 4.10     0   19.6      0 0.871  5.47 100    1.41     5   403    14.7  397. 26.4 
 9 2.16     0   19.6      0 0.871  5.63 100    1.52     5   403    14.7  169. 16.6 
10 1.63     0   21.9      0 0.624  5.02 100    1.44     4   437    21.2  397. 34.4 
# ... with 394 more rows</code></pre>
</div>
<div id="labels" class="section level3">
<h3>Labels</h3>
<p>The labels are the house prices in thousands of dollars. (You may notice the mid-1970s prices.)</p>
<pre class="sourceCode r"><code class="sourceCode r">train_labels[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] <span class="co"># Display first 10 entries</span></code></pre>
<pre><code>[1] 15.2 42.3 50.0 21.1 17.7 18.5 11.3 15.6 15.6 14.4</code></pre>
</div>
</div>
<div id="normalize-features" class="section level2">
<h2>Normalize features</h2>
<p>It’s recommended to normalize features that use different scales and ranges. Although the model might converge without feature normalization, it makes training more difficult, and it makes the resulting model more dependant on the choice of units used in the input.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Test data is *not* used when calculating the mean and std.</span>

<span class="co"># Normalize training data</span>
train_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/scale">scale</a></span>(train_data) 

<span class="co"># Use means and standard deviations from training set to normalize test set</span>
col_means_train &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(train_data, <span class="st">"scaled:center"</span>) 
col_stddevs_train &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(train_data, <span class="st">"scaled:scale"</span>)
test_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/scale">scale</a></span>(test_data, <span class="dt">center =</span> col_means_train, <span class="dt">scale =</span> col_stddevs_train)

train_data[<span class="dv">1</span>, ] <span class="co"># First training sample, normalized</span></code></pre>
<pre><code>[1] -0.2719092 -0.4830166 -0.4352220 -0.2565147 -0.1650220 -0.1762241  0.8120550  0.1165538 -0.6254735
[10] -0.5944330  1.1470781  0.4475222  0.8241983</code></pre>
</div>
<div id="create-the-model" class="section level2">
<h2>Create the model</h2>
<p>Let’s build our model. Here, we’ll use a <code>sequential</code> model with two densely connected hidden layers, and an output layer that returns a single, continuous value. The model building steps are wrapped in a function, <code>build_model</code>, since we’ll create a second model, later on.</p>
<pre class="sourceCode r"><code class="sourceCode r">build_model &lt;-<span class="st"> </span><span class="cf">function</span>() {
  
  model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/keras_model_sequential.html">keras_model_sequential</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/layer_dense.html">layer_dense</a></span>(<span class="dt">units =</span> <span class="dv">64</span>, <span class="dt">activation =</span> <span class="st">"relu"</span>,
                <span class="dt">input_shape =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(train_data)[<span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/layer_dense.html">layer_dense</a></span>(<span class="dt">units =</span> <span class="dv">64</span>, <span class="dt">activation =</span> <span class="st">"relu"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/layer_dense.html">layer_dense</a></span>(<span class="dt">units =</span> <span class="dv">1</span>)
  
  model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/reexports.html">compile</a></span>(
    <span class="dt">loss =</span> <span class="st">"mse"</span>,
    <span class="dt">optimizer =</span> <span class="kw"><a href="../reference/optimizer_rmsprop.html">optimizer_rmsprop</a></span>(),
    <span class="dt">metrics =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"mean_absolute_error"</span>)
  )
  
  model
}

model &lt;-<span class="st"> </span><span class="kw">build_model</span>()
model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>()</code></pre>
<pre><code>_____________________________________________________________________________________
Layer (type)                          Output Shape                      Param #      
=====================================================================================
dense_5 (Dense)                       (None, 64)                        896          
_____________________________________________________________________________________
dense_6 (Dense)                       (None, 64)                        4160         
_____________________________________________________________________________________
dense_7 (Dense)                       (None, 1)                         65           
=====================================================================================
Total params: 5,121
Trainable params: 5,121
Non-trainable params: 0
_____________________________________________________________________________________</code></pre>
</div>
<div id="train-the-model" class="section level2">
<h2>Train the model</h2>
<p>The model is trained for 500 epochs, recording training and validation accuracy in a <code>keras_training_history</code> object.
We also show how to use a custom callback, replacing the default training output by a single dot per epoch.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Display training progress by printing a single dot for each completed epoch.</span>
print_dot_callback &lt;-<span class="st"> </span><span class="kw"><a href="../reference/callback_lambda.html">callback_lambda</a></span>(
  <span class="dt">on_epoch_end =</span> <span class="cf">function</span>(epoch, logs) {
    <span class="cf">if</span> (epoch <span class="op">%%</span><span class="st"> </span><span class="dv">80</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)
    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"."</span>)
  }
)    

epochs &lt;-<span class="st"> </span><span class="dv">500</span>

<span class="co"># Fit the model and store training stats</span>
history &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/reexports.html">fit</a></span>(
  train_data,
  train_labels,
  <span class="dt">epochs =</span> epochs,
  <span class="dt">validation_split =</span> <span class="fl">0.2</span>,
  <span class="dt">verbose =</span> <span class="dv">0</span>,
  <span class="dt">callbacks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(print_dot_callback)
)</code></pre>
<p>Now, we visualize the model’s training progress using the metrics stored in the <code>history</code> variable. We want to use this data to determine how long to train before the model stops making progress.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(history, <span class="dt">metrics =</span> <span class="st">"mean_absolute_error"</span>, <span class="dt">smooth =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">5</span>))</code></pre>
<p><img src="images/boston_mae.png"></p>
<p>This graph shows little improvement in the model after about 200 epochs. Let’s update the <code>fit</code> method to automatically stop training when the validation score doesn’t improve. We’ll use a <a href="https://keras.rstudio.com/reference/callback_early_stopping.html">callback</a> that tests a training condition for every epoch. If a set amount of epochs elapses without showing improvement, it automatically stops the training.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The patience parameter is the amount of epochs to check for improvement.</span>
early_stop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/callback_early_stopping.html">callback_early_stopping</a></span>(<span class="dt">monitor =</span> <span class="st">"val_loss"</span>, <span class="dt">patience =</span> <span class="dv">20</span>)

model &lt;-<span class="st"> </span><span class="kw">build_model</span>()
history &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/reexports.html">fit</a></span>(
  train_data,
  train_labels,
  <span class="dt">epochs =</span> epochs,
  <span class="dt">validation_split =</span> <span class="fl">0.2</span>,
  <span class="dt">verbose =</span> <span class="dv">0</span>,
  <span class="dt">callbacks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(early_stop, print_dot_callback)
)

<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(history, <span class="dt">metrics =</span> <span class="st">"mean_absolute_error"</span>, <span class="dt">smooth =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/coord_cartesian">coord_cartesian</a></span>(<span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">5</span>))</code></pre>
<p><img src="images/boston_mae_earlystop.png"></p>
<p>The graph shows the average error is about $2,500 dollars. Is this good? Well, $2,500 is not an insignificant amount when some of the labels are only $15,000.</p>
<p>Let’s see how did the model performs on the test set:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(loss, mae) <span class="op">%&lt;-%</span><span class="st"> </span>(model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/reexports.html">evaluate</a></span>(test_data, test_labels, <span class="dt">verbose =</span> <span class="dv">0</span>))

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"Mean absolute error on test set: $"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(<span class="st">"%.2f"</span>, mae <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>))</code></pre>
<pre><code>[1] "Mean absolute error on test set: $3297.68"</code></pre>
</div>
<div id="predict" class="section level2">
<h2>Predict</h2>
<p>Finally, predict some housing prices using data in the testing set:</p>
<pre class="sourceCode r"><code class="sourceCode r">test_predictions &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(test_data)
test_predictions[ , <span class="dv">1</span>]</code></pre>
<pre><code> [1]  9.159314 17.955666 20.573296 31.487156 25.231384 18.803967 27.139153
 [8] 21.052799 18.904579 22.056618 19.140137 17.342262 15.233129 42.001091
[15] 19.280727 19.559774 27.276485 20.737257 19.391312 38.450863 12.431134
[22] 16.025173 19.910103 14.362184 20.846870 24.595688 31.234753 30.109112
[29] 11.271907 21.081585 18.724422 14.542423 33.109241 25.842684 18.071476
[36]  9.046785 14.701134 17.113651 21.169674 27.008324 29.676132 28.280304
[43] 15.355518 41.252007 29.731274 24.258526 25.582203 16.032135 24.014944
[50] 22.071520 35.658638 19.342590 13.662583 15.854269 34.375328 28.051319
[57] 13.002036 47.801872 33.513954 23.775620 25.214602 17.864346 14.284246
[64] 17.458893 22.757492 22.424841 13.578171 22.530212 15.667303  7.438343
[71] 38.318726 29.219141 25.282124 15.476329 24.670732 17.125381 20.079552
[78] 23.601147 34.540359 12.151771 19.177418 37.980789 15.576267 14.904464
[85] 17.581717 17.851192 20.480953 19.700697 21.921551 31.415789 19.116734
[92] 21.192280 24.934101 41.778465 35.113403 19.307007 35.754066 53.983509
[99] 26.797831 44.472233 32.520882 19.591730</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>This notebook introduced a few techniques to handle a regression problem.</p>
<ul>
<li>Mean Squared Error (MSE) is a common loss function used for regression problems (different than classification problems).</li>
<li>Similarly, evaluation metrics used for regression differ from classification. A common regression metric is Mean Absolute Error (MAE).</li>
<li>When input data features have values with different ranges, each feature should be scaled independently.</li>
<li>If there is not much training data, prefer a small network with few hidden layers to avoid overfitting.</li>
<li>Early stopping is a useful technique to prevent overfitting.</li>
</ul>
</div>
<div id="more-tutorials" class="section level2">
<h2>More Tutorials</h2>
<p>Check out these additional tutorials to learn more:</p>
<ul>
<li><p><a href="tutorial_basic_classification.html">Basic Classification</a> — In this tutorial, we train a neural network model to classify images of clothing, like sneakers and shirts.</p></li>
<li><p><a href="tutorial_basic_text_classification.html">Text Classification</a> — This tutorial classifies movie reviews as positive or negative using the text of the review.</p></li>
<li><p><a href="tutorial_overfit_underfit.html">Overfitting and Underfitting</a> — In this tutorial, we explore two common regularization techniques (weight regularization and dropout) and use them to improve our movie review classification results.</p></li>
<li><p><a href="tutorial_save_and_restore.html">Save and Restore Models</a> — This tutorial demonstrates various ways to save and share models (after as well as during training).</p></li>
</ul>
</div>
