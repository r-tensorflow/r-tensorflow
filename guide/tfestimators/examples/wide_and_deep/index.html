<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>wide_and_deep</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/guide/tfestimators/examples/wide_and_deep/><meta name=author content="J.J. Allaire"><meta property=og:url content=/guide/tfestimators/examples/wide_and_deep/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/tfestimators class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=search-button><i class="fa fa-lg fa-search"></i></div></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/tfestimators class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training with Keras</a></li></ul></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href=/guide/tfhub/examples/>Examples</a></li><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul><li><a href>Estimators</a></li><li><a href=/tfestimators>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/estimator_basics/>Estimator Basics</a></li><li><a href=/guide/tfestimators/input_functions/>Input Functions</a></li><li><a href=/guide/tfestimators/feature_columns/>Feature Columns</a></li><li><a href=/guide/tfestimators/tensorboard/>TensorBoard</a></li></ul><li><a href=/guide/tfestimators/creating_estimators/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/run_hooks/>Run Hooks</a></li><li><a href=/guide/tfestimators/creating_estimators/>Custom Estimators</a></li><li><a href=/guide/tfestimators/parsing_spec/>Parsing Utilities</a></li><li><a href=/guide/tfestimators/dataset_api/>Dataset API</a></li></ul><li><a href=/guide/tfestimators/examples>Examples</a></li></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/cloudml/>Cloud ML</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/cloudml/getting_started/>Getting Started</a></li><li><a href=/tools/cloudml/training/>Training with CloudML</a></li><li><a href=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/cloudml/storage/>Google Cloud Storage</a></li><li><a href=/tools/cloudml/deployment/>Deploying Models</a></li></ul><li><a href=/tools/tensorboard/>Tensorboard</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tensorboard/tensorboard/>Getting started</a></li><li><a href=/tools/tensorboard/hparams/>HParams Dashboard</a></li></ul></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/cloudml/>cloudml</a></li><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfestimators/>tfestimators</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a></li><li class=side-menu__item><a href=/guide/tfhub/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class=side-menu__item><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Estimators</p></span></li><li class=side-menu__item><a href=/tfestimators class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfestimators/creating_estimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class="side-menu__item active"><a href=/guide/tfestimators/examples class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a><ul class=side-menu__sub></ul></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class=side-menu__item><a href=/tools/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Cloud ML</p></a></li><li class=side-menu__item><a href=/tools/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Tensorboard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>cloudml</p></a></li><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfestimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfestimators</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>wide_and_deep</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><div class=source-ref><p><span class=caption>Source: </span><a href=https://github.com/rstudio/tfestimators/blob/master/vignettes/examples/wide_and_deep.R class=uri>https://github.com/rstudio/tfestimators/blob/master/vignettes/examples/wide_and_deep.R</a></p></div><p>In this example, we’ll introduce how to use the TensorFlow Estimators API to
jointly train a wide linear model and a deep feed-forward neural network.
This approach combines the strengths of memorization and generalization. It’s
useful for generic large-scale regression and classification problems with
sparse input features (e.g., categorical features with a large number of
possible feature values). If you’re interested in learning more about how
Wide &amp; Deep Learning works, please check out the <a href=http://arxiv.org/abs/1606.07792>white
paper</a>.</p><div class=figure><img src=https://www.tensorflow.org/images/wide_n_deep.svg alt><p class=caption>Wide &amp; Deep</p></div><p>The figure above shows a comparison of a wide model (logistic regression with
sparse features and transformations), a deep model (feed-forward neural
network with an embedding layer and several hidden layers), and a Wide &amp; Deep
model (joint training of both). At a high level, there are only 3 steps to
configure a wide, deep, or Wide &amp; Deep model using the TF Estimators API:</p><ul><li>Select features for the wide part: Choose the sparse base columns and
crossed columns you want to use. - Select features for the deep part: Choose
the continuous columns, the embedding dimension for each categorical column,
and the hidden layer sizes. - Put them all together in a Wide &amp; Deep model
(linear_dnn_combined_classifier).</li></ul><p>And that’s it! Let’s go through a simple example.</p><div id=download-data class="section level3"><h3>Download Data</h3><p>First of all, let’s download the census data:</p><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><span id=cb1-1><a href=#cb1-1></a><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tfestimators)</span>
<span id=cb1-2><a href=#cb1-2></a></span>
<span id=cb1-3><a href=#cb1-3></a>maybe_download_census &lt;-<span class=st> </span><span class=cf>function</span>(train_data_path, test_data_path, column_names_to_assign) {</span>
<span id=cb1-4><a href=#cb1-4></a>  trim_character_cols &lt;-<span class=st> </span><span class=cf>function</span>(df) {</span>
<span id=cb1-5><a href=#cb1-5></a>    df <span class=op>%&gt;%</span></span>
<span id=cb1-6><a href=#cb1-6></a><span class=st>      </span><span class=kw><a href=https://rdrr.io/r/base/lapply.html>lapply</a></span>(<span class=cf>function</span>(x) <span class=cf>if</span> (<span class=kw><a href=https://rdrr.io/r/base/character.html>is.character</a></span>(x)) <span class=kw><a href=https://rdrr.io/r/base/trimws.html>trimws</a></span>(x) <span class=cf>else</span> x) <span class=op>%&gt;%</span></span>
<span id=cb1-7><a href=#cb1-7></a><span class=st>      </span><span class=kw><a href=https://rdrr.io/r/base/data.frame.html>data.frame</a></span>(<span class=dt>stringsAsFactors =</span> <span class=ot>FALSE</span>)</span>
<span id=cb1-8><a href=#cb1-8></a>  }</span>
<span id=cb1-9><a href=#cb1-9></a>  </span>
<span id=cb1-10><a href=#cb1-10></a>  <span class=cf>if</span> (<span class=op>!</span><span class=kw><a href=https://rdrr.io/r/base/files.html>file.exists</a></span>(train_data_path) <span class=op>||</span><span class=st> </span><span class=op>!</span><span class=kw><a href=https://rdrr.io/r/base/files.html>file.exists</a></span>(test_data_path)) {</span>
<span id=cb1-11><a href=#cb1-11></a>    <span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>"Downloading census data ..."</span>)</span>
<span id=cb1-12><a href=#cb1-12></a>    train_data &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/utils/read.table.html>read.csv</a></span>(<span class=st>"https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data"</span>, <span class=dt>header =</span> <span class=ot>FALSE</span>, <span class=dt>skip =</span> <span class=dv>1</span>, </span>
<span id=cb1-13><a href=#cb1-13></a>                           <span class=dt>stringsAsFactors =</span> <span class=ot>FALSE</span>) <span class=op>%&gt;%</span></span>
<span id=cb1-14><a href=#cb1-14></a><span class=st>      </span><span class=kw>trim_character_cols</span>()</span>
<span id=cb1-15><a href=#cb1-15></a>    test_data &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/utils/read.table.html>read.csv</a></span>(<span class=st>"https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test"</span>, <span class=dt>header =</span> <span class=ot>FALSE</span>, <span class=dt>skip =</span> <span class=dv>1</span>,</span>
<span id=cb1-16><a href=#cb1-16></a>                          <span class=dt>stringsAsFactors =</span> <span class=ot>FALSE</span>) <span class=op>%&gt;%</span></span>
<span id=cb1-17><a href=#cb1-17></a><span class=st>      </span><span class=kw>trim_character_cols</span>()</span>
<span id=cb1-18><a href=#cb1-18></a>    <span class=kw><a href=https://rdrr.io/r/base/colnames.html>colnames</a></span>(train_data) &lt;-<span class=st> </span>column_names_to_assign</span>
<span id=cb1-19><a href=#cb1-19></a>    <span class=kw><a href=https://rdrr.io/r/base/colnames.html>colnames</a></span>(test_data) &lt;-<span class=st> </span>column_names_to_assign</span>
<span id=cb1-20><a href=#cb1-20></a>    <span class=kw><a href=https://rdrr.io/r/utils/write.table.html>write.csv</a></span>(train_data, train_data_path, <span class=dt>row.names =</span> <span class=ot>FALSE</span>)</span>
<span id=cb1-21><a href=#cb1-21></a>    <span class=kw><a href=https://rdrr.io/r/utils/write.table.html>write.csv</a></span>(test_data, test_data_path, <span class=dt>row.names =</span> <span class=ot>FALSE</span>)</span>
<span id=cb1-22><a href=#cb1-22></a>  } <span class=cf>else</span> {</span>
<span id=cb1-23><a href=#cb1-23></a>    train_data &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/utils/read.table.html>read.csv</a></span>(train_data_path, <span class=dt>header =</span> <span class=ot>TRUE</span>,</span>
<span id=cb1-24><a href=#cb1-24></a>                           <span class=dt>stringsAsFactors =</span> <span class=ot>FALSE</span>) <span class=op>%&gt;%</span></span>
<span id=cb1-25><a href=#cb1-25></a><span class=st>      </span><span class=kw>trim_character_cols</span>()</span>
<span id=cb1-26><a href=#cb1-26></a>    test_data &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/utils/read.table.html>read.csv</a></span>(test_data_path, <span class=dt>header =</span> <span class=ot>TRUE</span>,</span>
<span id=cb1-27><a href=#cb1-27></a>                          <span class=dt>stringsAsFactors =</span> <span class=ot>FALSE</span>) <span class=op>%&gt;%</span></span>
<span id=cb1-28><a href=#cb1-28></a><span class=st>      </span><span class=kw>trim_character_cols</span>()</span>
<span id=cb1-29><a href=#cb1-29></a>  }</span>
<span id=cb1-30><a href=#cb1-30></a>  <span class=kw><a href=https://rdrr.io/r/base/function.html>return</a></span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(<span class=dt>train_data =</span> train_data, <span class=dt>test_data =</span> test_data))</span>
<span id=cb1-31><a href=#cb1-31></a>}</span>
<span id=cb1-32><a href=#cb1-32></a></span>
<span id=cb1-33><a href=#cb1-33></a>COLNAMES &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>"age"</span>, <span class=st>"workclass"</span>, <span class=st>"fnlwgt"</span>, <span class=st>"education"</span>, <span class=st>"education_num"</span>, <span class=st>"marital_status"</span>, <span class=st>"occupation"</span>,</span>
<span id=cb1-34><a href=#cb1-34></a>              <span class=st>"relationship"</span>, <span class=st>"race"</span>, <span class=st>"sex"</span>, <span class=st>"capital_gain"</span>, <span class=st>"capital_loss"</span>, <span class=st>"hours_per_week"</span>, <span class=st>"native_country"</span>,</span>
<span id=cb1-35><a href=#cb1-35></a>              <span class=st>"income_bracket"</span>)</span>
<span id=cb1-36><a href=#cb1-36></a></span>
<span id=cb1-37><a href=#cb1-37></a>downloaded_data &lt;-<span class=st> </span><span class=kw>maybe_download_census</span>(</span>
<span id=cb1-38><a href=#cb1-38></a>  <span class=kw><a href=https://rdrr.io/r/base/file.path.html>file.path</a></span>(<span class=kw><a href=https://rdrr.io/r/base/getwd.html>getwd</a></span>(), <span class=st>"train_census.csv"</span>),</span>
<span id=cb1-39><a href=#cb1-39></a>  <span class=kw><a href=https://rdrr.io/r/base/file.path.html>file.path</a></span>(<span class=kw><a href=https://rdrr.io/r/base/getwd.html>getwd</a></span>(), <span class=st>"test_census.csv"</span>),</span>
<span id=cb1-40><a href=#cb1-40></a>  COLNAMES</span>
<span id=cb1-41><a href=#cb1-41></a>)</span>
<span id=cb1-42><a href=#cb1-42></a>train_data &lt;-<span class=st> </span>downloaded_data<span class=op>$</span>train_data</span>
<span id=cb1-43><a href=#cb1-43></a>test_data &lt;-<span class=st> </span>downloaded_data<span class=op>$</span>test_data</span></code></pre></div></div><div id=define-base-feature-columns class="section level3"><h3>Define Base Feature Columns</h3><p>Next, let’s define the base categorical and continuous feature columns that
we’ll use. These base columns will be the building blocks used by both the
wide part and the deep part of the model.</p><div class=sourceCode id=cb2><pre class="sourceCode r"><code class="sourceCode r"><span id=cb2-1><a href=#cb2-1></a>gender &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_vocabulary_list.html>column_categorical_with_vocabulary_list</a></span>(</span>
<span id=cb2-2><a href=#cb2-2></a>  <span class=st>"gender"</span>, <span class=dt>vocabulary_list =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>"Female"</span>, <span class=st>"Male"</span>))</span>
<span id=cb2-3><a href=#cb2-3></a>education &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_vocabulary_list.html>column_categorical_with_vocabulary_list</a></span>(</span>
<span id=cb2-4><a href=#cb2-4></a>  <span class=st>"education"</span>,</span>
<span id=cb2-5><a href=#cb2-5></a>  <span class=dt>vocabulary_list =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(</span>
<span id=cb2-6><a href=#cb2-6></a>    <span class=st>"Bachelors"</span>, <span class=st>"HS-grad"</span>, <span class=st>"11th"</span>, <span class=st>"Masters"</span>, <span class=st>"9th"</span>,</span>
<span id=cb2-7><a href=#cb2-7></a>    <span class=st>"Some-college"</span>, <span class=st>"Assoc-acdm"</span>, <span class=st>"Assoc-voc"</span>, <span class=st>"7th-8th"</span>,</span>
<span id=cb2-8><a href=#cb2-8></a>    <span class=st>"Doctorate"</span>, <span class=st>"Prof-school"</span>, <span class=st>"5th-6th"</span>, <span class=st>"10th"</span>, <span class=st>"1st-4th"</span>,</span>
<span id=cb2-9><a href=#cb2-9></a>    <span class=st>"Preschool"</span>, <span class=st>"12th"</span>))</span>
<span id=cb2-10><a href=#cb2-10></a>marital_status &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_vocabulary_list.html>column_categorical_with_vocabulary_list</a></span>(</span>
<span id=cb2-11><a href=#cb2-11></a>  <span class=st>"marital_status"</span>,</span>
<span id=cb2-12><a href=#cb2-12></a>  <span class=dt>vocabulary_list =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(</span>
<span id=cb2-13><a href=#cb2-13></a>    <span class=st>"Married-civ-spouse"</span>, <span class=st>"Divorced"</span>, <span class=st>"Married-spouse-absent"</span>,</span>
<span id=cb2-14><a href=#cb2-14></a>    <span class=st>"Never-married"</span>, <span class=st>"Separated"</span>, <span class=st>"Married-AF-spouse"</span>, <span class=st>"Widowed"</span>))</span>
<span id=cb2-15><a href=#cb2-15></a>relationship &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_vocabulary_list.html>column_categorical_with_vocabulary_list</a></span>(</span>
<span id=cb2-16><a href=#cb2-16></a>  <span class=st>"relationship"</span>,</span>
<span id=cb2-17><a href=#cb2-17></a>  <span class=dt>vocabulary_list =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(</span>
<span id=cb2-18><a href=#cb2-18></a>    <span class=st>"Husband"</span>, <span class=st>"Not-in-family"</span>, <span class=st>"Wife"</span>, <span class=st>"Own-child"</span>, <span class=st>"Unmarried"</span>,</span>
<span id=cb2-19><a href=#cb2-19></a>    <span class=st>"Other-relative"</span>))</span>
<span id=cb2-20><a href=#cb2-20></a>workclass &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_vocabulary_list.html>column_categorical_with_vocabulary_list</a></span>(</span>
<span id=cb2-21><a href=#cb2-21></a>  <span class=st>"workclass"</span>,</span>
<span id=cb2-22><a href=#cb2-22></a>  <span class=dt>vocabulary_list =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(</span>
<span id=cb2-23><a href=#cb2-23></a>    <span class=st>"Self-emp-not-inc"</span>, <span class=st>"Private"</span>, <span class=st>"State-gov"</span>, <span class=st>"Federal-gov"</span>,</span>
<span id=cb2-24><a href=#cb2-24></a>    <span class=st>"Local-gov"</span>, <span class=st>"?"</span>, <span class=st>"Self-emp-inc"</span>, <span class=st>"Without-pay"</span>, <span class=st>"Never-worked"</span>))</span>
<span id=cb2-25><a href=#cb2-25></a></span>
<span id=cb2-26><a href=#cb2-26></a><span class=co># To show an example of hashing:</span></span>
<span id=cb2-27><a href=#cb2-27></a>occupation &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_hash_bucket.html>column_categorical_with_hash_bucket</a></span>(</span>
<span id=cb2-28><a href=#cb2-28></a>  <span class=st>"occupation"</span>, <span class=dt>hash_bucket_size =</span> <span class=dv>1000</span>, <span class=dt>dtype =</span> tf<span class=op>$</span>string)</span>
<span id=cb2-29><a href=#cb2-29></a>native_country &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_categorical_with_hash_bucket.html>column_categorical_with_hash_bucket</a></span>(</span>
<span id=cb2-30><a href=#cb2-30></a>  <span class=st>"native_country"</span>, <span class=dt>hash_bucket_size =</span> <span class=dv>1000</span>, <span class=dt>dtype =</span> tf<span class=op>$</span>string)</span>
<span id=cb2-31><a href=#cb2-31></a></span>
<span id=cb2-32><a href=#cb2-32></a><span class=co># Continuous base columns.</span></span>
<span id=cb2-33><a href=#cb2-33></a>age &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_numeric.html>column_numeric</a></span>(<span class=st>"age"</span>)</span>
<span id=cb2-34><a href=#cb2-34></a>education_num &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_numeric.html>column_numeric</a></span>(<span class=st>"education_num"</span>)</span>
<span id=cb2-35><a href=#cb2-35></a>capital_gain &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_numeric.html>column_numeric</a></span>(<span class=st>"capital_gain"</span>)</span>
<span id=cb2-36><a href=#cb2-36></a>capital_loss &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_numeric.html>column_numeric</a></span>(<span class=st>"capital_loss"</span>)</span>
<span id=cb2-37><a href=#cb2-37></a>hours_per_week &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_numeric.html>column_numeric</a></span>(<span class=st>"hours_per_week"</span>)</span>
<span id=cb2-38><a href=#cb2-38></a></span>
<span id=cb2-39><a href=#cb2-39></a><span class=co># Transformations.</span></span>
<span id=cb2-40><a href=#cb2-40></a>age_buckets &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/column_bucketized.html>column_bucketized</a></span>(</span>
<span id=cb2-41><a href=#cb2-41></a>  age, <span class=dt>boundaries =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>18</span>, <span class=dv>25</span>, <span class=dv>30</span>, <span class=dv>35</span>, <span class=dv>40</span>, <span class=dv>45</span>, <span class=dv>50</span>, <span class=dv>55</span>, <span class=dv>60</span>, <span class=dv>65</span>))</span>
<span id=cb2-42><a href=#cb2-42></a></span>
<span id=cb2-43><a href=#cb2-43></a>base_columns &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(gender, native_country, education, occupation, workclass, relationship, age_buckets)</span></code></pre></div></div><div id=the-wide-model-linear-model-with-crossed-feature-columns class="section level3"><h3>The Wide Model: Linear Model with Crossed Feature Columns</h3><p>The wide model is a linear model with a wide set of sparse and crossed feature columns:</p><div class=sourceCode id=cb3><pre class="sourceCode r"><code class="sourceCode r"><span id=cb3-1><a href=#cb3-1></a>crossed_columns &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/feature_columns.html>feature_columns</a></span>(</span>
<span id=cb3-2><a href=#cb3-2></a>  native_country, education, occupation, workclass, relationship, age_buckets,</span>
<span id=cb3-3><a href=#cb3-3></a>  <span class=kw><a href=../../../tfestimators/reference/column_crossed.html>column_crossed</a></span>(<span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>"education"</span>, <span class=st>"occupation"</span>), <span class=dt>hash_bucket_size =</span> <span class=dv>10000</span>),</span>
<span id=cb3-4><a href=#cb3-4></a>  <span class=kw><a href=../../../tfestimators/reference/column_crossed.html>column_crossed</a></span>(<span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>"native_country"</span>, <span class=st>"occupation"</span>), <span class=dt>hash_bucket_size =</span> <span class=dv>10000</span>),</span>
<span id=cb3-5><a href=#cb3-5></a>  <span class=kw><a href=../../../tfestimators/reference/column_crossed.html>column_crossed</a></span>(<span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(age_buckets, <span class=st>"education"</span>, <span class=st>"occupation"</span>), <span class=dt>hash_bucket_size =</span> <span class=dv>10000</span>)</span>
<span id=cb3-6><a href=#cb3-6></a>)</span></code></pre></div><p>Wide models with crossed feature columns can memorize sparse interactions
between features effectively. That being said, one limitation of crossed
feature columns is that they do not generalize to feature combinations that
have not appeared in the training data. Let’s add a deep model with
embeddings to fix that.</p></div><div id=the-deep-model-neural-network-with-embeddings class="section level3"><h3>The Deep Model: Neural Network with Embeddings</h3><p>The deep model is a feed-forward neural network, as shown in the previous
figure. Each of the sparse, high-dimensional categorical features are first
converted into a low-dimensional and dense real-valued vector, often referred
to as an embedding vector. These low-dimensional dense embedding vectors are
concatenated with the continuous features, and then fed into the hidden
layers of a neural network in the forward pass. The embedding values are
initialized randomly, and are trained along with all other model parameters
to minimize the training loss. If you’re interested in learning more about
embeddings, check out the TensorFlow tutorial on Vector Representations of
Words, or Word Embedding on Wikipedia.</p><p>We’ll configure the embeddings for the categorical columns using
embedding_column, and concatenate them with the continuous columns:</p><div class=sourceCode id=cb4><pre class="sourceCode r"><code class="sourceCode r"><span id=cb4-1><a href=#cb4-1></a>deep_columns &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/feature_columns.html>feature_columns</a></span>(</span>
<span id=cb4-2><a href=#cb4-2></a>  <span class=kw><a href=../../../tfestimators/reference/column_embedding.html>column_embedding</a></span>(workclass, <span class=dt>dimension =</span> <span class=dv>8</span>),</span>
<span id=cb4-3><a href=#cb4-3></a>  <span class=kw><a href=../../../tfestimators/reference/column_embedding.html>column_embedding</a></span>(education, <span class=dt>dimension =</span> <span class=dv>8</span>),</span>
<span id=cb4-4><a href=#cb4-4></a>  <span class=kw><a href=../../../tfestimators/reference/column_embedding.html>column_embedding</a></span>(relationship, <span class=dt>dimension =</span> <span class=dv>8</span>),</span>
<span id=cb4-5><a href=#cb4-5></a>  <span class=kw><a href=../../../tfestimators/reference/column_embedding.html>column_embedding</a></span>(native_country, <span class=dt>dimension =</span> <span class=dv>8</span>),</span>
<span id=cb4-6><a href=#cb4-6></a>  <span class=kw><a href=../../../tfestimators/reference/column_embedding.html>column_embedding</a></span>(occupation, <span class=dt>dimension =</span> <span class=dv>8</span>),</span>
<span id=cb4-7><a href=#cb4-7></a>  age, </span>
<span id=cb4-8><a href=#cb4-8></a>  education_num, </span>
<span id=cb4-9><a href=#cb4-9></a>  capital_gain, </span>
<span id=cb4-10><a href=#cb4-10></a>  capital_loss,</span>
<span id=cb4-11><a href=#cb4-11></a>  hours_per_week</span>
<span id=cb4-12><a href=#cb4-12></a>)</span></code></pre></div><p>The higher the dimension of the embedding is, the more degrees of freedom the
model will have to learn the representations of the features. For simplicity,
we set the dimension to 8 for all feature columns here. Empirically, a more
informed decision for the number of dimensions is to start with a value on
the order of <span class="math inline">\(\log_2{n}\)</span> or <span class="math inline">\(k\sqrt[4]{n}\)</span>, where n is the number of unique features in a
feature column and k is a small constant (usually smaller than 10).</p><p>Through dense embeddings, deep models can generalize better and make
predictions on feature pairs that were previously unseen in the training
data. However, it is difficult to learn effective low-dimensional
representations for feature columns when the underlying interaction matrix
between two feature columns is sparse and high-rank. In such cases, the
interaction between most feature pairs should be zero except a few, but dense
embeddings will lead to nonzero predictions for all feature pairs, and thus
can over-generalize. On the other hand, linear models with crossed features
can memorize these “exception rules” effectively with fewer model parameters.
Now, let’s see how to jointly train wide and deep models and allow them to
complement each other’s strengths and weaknesses.</p></div><div id=combining-wide-and-deep-models-into-one class="section level3"><h3>Combining Wide and Deep Models into One</h3><p>The wide models and deep models are combined by summing up their final output
log odds as the prediction, then feeding the prediction to a logistic loss
function. All the graph definition and variable allocations have already been
handled for you under the hood, so you simply need to create a
dnn_linear_combined_classifier:</p><div class=sourceCode id=cb5><pre class="sourceCode r"><code class="sourceCode r"><span id=cb5-1><a href=#cb5-1></a>model &lt;-<span class=st> </span><span class=kw><a href=../../../tfestimators/reference/dnn_linear_combined_estimators.html>dnn_linear_combined_classifier</a></span>(</span>
<span id=cb5-2><a href=#cb5-2></a>  <span class=dt>linear_feature_columns =</span> crossed_columns,</span>
<span id=cb5-3><a href=#cb5-3></a>  <span class=dt>dnn_feature_columns =</span> deep_columns,</span>
<span id=cb5-4><a href=#cb5-4></a>  <span class=dt>dnn_hidden_units =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>100</span>, <span class=dv>50</span>)</span>
<span id=cb5-5><a href=#cb5-5></a>)</span></code></pre></div></div><div id=training-and-evaluating-the-model class="section level3"><h3>Training and Evaluating The Model</h3><div class=sourceCode id=cb6><pre class="sourceCode r"><code class="sourceCode r"><span id=cb6-1><a href=#cb6-1></a><span class=co># Build labels according to income bracket</span></span>
<span id=cb6-2><a href=#cb6-2></a>train_data<span class=op>$</span>income_bracket &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/character.html>as.character</a></span>(train_data<span class=op>$</span>income_bracket)</span>
<span id=cb6-3><a href=#cb6-3></a>test_data<span class=op>$</span>income_bracket &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/character.html>as.character</a></span>(test_data<span class=op>$</span>income_bracket)</span>
<span id=cb6-4><a href=#cb6-4></a>train_data<span class=op>$</span>label &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/ifelse.html>ifelse</a></span>(train_data<span class=op>$</span>income_bracket <span class=op>==</span><span class=st> "&gt;50K"</span>, <span class=dv>1</span>, <span class=dv>0</span>)</span>
<span id=cb6-5><a href=#cb6-5></a>test_data<span class=op>$</span>label &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/ifelse.html>ifelse</a></span>(test_data<span class=op>$</span>income_bracket <span class=op>==</span><span class=st> "&gt;50K"</span>, <span class=dv>1</span>, <span class=dv>0</span>)</span>
<span id=cb6-6><a href=#cb6-6></a></span>
<span id=cb6-7><a href=#cb6-7></a>constructed_input_fn &lt;-<span class=st> </span><span class=cf>function</span>(dataset) {</span>
<span id=cb6-8><a href=#cb6-8></a>  <span class=kw><a href=../../../tfestimators/reference/input_fn.html>input_fn</a></span>(dataset, <span class=dt>features =</span> <span class=op>-</span>label, <span class=dt>response =</span> label)</span>
<span id=cb6-9><a href=#cb6-9></a>}</span>
<span id=cb6-10><a href=#cb6-10></a>train_input_fn &lt;-<span class=st> </span><span class=kw>constructed_input_fn</span>(train_data)</span>
<span id=cb6-11><a href=#cb6-11></a>eval_input_fn &lt;-<span class=st> </span><span class=kw>constructed_input_fn</span>(test_data)</span>
<span id=cb6-12><a href=#cb6-12></a></span>
<span id=cb6-13><a href=#cb6-13></a><span class=kw><a href=../../../tfestimators/reference/reexports.html>train</a></span>(model, <span class=dt>input_fn =</span> train_input_fn, <span class=dt>steps =</span> <span class=dv>2</span>)</span>
<span id=cb6-14><a href=#cb6-14></a></span>
<span id=cb6-15><a href=#cb6-15></a><span class=kw><a href=../../../tfestimators/reference/reexports.html>evaluate</a></span>(model, <span class=dt>input_fn =</span> eval_input_fn, <span class=dt>steps =</span> <span class=dv>2</span>)</span></code></pre></div></div></div></div></div><footer>Copyright © 2015-2020 The TensorFlow Authors and RStudio, PBC.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>