<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>pretrained_word_embeddings</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/guide/keras/examples/pretrained_word_embeddings/><meta name=author content="J.J. Allaire"><meta property=og:url content=/guide/keras/examples/pretrained_word_embeddings/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/keras class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=search-button><i class="fa fa-lg fa-search"></i></div></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/keras class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training with Keras</a></li></ul></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href=/guide/tfhub/examples/>Examples</a></li><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul><li><a href>Estimators</a></li><li><a href=/tfestimators>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/estimator_basics/>Estimator Basics</a></li><li><a href=/guide/tfestimators/input_functions/>Input Functions</a></li><li><a href=/guide/tfestimators/feature_columns/>Feature Columns</a></li><li><a href=/guide/tfestimators/tensorboard/>TensorBoard</a></li></ul><li><a href=/guide/tfestimators/creating_estimators/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/run_hooks/>Run Hooks</a></li><li><a href=/guide/tfestimators/creating_estimators/>Custom Estimators</a></li><li><a href=/guide/tfestimators/parsing_spec/>Parsing Utilities</a></li><li><a href=/guide/tfestimators/dataset_api/>Dataset API</a></li></ul><li><a href=/guide/tfestimators/examples>Examples</a></li></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/cloudml/>Cloud ML</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/cloudml/getting_started/>Getting Started</a></li><li><a href=/tools/cloudml/training/>Training with CloudML</a></li><li><a href=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/cloudml/storage/>Google Cloud Storage</a></li><li><a href=/tools/cloudml/deployment/>Deploying Models</a></li></ul><li><a href=/tools/tensorboard/>Tensorboard</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tensorboard/tensorboard/>Getting started</a></li><li><a href=/tools/tensorboard/hparams/>HParams Dashboard</a></li></ul></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/cloudml/>cloudml</a></li><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfestimators/>tfestimators</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a></li><li class=side-menu__item><a href=/guide/tfhub/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class=side-menu__item><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Estimators</p></span></li><li class=side-menu__item><a href=/tfestimators class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfestimators/creating_estimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/tfestimators/examples class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class=side-menu__item><a href=/tools/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Cloud ML</p></a></li><li class=side-menu__item><a href=/tools/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Tensorboard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>cloudml</p></a></li><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfestimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfestimators</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>pretrained_word_embeddings</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><div class=source-ref><p><span class=caption>Source: </span><a href=https://github.com/rstudio/keras/blob/master/vignettes/examples/pretrained_word_embeddings.R class=uri>https://github.com/rstudio/keras/blob/master/vignettes/examples/pretrained_word_embeddings.R</a></p></div><p>This script loads pre-trained word embeddings (GloVe embeddings) into a
frozen Keras Embedding layer, and uses it to train a text classification
model on the 20 Newsgroup dataset (classication of newsgroup messages into 20
different categories).</p><p>GloVe embedding data can be found at:
<a href=http://nlp.stanford.edu/data/glove.6B.zip class=uri>http://nlp.stanford.edu/data/glove.6B.zip</a> (source page:
<a href=http://nlp.stanford.edu/projects/glove/ class=uri>http://nlp.stanford.edu/projects/glove/</a>)</p><p>20 Newsgroup data can be found at:
<a href=http://www.cs.cmu.edu/afs/cs.cmu.edu/project/theo-20/www/data/news20.html class=uri>http://www.cs.cmu.edu/afs/cs.cmu.edu/project/theo-20/www/data/news20.html</a></p><p>IMPORTANT NOTE: This example does yet work correctly. The code executes fine and
appears to mimic the Python code upon which it is based however it achieves only
half the training accuracy that the Python code does so there is clearly a
subtle difference.</p><p>We need to investigate this further before formally adding to the list of examples</p><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><span id=cb1-1><a href=#cb1-1></a><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(keras)</span>
<span id=cb1-2><a href=#cb1-2></a></span>
<span id=cb1-3><a href=#cb1-3></a>GLOVE_DIR &lt;-<span class=st> 'glove.6B'</span></span>
<span id=cb1-4><a href=#cb1-4></a>TEXT_DATA_DIR &lt;-<span class=st> '20_newsgroup'</span></span>
<span id=cb1-5><a href=#cb1-5></a>MAX_SEQUENCE_LENGTH &lt;-<span class=st> </span><span class=dv>1000</span></span>
<span id=cb1-6><a href=#cb1-6></a>MAX_NUM_WORDS &lt;-<span class=st> </span><span class=dv>20000</span></span>
<span id=cb1-7><a href=#cb1-7></a>EMBEDDING_DIM &lt;-<span class=st> </span><span class=dv>100</span></span>
<span id=cb1-8><a href=#cb1-8></a>VALIDATION_SPLIT &lt;-<span class=st> </span><span class=fl>0.2</span></span>
<span id=cb1-9><a href=#cb1-9></a></span>
<span id=cb1-10><a href=#cb1-10></a><span class=co># download data if necessary</span></span>
<span id=cb1-11><a href=#cb1-11></a>download_data &lt;-<span class=st> </span><span class=cf>function</span>(data_dir, url_path, data_file) {</span>
<span id=cb1-12><a href=#cb1-12></a>  <span class=cf>if</span> (<span class=op>!</span><span class=kw><a href=https://rdrr.io/r/base/files2.html>dir.exists</a></span>(data_dir)) {</span>
<span id=cb1-13><a href=#cb1-13></a>    <span class=kw><a href=https://rdrr.io/r/utils/download.file.html>download.file</a></span>(<span class=kw><a href=https://rdrr.io/r/base/paste.html>paste0</a></span>(url_path, data_file), data_file, <span class=dt>mode =</span> <span class=st>"wb"</span>)</span>
<span id=cb1-14><a href=#cb1-14></a>    <span class=cf>if</span> (tools<span class=op>::</span><span class=kw><a href=https://rdrr.io/r/tools/fileutils.html>file_ext</a></span>(data_file) <span class=op>==</span><span class=st> "zip"</span>)</span>
<span id=cb1-15><a href=#cb1-15></a>      <span class=kw><a href=https://rdrr.io/r/utils/unzip.html>unzip</a></span>(data_file, <span class=dt>exdir =</span> tools<span class=op>::</span><span class=kw><a href=https://rdrr.io/r/tools/fileutils.html>file_path_sans_ext</a></span>(data_file))</span>
<span id=cb1-16><a href=#cb1-16></a>    <span class=cf>else</span></span>
<span id=cb1-17><a href=#cb1-17></a>      <span class=kw><a href=https://rdrr.io/r/utils/untar.html>untar</a></span>(data_file)</span>
<span id=cb1-18><a href=#cb1-18></a>    <span class=kw><a href=https://rdrr.io/r/base/unlink.html>unlink</a></span>(data_file)</span>
<span id=cb1-19><a href=#cb1-19></a>  }</span>
<span id=cb1-20><a href=#cb1-20></a>}</span>
<span id=cb1-21><a href=#cb1-21></a><span class=kw>download_data</span>(GLOVE_DIR, <span class=st>'http://nlp.stanford.edu/data/'</span>, <span class=st>'glove.6B.zip'</span>)</span>
<span id=cb1-22><a href=#cb1-22></a><span class=kw>download_data</span>(TEXT_DATA_DIR, <span class=st>"http://www.cs.cmu.edu/afs/cs.cmu.edu/project/theo-20/www/data/"</span>, <span class=st>"news20.tar.gz"</span>)</span>
<span id=cb1-23><a href=#cb1-23></a></span>
<span id=cb1-24><a href=#cb1-24></a><span class=co># first, build index mapping words in the embeddings set</span></span>
<span id=cb1-25><a href=#cb1-25></a><span class=co># to their embedding vector</span></span>
<span id=cb1-26><a href=#cb1-26></a></span>
<span id=cb1-27><a href=#cb1-27></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Indexing word vectors.</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-28><a href=#cb1-28></a></span>
<span id=cb1-29><a href=#cb1-29></a>embeddings_index &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/environment.html>new.env</a></span>(<span class=dt>parent =</span> <span class=kw><a href=https://rdrr.io/r/base/environment.html>emptyenv</a></span>())</span>
<span id=cb1-30><a href=#cb1-30></a>lines &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/readLines.html>readLines</a></span>(<span class=kw><a href=https://rdrr.io/r/base/file.path.html>file.path</a></span>(GLOVE_DIR, <span class=st>'glove.6B.100d.txt'</span>))</span>
<span id=cb1-31><a href=#cb1-31></a><span class=cf>for</span> (line <span class=cf>in</span> lines) {</span>
<span id=cb1-32><a href=#cb1-32></a>  values &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/strsplit.html>strsplit</a></span>(line, <span class=st>' '</span>, <span class=dt>fixed =</span> <span class=ot>TRUE</span>)[[<span class=dv>1</span>]]</span>
<span id=cb1-33><a href=#cb1-33></a>  word &lt;-<span class=st> </span>values[[<span class=dv>1</span>]]</span>
<span id=cb1-34><a href=#cb1-34></a>  coefs &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(values[<span class=op>-</span><span class=dv>1</span>])</span>
<span id=cb1-35><a href=#cb1-35></a>  embeddings_index[[word]] &lt;-<span class=st> </span>coefs</span>
<span id=cb1-36><a href=#cb1-36></a>}</span>
<span id=cb1-37><a href=#cb1-37></a></span>
<span id=cb1-38><a href=#cb1-38></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=kw><a href=https://rdrr.io/r/base/sprintf.html>sprintf</a></span>(<span class=st>'Found %s word vectors.</span><span class=ch>\n</span><span class=st>'</span>, <span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(embeddings_index)))</span>
<span id=cb1-39><a href=#cb1-39></a></span>
<span id=cb1-40><a href=#cb1-40></a><span class=co># second, prepare text samples and their labels</span></span>
<span id=cb1-41><a href=#cb1-41></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Processing text dataset</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-42><a href=#cb1-42></a></span>
<span id=cb1-43><a href=#cb1-43></a>texts &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/character.html>character</a></span>()  <span class=co># text samples</span></span>
<span id=cb1-44><a href=#cb1-44></a>labels &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/integer.html>integer</a></span>() <span class=co># label ids</span></span>
<span id=cb1-45><a href=#cb1-45></a>labels_index &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>()  <span class=co># dictionary: label name to numeric id</span></span>
<span id=cb1-46><a href=#cb1-46></a></span>
<span id=cb1-47><a href=#cb1-47></a><span class=cf>for</span> (name <span class=cf>in</span> <span class=kw><a href=https://rdrr.io/r/base/list.files.html>list.files</a></span>(TEXT_DATA_DIR)) {</span>
<span id=cb1-48><a href=#cb1-48></a>  path &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/file.path.html>file.path</a></span>(TEXT_DATA_DIR, name)</span>
<span id=cb1-49><a href=#cb1-49></a>  <span class=cf>if</span> (<span class=kw><a href=https://rdrr.io/r/utils/filetest.html>file_test</a></span>(<span class=st>"-d"</span>, path)) {</span>
<span id=cb1-50><a href=#cb1-50></a>    label_id &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(labels_index)</span>
<span id=cb1-51><a href=#cb1-51></a>    labels_index[[name]] &lt;-<span class=st> </span>label_id</span>
<span id=cb1-52><a href=#cb1-52></a>    <span class=cf>for</span> (fname <span class=cf>in</span> <span class=kw><a href=https://rdrr.io/r/base/list.files.html>list.files</a></span>(path)) {</span>
<span id=cb1-53><a href=#cb1-53></a>      <span class=cf>if</span> (<span class=kw><a href=https://rdrr.io/r/base/grep.html>grepl</a></span>(<span class=st>"^[0-9]+$"</span>, fname)) {</span>
<span id=cb1-54><a href=#cb1-54></a>        fpath &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/file.path.html>file.path</a></span>(path, fname)</span>
<span id=cb1-55><a href=#cb1-55></a>        t &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/readLines.html>readLines</a></span>(fpath, <span class=dt>encoding =</span> <span class=st>"latin1"</span>)</span>
<span id=cb1-56><a href=#cb1-56></a>        t &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/paste.html>paste</a></span>(t, <span class=dt>collapse =</span> <span class=st>"</span><span class=ch>\n</span><span class=st>"</span>)</span>
<span id=cb1-57><a href=#cb1-57></a>        i &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/grep.html>regexpr</a></span>(<span class=dt>pattern =</span> <span class=st>'</span><span class=ch>\n\n</span><span class=st>'</span>, t, <span class=dt>fixed =</span> <span class=ot>TRUE</span>)[[<span class=dv>1</span>]]</span>
<span id=cb1-58><a href=#cb1-58></a>        <span class=cf>if</span> (i <span class=op>!=</span><span class=st> </span><span class=op>-</span>1L)</span>
<span id=cb1-59><a href=#cb1-59></a>          t &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/substr.html>substring</a></span>(t, i)</span>
<span id=cb1-60><a href=#cb1-60></a>        texts &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(texts, t)</span>
<span id=cb1-61><a href=#cb1-61></a>        labels &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(labels, label_id)</span>
<span id=cb1-62><a href=#cb1-62></a>      }</span>
<span id=cb1-63><a href=#cb1-63></a>    }</span>
<span id=cb1-64><a href=#cb1-64></a>  }</span>
<span id=cb1-65><a href=#cb1-65></a>}</span>
<span id=cb1-66><a href=#cb1-66></a></span>
<span id=cb1-67><a href=#cb1-67></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=kw><a href=https://rdrr.io/r/base/sprintf.html>sprintf</a></span>(<span class=st>'Found %s texts.</span><span class=ch>\n</span><span class=st>'</span>, <span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(texts)))</span>
<span id=cb1-68><a href=#cb1-68></a></span>
<span id=cb1-69><a href=#cb1-69></a><span class=co># finally, vectorize the text samples into a 2D integer tensor</span></span>
<span id=cb1-70><a href=#cb1-70></a>tokenizer &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/text_tokenizer.html>text_tokenizer</a></span>(<span class=dt>num_words=</span>MAX_NUM_WORDS)</span>
<span id=cb1-71><a href=#cb1-71></a>tokenizer <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/fit_text_tokenizer.html>fit_text_tokenizer</a></span>(texts)</span>
<span id=cb1-72><a href=#cb1-72></a></span>
<span id=cb1-73><a href=#cb1-73></a><span class=co># save the tokenizer in case we want to use it again</span></span>
<span id=cb1-74><a href=#cb1-74></a><span class=co># for prediction within another R session, see:</span></span>
<span id=cb1-75><a href=#cb1-75></a><span class=co># https://keras.rstudio.com/reference/save_text_tokenizer.html</span></span>
<span id=cb1-76><a href=#cb1-76></a><span class=kw><a href=../../../keras/reference/save_text_tokenizer.html>save_text_tokenizer</a></span>(tokenizer, <span class=st>"tokenizer"</span>)</span>
<span id=cb1-77><a href=#cb1-77></a></span>
<span id=cb1-78><a href=#cb1-78></a>sequences &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/texts_to_sequences.html>texts_to_sequences</a></span>(tokenizer, texts)</span>
<span id=cb1-79><a href=#cb1-79></a></span>
<span id=cb1-80><a href=#cb1-80></a>word_index &lt;-<span class=st> </span>tokenizer<span class=op>$</span>word_index</span>
<span id=cb1-81><a href=#cb1-81></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=kw><a href=https://rdrr.io/r/base/sprintf.html>sprintf</a></span>(<span class=st>'Found %s unique tokens.</span><span class=ch>\n</span><span class=st>'</span>, <span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(word_index)))</span>
<span id=cb1-82><a href=#cb1-82></a></span>
<span id=cb1-83><a href=#cb1-83></a>data &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/pad_sequences.html>pad_sequences</a></span>(sequences, <span class=dt>maxlen=</span>MAX_SEQUENCE_LENGTH)</span>
<span id=cb1-84><a href=#cb1-84></a>labels &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/to_categorical.html>to_categorical</a></span>(labels)</span>
<span id=cb1-85><a href=#cb1-85></a></span>
<span id=cb1-86><a href=#cb1-86></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Shape of data tensor: '</span>, <span class=kw><a href=https://rdrr.io/r/base/dim.html>dim</a></span>(data), <span class=st>'</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-87><a href=#cb1-87></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Shape of label tensor: '</span>, <span class=kw><a href=https://rdrr.io/r/base/dim.html>dim</a></span>(labels), <span class=st>'</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-88><a href=#cb1-88></a></span>
<span id=cb1-89><a href=#cb1-89></a><span class=co># split the data into a training set and a validation set</span></span>
<span id=cb1-90><a href=#cb1-90></a>indices &lt;-<span class=st> </span><span class=dv>1</span><span class=op>:</span><span class=kw><a href=https://rdrr.io/r/base/nrow.html>nrow</a></span>(data)</span>
<span id=cb1-91><a href=#cb1-91></a>indices &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/sample.html>sample</a></span>(indices)</span>
<span id=cb1-92><a href=#cb1-92></a>data &lt;-<span class=st> </span>data[indices,]</span>
<span id=cb1-93><a href=#cb1-93></a>labels &lt;-<span class=st> </span>labels[indices,]</span>
<span id=cb1-94><a href=#cb1-94></a>num_validation_samples &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/integer.html>as.integer</a></span>(VALIDATION_SPLIT <span class=op>*</span><span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/nrow.html>nrow</a></span>(data))</span>
<span id=cb1-95><a href=#cb1-95></a></span>
<span id=cb1-96><a href=#cb1-96></a>x_train &lt;-<span class=st> </span>data[<span class=op>-</span>(<span class=dv>1</span><span class=op>:</span>num_validation_samples),]</span>
<span id=cb1-97><a href=#cb1-97></a>y_train &lt;-<span class=st> </span>labels[<span class=op>-</span>(<span class=dv>1</span><span class=op>:</span>num_validation_samples),]</span>
<span id=cb1-98><a href=#cb1-98></a>x_val &lt;-<span class=st> </span>data[<span class=dv>1</span><span class=op>:</span>num_validation_samples,]</span>
<span id=cb1-99><a href=#cb1-99></a>y_val &lt;-<span class=st> </span>labels[<span class=dv>1</span><span class=op>:</span>num_validation_samples,]</span>
<span id=cb1-100><a href=#cb1-100></a></span>
<span id=cb1-101><a href=#cb1-101></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Preparing embedding matrix.</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-102><a href=#cb1-102></a></span>
<span id=cb1-103><a href=#cb1-103></a><span class=co># prepare embedding matrix</span></span>
<span id=cb1-104><a href=#cb1-104></a>num_words &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/Extremes.html>min</a></span>(MAX_NUM_WORDS, <span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(word_index) <span class=op>+</span><span class=st> </span><span class=dv>1</span>)</span>
<span id=cb1-105><a href=#cb1-105></a>prepare_embedding_matrix &lt;-<span class=st> </span><span class=cf>function</span>() {</span>
<span id=cb1-106><a href=#cb1-106></a>  embedding_matrix &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/matrix.html>matrix</a></span>(0L, <span class=dt>nrow =</span> num_words, <span class=dt>ncol =</span> EMBEDDING_DIM)</span>
<span id=cb1-107><a href=#cb1-107></a>  <span class=cf>for</span> (word <span class=cf>in</span> <span class=kw><a href=https://rdrr.io/r/base/names.html>names</a></span>(word_index)) {</span>
<span id=cb1-108><a href=#cb1-108></a>    index &lt;-<span class=st> </span>word_index[[word]]</span>
<span id=cb1-109><a href=#cb1-109></a>    <span class=cf>if</span> (index <span class=op>&gt;=</span><span class=st> </span>MAX_NUM_WORDS)</span>
<span id=cb1-110><a href=#cb1-110></a>      <span class=cf>next</span></span>
<span id=cb1-111><a href=#cb1-111></a>    embedding_vector &lt;-<span class=st> </span>embeddings_index[[word]]</span>
<span id=cb1-112><a href=#cb1-112></a>    <span class=cf>if</span> (<span class=op>!</span><span class=kw><a href=https://rdrr.io/r/base/NULL.html>is.null</a></span>(embedding_vector)) {</span>
<span id=cb1-113><a href=#cb1-113></a>      <span class=co># words not found in embedding index will be all-zeros.</span></span>
<span id=cb1-114><a href=#cb1-114></a>      embedding_matrix[index,] &lt;-<span class=st> </span>embedding_vector</span>
<span id=cb1-115><a href=#cb1-115></a>    }</span>
<span id=cb1-116><a href=#cb1-116></a>  }</span>
<span id=cb1-117><a href=#cb1-117></a>  embedding_matrix</span>
<span id=cb1-118><a href=#cb1-118></a>}</span>
<span id=cb1-119><a href=#cb1-119></a></span>
<span id=cb1-120><a href=#cb1-120></a>embedding_matrix &lt;-<span class=st> </span><span class=kw>prepare_embedding_matrix</span>()</span>
<span id=cb1-121><a href=#cb1-121></a></span>
<span id=cb1-122><a href=#cb1-122></a><span class=co># load pre-trained word embeddings into an Embedding layer</span></span>
<span id=cb1-123><a href=#cb1-123></a><span class=co># note that we set trainable = False so as to keep the embeddings fixed</span></span>
<span id=cb1-124><a href=#cb1-124></a>embedding_layer &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/layer_embedding.html>layer_embedding</a></span>(</span>
<span id=cb1-125><a href=#cb1-125></a>  <span class=dt>input_dim =</span> num_words,</span>
<span id=cb1-126><a href=#cb1-126></a>  <span class=dt>output_dim =</span> EMBEDDING_DIM,</span>
<span id=cb1-127><a href=#cb1-127></a>  <span class=dt>weights =</span> <span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(embedding_matrix),</span>
<span id=cb1-128><a href=#cb1-128></a>  <span class=dt>input_length =</span> MAX_SEQUENCE_LENGTH,</span>
<span id=cb1-129><a href=#cb1-129></a>  <span class=dt>trainable =</span> <span class=ot>FALSE</span></span>
<span id=cb1-130><a href=#cb1-130></a>)</span>
<span id=cb1-131><a href=#cb1-131></a>                           </span>
<span id=cb1-132><a href=#cb1-132></a><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=st>'Training model</span><span class=ch>\n</span><span class=st>'</span>)</span>
<span id=cb1-133><a href=#cb1-133></a></span>
<span id=cb1-134><a href=#cb1-134></a><span class=co># train a 1D convnet with global maxpooling</span></span>
<span id=cb1-135><a href=#cb1-135></a>sequence_input &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/layer_input.html>layer_input</a></span>(<span class=dt>shape =</span> <span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(MAX_SEQUENCE_LENGTH), <span class=dt>dtype=</span><span class=st>'int32'</span>)</span>
<span id=cb1-136><a href=#cb1-136></a></span>
<span id=cb1-137><a href=#cb1-137></a>preds &lt;-<span class=st> </span>sequence_input <span class=op>%&gt;%</span></span>
<span id=cb1-138><a href=#cb1-138></a><span class=st>  </span>embedding_layer <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-139><a href=#cb1-139></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_conv_1d.html>layer_conv_1d</a></span>(<span class=dt>filters =</span> <span class=dv>128</span>, <span class=dt>kernel_size =</span> <span class=dv>5</span>, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-140><a href=#cb1-140></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_max_pooling_1d.html>layer_max_pooling_1d</a></span>(<span class=dt>pool_size =</span> <span class=dv>5</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-141><a href=#cb1-141></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_conv_1d.html>layer_conv_1d</a></span>(<span class=dt>filters =</span> <span class=dv>128</span>, <span class=dt>kernel_size =</span> <span class=dv>5</span>, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-142><a href=#cb1-142></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_max_pooling_1d.html>layer_max_pooling_1d</a></span>(<span class=dt>pool_size =</span> <span class=dv>5</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-143><a href=#cb1-143></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_conv_1d.html>layer_conv_1d</a></span>(<span class=dt>filters =</span> <span class=dv>128</span>, <span class=dt>kernel_size =</span> <span class=dv>5</span>, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-144><a href=#cb1-144></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_max_pooling_1d.html>layer_max_pooling_1d</a></span>(<span class=dt>pool_size =</span> <span class=dv>35</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-145><a href=#cb1-145></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_flatten.html>layer_flatten</a></span>() <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-146><a href=#cb1-146></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> <span class=dv>128</span>, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></span>
<span id=cb1-147><a href=#cb1-147></a><span class=st>  </span><span class=kw><a href=../../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> <span class=kw><a href=https://rdrr.io/r/base/length.html>length</a></span>(labels_index), <span class=dt>activation =</span> <span class=st>'softmax'</span>)</span>
<span id=cb1-148><a href=#cb1-148></a></span>
<span id=cb1-149><a href=#cb1-149></a></span>
<span id=cb1-150><a href=#cb1-150></a>model &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/keras_model.html>keras_model</a></span>(sequence_input, preds)</span>
<span id=cb1-151><a href=#cb1-151></a></span>
<span id=cb1-152><a href=#cb1-152></a>model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>compile</a></span>(</span>
<span id=cb1-153><a href=#cb1-153></a>  <span class=dt>loss =</span> <span class=st>'categorical_crossentropy'</span>,</span>
<span id=cb1-154><a href=#cb1-154></a>  <span class=dt>optimizer =</span> <span class=st>'rmsprop'</span>,</span>
<span id=cb1-155><a href=#cb1-155></a>  <span class=dt>metrics =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>'acc'</span>)  </span>
<span id=cb1-156><a href=#cb1-156></a>)</span>
<span id=cb1-157><a href=#cb1-157></a></span>
<span id=cb1-158><a href=#cb1-158></a>model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>fit</a></span>(</span>
<span id=cb1-159><a href=#cb1-159></a>  x_train, y_train,</span>
<span id=cb1-160><a href=#cb1-160></a>  <span class=dt>batch_size =</span> <span class=dv>128</span>,</span>
<span id=cb1-161><a href=#cb1-161></a>  <span class=dt>epochs =</span> <span class=dv>10</span>,</span>
<span id=cb1-162><a href=#cb1-162></a>  <span class=dt>validation_data =</span> <span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(x_val, y_val)</span>
<span id=cb1-163><a href=#cb1-163></a>)</span></code></pre></div></div></div></div><footer>Copyright  2015-2020 The TensorFlow Authors and RStudio, PBC.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>