<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>mnist_tfrecord</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/guide/keras/examples/mnist_tfrecord/><meta name=author content="J.J. Allaire"><meta property=og:url content=/guide/keras/examples/mnist_tfrecord/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/keras class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=search-button><i class="fa fa-lg fa-search"></i></div></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/keras class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training with Keras</a></li></ul></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href=/guide/tfhub/examples/>Examples</a></li><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/cloudml/>Cloud ML</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/cloudml/getting_started/>Getting Started</a></li><li><a href=/tools/cloudml/training/>Training with CloudML</a></li><li><a href=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/cloudml/storage/>Google Cloud Storage</a></li><li><a href=/tools/cloudml/deployment/>Deploying Models</a></li></ul><li><a href=/tools/tensorboard/tensorboard/>TensorBoard</a></li></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/cloudml/>cloudml</a></li><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a></li><li class=side-menu__item><a href=/guide/tfhub/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class=side-menu__item><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class=side-menu__item><a href=/tools/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Cloud ML</p></a></li><li class=side-menu__item><a href=/tools/tensorboard/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorBoard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>cloudml</p></a></li><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>mnist_tfrecord</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><div class=source-ref><p><span class=caption>Source: </span><a href=https://github.com/rstudio/keras/blob/master/vignettes/examples/mnist_tfrecord.R class=uri>https://github.com/rstudio/keras/blob/master/vignettes/examples/mnist_tfrecord.R</a></p></div><p>MNIST dataset with TFRecords, the standard TensorFlow data format.</p><p>TFRecord is a data format supported throughout TensorFlow. This example
demonstrates how to load TFRecord data using Input Tensors. Input Tensors
differ from the normal Keras workflow because instead of fitting to data
loaded into a a numpy array, data is supplied via a special tensor that reads
data from nodes that are wired directly into model graph with the
<code><a href=../../../keras/reference/layer_input.html>layer_input(tensor=input_tensor)</a></code> parameter.</p><p>There are several advantages to using Input Tensors. First, if a dataset is
already in TFRecord format you can load and train on that data directly in
Keras. Second, extended backend API capabilities such as TensorFlow data
augmentation is easy to integrate directly into your Keras training scripts
via input tensors. Third, TensorFlow implements several data APIs for
TFRecords, some of which provide significantly faster training performance
than numpy arrays can provide because they run via the C++ backend. Please
note that this example is tailored for brevity and clarity and not to
demonstrate performance or augmentation capabilities.</p><p>Input Tensors also have important disadvantages. In particular, Input Tensors
are fixed at model construction because rewiring networks is not yet
supported. For this reason, changing the data input source means model
weights must be saved and the model rebuilt from scratch to connect the new
input data. validation cannot currently be performed as training progresses,
and must be performed after training completes. This example demonstrates how
to train with input tensors, save the model weights, and then evaluate the
model using the standard Keras API.</p><p>Gets to ~99.1% validation accuracy after 5 epochs (there is still a lot of margin
for parameter tuning).</p><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb1-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(keras)</a>
<a class=sourceLine id=cb1-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tensorflow)</a>
<a class=sourceLine id=cb1-3 data-line-number=3></a>
<a class=sourceLine id=cb1-4 data-line-number=4><span class=cf>if</span> (<span class=kw><a href=../../../keras/reference/k_backend.html>k_backend</a></span>() <span class=op>!=</span><span class=st> 'tensorflow'</span>) {</a>
<a class=sourceLine id=cb1-5 data-line-number=5>  <span class=kw><a href=https://rdrr.io/r/base/stop.html>stop</a></span>(<span class=st>'This example can only run with the '</span>,</a>
<a class=sourceLine id=cb1-6 data-line-number=6>       <span class=st>'TensorFlow backend, '</span>,</a>
<a class=sourceLine id=cb1-7 data-line-number=7>       <span class=st>'because it requires TFRecords, which '</span>,</a>
<a class=sourceLine id=cb1-8 data-line-number=8>       <span class=st>'are not supported on other platforms.'</span>)</a>
<a class=sourceLine id=cb1-9 data-line-number=9>}</a>
<a class=sourceLine id=cb1-10 data-line-number=10></a>
<a class=sourceLine id=cb1-11 data-line-number=11><span class=co># Define Model -------------------------------------------------------------------</span></a>
<a class=sourceLine id=cb1-12 data-line-number=12></a>
<a class=sourceLine id=cb1-13 data-line-number=13>cnn_layers &lt;-<span class=st> </span><span class=cf>function</span>(x_train_input) {</a>
<a class=sourceLine id=cb1-14 data-line-number=14>  x_train_input <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-15 data-line-number=15><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_conv_2d.html>layer_conv_2d</a></span>(<span class=dt>filters =</span> <span class=dv>32</span>, <span class=dt>kernel_size =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>3</span>,<span class=dv>3</span>), </a>
<a class=sourceLine id=cb1-16 data-line-number=16>                  <span class=dt>activation =</span> <span class=st>'relu'</span>, <span class=dt>padding =</span> <span class=st>'valid'</span>) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-17 data-line-number=17><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_max_pooling_2d.html>layer_max_pooling_2d</a></span>(<span class=dt>pool_size =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>2</span>,<span class=dv>2</span>)) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-18 data-line-number=18><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_conv_2d.html>layer_conv_2d</a></span>(<span class=dt>filters =</span> <span class=dv>64</span>, <span class=dt>kernel_size =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>3</span>,<span class=dv>3</span>), <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-19 data-line-number=19><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_max_pooling_2d.html>layer_max_pooling_2d</a></span>(<span class=dt>pool_size =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=dv>2</span>,<span class=dv>2</span>)) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-20 data-line-number=20><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_flatten.html>layer_flatten</a></span>() <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-21 data-line-number=21><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> <span class=dv>512</span>, <span class=dt>activation =</span> <span class=st>'relu'</span>) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-22 data-line-number=22><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_dropout.html>layer_dropout</a></span>(<span class=dt>rate =</span> <span class=fl>0.5</span>) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb1-23 data-line-number=23><span class=st>    </span><span class=kw><a href=../../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> classes, <span class=dt>activation =</span> <span class=st>'softmax'</span>, <span class=dt>name =</span> <span class=st>'x_train_out'</span>)</a>
<a class=sourceLine id=cb1-24 data-line-number=24>}</a>
<a class=sourceLine id=cb1-25 data-line-number=25></a>
<a class=sourceLine id=cb1-26 data-line-number=26>sess &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/k_get_session.html>k_get_session</a></span>()</a>
<a class=sourceLine id=cb1-27 data-line-number=27></a>
<a class=sourceLine id=cb1-28 data-line-number=28><span class=co># Data Preparation --------------------------------------------------------------</span></a>
<a class=sourceLine id=cb1-29 data-line-number=29></a>
<a class=sourceLine id=cb1-30 data-line-number=30>batch_size &lt;-<span class=st> </span>128L</a>
<a class=sourceLine id=cb1-31 data-line-number=31>batch_shape =<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(batch_size, 28L, 28L, 1L)</a>
<a class=sourceLine id=cb1-32 data-line-number=32>steps_per_epoch &lt;-<span class=st> </span>469L</a>
<a class=sourceLine id=cb1-33 data-line-number=33>epochs &lt;-<span class=st> </span>5L</a>
<a class=sourceLine id=cb1-34 data-line-number=34>classes &lt;-<span class=st> </span>10L</a>
<a class=sourceLine id=cb1-35 data-line-number=35></a>
<a class=sourceLine id=cb1-36 data-line-number=36><span class=co># The capacity variable controls the maximum queue size</span></a>
<a class=sourceLine id=cb1-37 data-line-number=37><span class=co># allowed when prefetching data for training.</span></a>
<a class=sourceLine id=cb1-38 data-line-number=38>capacity &lt;-<span class=st> </span>10000L</a>
<a class=sourceLine id=cb1-39 data-line-number=39></a>
<a class=sourceLine id=cb1-40 data-line-number=40><span class=co># min_after_dequeue is the minimum number elements in the queue</span></a>
<a class=sourceLine id=cb1-41 data-line-number=41><span class=co># after a dequeue, which ensures sufficient mixing of elements.</span></a>
<a class=sourceLine id=cb1-42 data-line-number=42>min_after_dequeue &lt;-<span class=st> </span>3000L</a>
<a class=sourceLine id=cb1-43 data-line-number=43></a>
<a class=sourceLine id=cb1-44 data-line-number=44><span class=co># If `enqueue_many` is `FALSE`, `tensors` is assumed to represent a</span></a>
<a class=sourceLine id=cb1-45 data-line-number=45><span class=co># single example.  An input tensor with shape `(x, y, z)` will be output</span></a>
<a class=sourceLine id=cb1-46 data-line-number=46><span class=co># as a tensor with shape `(batch_size, x, y, z)`.</span></a>
<a class=sourceLine id=cb1-47 data-line-number=47><span class=co>#</span></a>
<a class=sourceLine id=cb1-48 data-line-number=48><span class=co># If `enqueue_many` is `TRUE`, `tensors` is assumed to represent a</span></a>
<a class=sourceLine id=cb1-49 data-line-number=49><span class=co># batch of examples, where the first dimension is indexed by example,</span></a>
<a class=sourceLine id=cb1-50 data-line-number=50><span class=co># and all members of `tensors` should have the same size in the</span></a>
<a class=sourceLine id=cb1-51 data-line-number=51><span class=co># first dimension.  If an input tensor has shape `(*, x, y, z)`, the</span></a>
<a class=sourceLine id=cb1-52 data-line-number=52><span class=co># output will have shape `(batch_size, x, y, z)`.</span></a>
<a class=sourceLine id=cb1-53 data-line-number=53>enqueue_many &lt;-<span class=st> </span><span class=ot>TRUE</span></a>
<a class=sourceLine id=cb1-54 data-line-number=54></a>
<a class=sourceLine id=cb1-55 data-line-number=55><span class=co># mnist dataset from tf contrib</span></a>
<a class=sourceLine id=cb1-56 data-line-number=56>mnist &lt;-<span class=st> </span>tf<span class=op>$</span>contrib<span class=op>$</span>learn<span class=op>$</span>datasets<span class=op>$</span>mnist</a>
<a class=sourceLine id=cb1-57 data-line-number=57>data &lt;-<span class=st> </span>mnist<span class=op>$</span><span class=kw>load_mnist</span>()</a>
<a class=sourceLine id=cb1-58 data-line-number=58></a>
<a class=sourceLine id=cb1-59 data-line-number=59>train_data &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>shuffle_batch</span>(</a>
<a class=sourceLine id=cb1-60 data-line-number=60>  <span class=dt>tensors =</span> <span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(data<span class=op>$</span>train<span class=op>$</span>images, data<span class=op>$</span>train<span class=op>$</span>labels),</a>
<a class=sourceLine id=cb1-61 data-line-number=61>  <span class=dt>batch_size =</span> batch_size,</a>
<a class=sourceLine id=cb1-62 data-line-number=62>  <span class=dt>capacity =</span> capacity,</a>
<a class=sourceLine id=cb1-63 data-line-number=63>  <span class=dt>min_after_dequeue =</span> min_after_dequeue,</a>
<a class=sourceLine id=cb1-64 data-line-number=64>  <span class=dt>enqueue_many =</span> enqueue_many,</a>
<a class=sourceLine id=cb1-65 data-line-number=65>  <span class=dt>num_threads =</span> 8L</a>
<a class=sourceLine id=cb1-66 data-line-number=66>)</a>
<a class=sourceLine id=cb1-67 data-line-number=67>x_train_batch &lt;-<span class=st> </span>train_data[[<span class=dv>1</span>]]</a>
<a class=sourceLine id=cb1-68 data-line-number=68>y_train_batch &lt;-<span class=st> </span>train_data[[<span class=dv>2</span>]]</a>
<a class=sourceLine id=cb1-69 data-line-number=69></a>
<a class=sourceLine id=cb1-70 data-line-number=70>x_train_batch &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>cast</span>(x_train_batch, tf<span class=op>$</span>float32)</a>
<a class=sourceLine id=cb1-71 data-line-number=71>x_train_batch &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/stats/reshape.html>reshape</a></span>(x_train_batch, <span class=dt>shape =</span> batch_shape)</a>
<a class=sourceLine id=cb1-72 data-line-number=72></a>
<a class=sourceLine id=cb1-73 data-line-number=73>y_train_batch &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>cast</span>(y_train_batch, tf<span class=op>$</span>int32)</a>
<a class=sourceLine id=cb1-74 data-line-number=74>y_train_batch &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>one_hot</span>(y_train_batch, classes)</a>
<a class=sourceLine id=cb1-75 data-line-number=75></a>
<a class=sourceLine id=cb1-76 data-line-number=76>x_batch_shape &lt;-<span class=st> </span>x_train_batch<span class=op>$</span><span class=kw>get_shape</span>()<span class=op>$</span><span class=kw>as_list</span>()</a>
<a class=sourceLine id=cb1-77 data-line-number=77>y_batch_shape =<span class=st> </span>y_train_batch<span class=op>$</span><span class=kw>get_shape</span>()<span class=op>$</span><span class=kw>as_list</span>()</a>
<a class=sourceLine id=cb1-78 data-line-number=78></a>
<a class=sourceLine id=cb1-79 data-line-number=79>x_train_input &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/layer_input.html>layer_input</a></span>(<span class=dt>tensor =</span> x_train_batch, <span class=dt>batch_shape =</span> x_batch_shape)</a>
<a class=sourceLine id=cb1-80 data-line-number=80>x_train_out &lt;-<span class=st> </span><span class=kw>cnn_layers</span>(x_train_input)</a>
<a class=sourceLine id=cb1-81 data-line-number=81></a>
<a class=sourceLine id=cb1-82 data-line-number=82><span class=co># Training &amp; Evaluation ---------------------------------------------------------</span></a>
<a class=sourceLine id=cb1-83 data-line-number=83></a>
<a class=sourceLine id=cb1-84 data-line-number=84>train_model =<span class=st> </span><span class=kw><a href=../../../keras/reference/keras_model.html>keras_model</a></span>(<span class=dt>inputs =</span> x_train_input, <span class=dt>outputs =</span> x_train_out)</a>
<a class=sourceLine id=cb1-85 data-line-number=85></a>
<a class=sourceLine id=cb1-86 data-line-number=86><span class=co># Pass the target tensor `y_train_batch` to `compile`</span></a>
<a class=sourceLine id=cb1-87 data-line-number=87><span class=co># via the `target_tensors` keyword argument:</span></a>
<a class=sourceLine id=cb1-88 data-line-number=88>train_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>compile</a></span>(</a>
<a class=sourceLine id=cb1-89 data-line-number=89>  <span class=dt>optimizer =</span> <span class=kw><a href=../../../keras/reference/optimizer_rmsprop.html>optimizer_rmsprop</a></span>(<span class=dt>lr =</span> <span class=fl>2e-3</span>, <span class=dt>decay =</span> <span class=fl>1e-5</span>),</a>
<a class=sourceLine id=cb1-90 data-line-number=90>  <span class=dt>loss =</span> <span class=st>'categorical_crossentropy'</span>,</a>
<a class=sourceLine id=cb1-91 data-line-number=91>  <span class=dt>metrics =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>'accuracy'</span>),</a>
<a class=sourceLine id=cb1-92 data-line-number=92>  <span class=dt>target_tensors =</span> y_train_batch</a>
<a class=sourceLine id=cb1-93 data-line-number=93>)</a>
<a class=sourceLine id=cb1-94 data-line-number=94></a>
<a class=sourceLine id=cb1-95 data-line-number=95><span class=kw><a href=https://rdrr.io/r/base/summary.html>summary</a></span>(train_model)</a>
<a class=sourceLine id=cb1-96 data-line-number=96></a>
<a class=sourceLine id=cb1-97 data-line-number=97><span class=co># Fit the model using data from the TFRecord data tensors.</span></a>
<a class=sourceLine id=cb1-98 data-line-number=98>coord &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Coordinator</span>()</a>
<a class=sourceLine id=cb1-99 data-line-number=99>threads =<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>start_queue_runners</span>(sess, coord)</a>
<a class=sourceLine id=cb1-100 data-line-number=100></a>
<a class=sourceLine id=cb1-101 data-line-number=101>train_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>fit</a></span>(</a>
<a class=sourceLine id=cb1-102 data-line-number=102>  <span class=dt>epochs =</span> epochs,</a>
<a class=sourceLine id=cb1-103 data-line-number=103>  <span class=dt>steps_per_epoch =</span> steps_per_epoch</a>
<a class=sourceLine id=cb1-104 data-line-number=104>)</a>
<a class=sourceLine id=cb1-105 data-line-number=105></a>
<a class=sourceLine id=cb1-106 data-line-number=106><span class=co># Save the model weights.</span></a>
<a class=sourceLine id=cb1-107 data-line-number=107>train_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/save_model_weights_hdf5.html>save_model_weights_hdf5</a></span>(<span class=st>'saved_wt.h5'</span>)</a>
<a class=sourceLine id=cb1-108 data-line-number=108></a>
<a class=sourceLine id=cb1-109 data-line-number=109><span class=co># Clean up the TF session.</span></a>
<a class=sourceLine id=cb1-110 data-line-number=110>coord<span class=op>$</span><span class=kw>request_stop</span>()</a>
<a class=sourceLine id=cb1-111 data-line-number=111>coord<span class=op>$</span><span class=kw>join</span>(threads)</a>
<a class=sourceLine id=cb1-112 data-line-number=112><span class=kw><a href=../../../keras/reference/k_clear_session.html>k_clear_session</a></span>()</a>
<a class=sourceLine id=cb1-113 data-line-number=113></a>
<a class=sourceLine id=cb1-114 data-line-number=114><span class=co># Second Session to test loading trained model without tensors</span></a>
<a class=sourceLine id=cb1-115 data-line-number=115>x_test &lt;-<span class=st> </span>data<span class=op>$</span>validation<span class=op>$</span>images</a>
<a class=sourceLine id=cb1-116 data-line-number=116>x_test &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>array_reshape</a></span>(x_test, <span class=dt>dim =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=kw><a href=https://rdrr.io/r/base/nrow.html>nrow</a></span>(x_test), <span class=dv>28</span>, <span class=dv>28</span>, <span class=dv>1</span>))</a>
<a class=sourceLine id=cb1-117 data-line-number=117>y_test &lt;-<span class=st> </span>data<span class=op>$</span>validation<span class=op>$</span>labels</a>
<a class=sourceLine id=cb1-118 data-line-number=118>x_test_inp &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/layer_input.html>layer_input</a></span>(<span class=dt>shape =</span> <span class=kw><a href=https://rdrr.io/r/base/dim.html>dim</a></span>(x_test)[<span class=op>-</span><span class=dv>1</span>])</a>
<a class=sourceLine id=cb1-119 data-line-number=119>test_out &lt;-<span class=st> </span><span class=kw>cnn_layers</span>(x_test_inp)</a>
<a class=sourceLine id=cb1-120 data-line-number=120>test_model &lt;-<span class=st> </span><span class=kw><a href=../../../keras/reference/keras_model.html>keras_model</a></span>(<span class=dt>inputs =</span> x_test_inp, <span class=dt>outputs =</span> test_out)</a>
<a class=sourceLine id=cb1-121 data-line-number=121>test_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/save_model_weights_hdf5.html>load_model_weights_hdf5</a></span>(<span class=st>'saved_wt.h5'</span>)</a>
<a class=sourceLine id=cb1-122 data-line-number=122>test_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>compile</a></span>(</a>
<a class=sourceLine id=cb1-123 data-line-number=123>  <span class=dt>optimizer =</span> <span class=st>'rmsprop'</span>, </a>
<a class=sourceLine id=cb1-124 data-line-number=124>  <span class=dt>loss =</span> <span class=st>'categorical_crossentropy'</span>, </a>
<a class=sourceLine id=cb1-125 data-line-number=125>  <span class=dt>metrics =</span> <span class=kw><a href=https://rdrr.io/r/base/c.html>c</a></span>(<span class=st>'accuracy'</span>)</a>
<a class=sourceLine id=cb1-126 data-line-number=126>)</a>
<a class=sourceLine id=cb1-127 data-line-number=127><span class=kw><a href=https://rdrr.io/r/base/summary.html>summary</a></span>(test_model)</a>
<a class=sourceLine id=cb1-128 data-line-number=128></a>
<a class=sourceLine id=cb1-129 data-line-number=129>result &lt;-<span class=st> </span>test_model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../../keras/reference/reexports.html>evaluate</a></span>(x_test, <span class=kw><a href=../../../keras/reference/to_categorical.html>to_categorical</a></span>(y_test, classes))</a>
<a class=sourceLine id=cb1-130 data-line-number=130><span class=kw><a href=https://rdrr.io/r/base/cat.html>cat</a></span>(<span class=kw><a href=https://rdrr.io/r/base/sprintf.html>sprintf</a></span>(<span class=st>'</span><span class=ch>\n</span><span class=st>Test accuracy: %f'</span>, result<span class=op>$</span>acc))</a></code></pre></div></div></div></div><footer>Copyright © 2015-2019 The TensorFlow Authors and RStudio, Inc.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>