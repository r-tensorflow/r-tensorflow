<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>Checkpoints</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/guide/saving/checkpoints/><meta name=author content="J.J. Allaire"><meta property=og:url content=/guide/saving/checkpoints/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-20375833-3');</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/tfhub class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=search-button><i class="fa fa-lg fa-search"></i></div></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/tfhub class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a></li></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href=/guide/tfhub/examples/>Examples</a></li><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul><li><a href>Estimators</a></li><li><a href=/tfestimators>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/estimator_basics/>Estimator Basics</a></li><li><a href=/guide/tfestimators/input_functions/>Input Functions</a></li><li><a href=/guide/tfestimators/feature_columns/>Feature Columns</a></li><li><a href=/guide/tfestimators/tensorboard/>TensorBoard</a></li></ul><li><a href=/guide/tfestimators/creating_estimators/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfestimators/run_hooks/>Run Hooks</a></li><li><a href=/guide/tfestimators/creating_estimators/>Custom Estimators</a></li><li><a href=/guide/tfestimators/parsing_spec/>Parsing Utilities</a></li><li><a href=/guide/tfestimators/dataset_api/>Dataset API</a></li></ul><li><a href=/guide/tfestimators/examples>Examples</a></li></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/cloudml/>Cloud ML</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/cloudml/getting_started/>Getting Started</a></li><li><a href=/tools/cloudml/training/>Training with CloudML</a></li><li><a href=/tools/cloudml/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/cloudml/storage/>Google Cloud Storage</a></li><li><a href=/tools/cloudml/deployment/>Deploying Models</a></li></ul><li><a href=/tools/tensorboard/>Tensorboard</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tensorboard/tensorboard/>Getting started</a></li><li><a href=/tools/tensorboard/hparams/>HParams Dashboard</a></li></ul></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/cloudml/>cloudml</a></li><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfestimators/>tfestimators</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a></li><li class=side-menu__item><a href=/guide/tfhub/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class="side-menu__item active"><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a><ul class=side-menu__sub><span style=display:none>guide</span><li class="side-menu__sub__item active"><a id=menu-link-/guide/saving/checkpoints/ class=side-menu__sub__item__text href=/guide/saving/checkpoints/ data-url=/guide/saving/checkpoints/>Checkpoints</a></li></ul></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Estimators</p></span></li><li class=side-menu__item><a href=/tfestimators class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tfestimators/creating_estimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/tfestimators/examples class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class=side-menu__item><a href=/tools/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Cloud ML</p></a></li><li class=side-menu__item><a href=/tools/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Tensorboard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/cloudml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>cloudml</p></a></li><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfestimators/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfestimators</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>Checkpoints</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><p>The phrase “Saving a TensorFlow model” typically means one of two things:</p><ul><li>Checkpoints, OR</li><li>SavedModel.</li></ul><p>Checkpoints capture the exact value of all parameters (<code>tf$Variable</code> objects) used by a model. Checkpoints do not contain any description of the computation defined by the model and thus are typically only useful when source code that will use the saved parameter values is available.</p><p>The <code>SavedModel</code> format on the other hand includes a serialized description of the computation defined by the model in addition to the parameter values (checkpoint). Models in this format are independent of the source code that created the model. They are thus suitable for deployment via TensorFlow Serving, TensorFlow Lite, TensorFlow.js, or programs in other programming languages (the C, C++, Java, Go, Rust, C# etc. TensorFlow APIs).</p><p>This guide covers APIs for writing and reading checkpoints.</p><div id=setup class="section level2"><h2>Setup</h2><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb1-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(keras)</a>
<a class=sourceLine id=cb1-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tensorflow)</a>
<a class=sourceLine id=cb1-3 data-line-number=3></a>
<a class=sourceLine id=cb1-4 data-line-number=4><span class=co># A simple linear model</span></a>
<a class=sourceLine id=cb1-5 data-line-number=5>create_model &lt;-<span class=st> </span><span class=cf>function</span>(size) {</a>
<a class=sourceLine id=cb1-6 data-line-number=6>  <span class=kw><a href=../../keras/reference/keras_model_custom.html>keras_model_custom</a></span>(<span class=dt>name =</span> <span class=st>"linear_model"</span>, <span class=cf>function</span>(self) {</a>
<a class=sourceLine id=cb1-7 data-line-number=7>    </a>
<a class=sourceLine id=cb1-8 data-line-number=8>    self<span class=op>$</span>l1 &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> size)</a>
<a class=sourceLine id=cb1-9 data-line-number=9>    </a>
<a class=sourceLine id=cb1-10 data-line-number=10>    <span class=cf>function</span>(inputs, <span class=dt>mask =</span> <span class=ot>NULL</span>) {</a>
<a class=sourceLine id=cb1-11 data-line-number=11>      self<span class=op>$</span><span class=kw>l1</span>(inputs)</a>
<a class=sourceLine id=cb1-12 data-line-number=12>    }</a>
<a class=sourceLine id=cb1-13 data-line-number=13>  })</a>
<a class=sourceLine id=cb1-14 data-line-number=14>}</a>
<a class=sourceLine id=cb1-15 data-line-number=15></a>
<a class=sourceLine id=cb1-16 data-line-number=16>model &lt;-<span class=st> </span><span class=kw>create_model</span>(<span class=dv>5</span>)</a></code></pre></div></div><div id=saving-models-through-the-keras-api class="section level2"><h2>Saving models through the Keras API</h2><p>The respective <a href=/guide/keras/saving_serializing>Keras guide</a> explains how to use the Keras API to save and restore complete models as well as model weights.</p><p>Calling <code>save_weights</code> effectively results in saving a TensorFlow checkpoint:</p><div class=sourceCode id=cb2><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb2-1 data-line-number=1>model <span class=op>%&gt;%</span><span class=st> </span><span class=kw><a href=../../keras/reference/save_model_weights_tf.html>save_model_weights_tf</a></span>(<span class=st>"weights_only"</span>)</a></code></pre></div><p>More customization is available through lower-level TensorFlow methods.</p></div><div id=writing-checkpoints class="section level2"><h2>Writing checkpoints</h2><p>The persistent state of a TensorFlow model is stored in <code>tf$Variable</code> objects. These can be constructed directly, but are often created through high-level APIs like Keras layers or models.</p><p>The easiest way to manage variables is by attaching them to Python objects, then referencing those objects.</p><p>Subclasses of <code>tf$train$Checkpoint</code>, <code>tf$keras$layers$Layer</code>, and <code>tf$keras$Model</code> automatically track variables assigned to their attributes. The following example constructs a simple linear model, then writes checkpoints which contain values for all of the model’s variables.</p><div id=manual-checkpointing class="section level3"><h3>Manual checkpointing</h3><div id=setup-1 class="section level4"><h4>Setup</h4><p>To help demonstrate all the features of <code>tf$train$Checkpoint</code>, define a toy dataset and an optimization step:</p><div class=sourceCode id=cb3><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb3-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tfdatasets)</a>
<a class=sourceLine id=cb3-2 data-line-number=2>toy_dataset &lt;-<span class=st> </span><span class=cf>function</span>() {</a>
<a class=sourceLine id=cb3-3 data-line-number=3>  inputs &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/matrix.html>matrix</a></span>(<span class=dv>0</span><span class=op>:</span><span class=dv>9</span>, <span class=dt>ncol =</span> <span class=dv>1</span>) <span class=op>%&gt;%</span><span class=st> </span>tf<span class=op>$</span><span class=kw>cast</span>(tf<span class=op>$</span>float32)</a>
<a class=sourceLine id=cb3-4 data-line-number=4>  labels &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/matrix.html>matrix</a></span>(<span class=dv>0</span><span class=op>:</span><span class=dv>49</span>, <span class=dt>ncol =</span> <span class=dv>5</span>, <span class=dt>byrow =</span> <span class=ot>TRUE</span>) <span class=op>%&gt;%</span><span class=st> </span>tf<span class=op>$</span><span class=kw>cast</span>(tf<span class=op>$</span>float32)</a>
<a class=sourceLine id=cb3-5 data-line-number=5>  <span class=kw><a href=../../tools/tfdatasets/reference/tensor_slices_dataset.html>tensor_slices_dataset</a></span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(<span class=dt>x =</span> inputs, <span class=dt>y =</span> labels)) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb3-6 data-line-number=6><span class=st>    </span><span class=kw><a href=../../tools/tfdatasets/reference/dataset_repeat.html>dataset_repeat</a></span>(<span class=dv>10</span>) <span class=op>%&gt;%</span></a>
<a class=sourceLine id=cb3-7 data-line-number=7><span class=st>    </span><span class=kw><a href=../../tools/tfdatasets/reference/dataset_batch.html>dataset_batch</a></span>(<span class=dv>2</span>)</a>
<a class=sourceLine id=cb3-8 data-line-number=8>}</a>
<a class=sourceLine id=cb3-9 data-line-number=9></a>
<a class=sourceLine id=cb3-10 data-line-number=10>train_step &lt;-<span class=st> </span><span class=cf>function</span>(model, example, optimizer) {</a>
<a class=sourceLine id=cb3-11 data-line-number=11>  <span class=kw><a href=https://rdrr.io/r/base/with.html>with</a></span>(tf<span class=op>$</span><span class=kw>GradientTape</span>() <span class=op>%as%</span><span class=st> </span>tape, {</a>
<a class=sourceLine id=cb3-12 data-line-number=12>    output &lt;-<span class=st> </span><span class=kw>model</span>(example<span class=op>$</span>x)</a>
<a class=sourceLine id=cb3-13 data-line-number=13>    loss &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>reduce_mean</span>(tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/MathFun.html>abs</a></span>(output <span class=op>-</span><span class=st> </span>example<span class=op>$</span>y))</a>
<a class=sourceLine id=cb3-14 data-line-number=14>  })</a>
<a class=sourceLine id=cb3-15 data-line-number=15>  variables &lt;-<span class=st> </span>model<span class=op>$</span>trainable_variables</a>
<a class=sourceLine id=cb3-16 data-line-number=16>  gradients &lt;-<span class=st> </span>tape<span class=op>$</span><span class=kw>gradient</span>(loss, variables)</a>
<a class=sourceLine id=cb3-17 data-line-number=17>  optimizer<span class=op>$</span><span class=kw>apply_gradients</span>(purrr<span class=op>::</span><span class=kw><a href=https://purrr.tidyverse.org/reference/transpose.html>transpose</a></span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(gradients, variables)))</a>
<a class=sourceLine id=cb3-18 data-line-number=18>  loss</a>
<a class=sourceLine id=cb3-19 data-line-number=19>}</a></code></pre></div></div><div id=create-the-checkpoint-objects class="section level4"><h4>Create the checkpoint objects</h4><p>To manually make a checkpoint you will need a <code>tf$train$Checkpoint</code> object. Where the objects you want to checkpoint are set as attributes on the object.</p><p>A <code>tf$train$CheckpointManager</code> can also be helpful for managing multiple checkpoints.</p><div class=sourceCode id=cb4><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb4-1 data-line-number=1>opt &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/optimizer_adam.html>optimizer_adam</a></span>(<span class=fl>0.1</span>)</a>
<a class=sourceLine id=cb4-2 data-line-number=2>ckpt &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>(<span class=dt>step =</span> tf<span class=op>$</span><span class=kw>Variable</span>(<span class=dv>1</span>), <span class=dt>optimizer =</span> opt, <span class=dt>net =</span> model)</a>
<a class=sourceLine id=cb4-3 data-line-number=3>manager &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>CheckpointManager</span>(ckpt, <span class=st>'./tf_ckpts'</span>, <span class=dt>max_to_keep =</span> <span class=dv>3</span>)</a></code></pre></div></div><div id=train-and-checkpoint-the-model class="section level4"><h4>Train and checkpoint the model</h4><p>The following training loop creates an instance of the model and of an optimizer, then gathers them into a <code>tf$train$Checkpoint</code> object. It calls the training step in a loop on each batch of data, and periodically writes checkpoints to disk.</p><div class=sourceCode id=cb5><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb5-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(glue)</a>
<a class=sourceLine id=cb5-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tfautograph)</a>
<a class=sourceLine id=cb5-3 data-line-number=3></a>
<a class=sourceLine id=cb5-4 data-line-number=4>train_and_checkpoint &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/pkg/tfautograph/man/autograph.html>autograph</a></span>(<span class=cf>function</span>(model, manager, dataset) {</a>
<a class=sourceLine id=cb5-5 data-line-number=5>  </a>
<a class=sourceLine id=cb5-6 data-line-number=6>  ckpt<span class=op>$</span><span class=kw>restore</span>(manager<span class=op>$</span>latest_checkpoint)</a>
<a class=sourceLine id=cb5-7 data-line-number=7>  <span class=cf>if</span> (<span class=op>!</span><span class=kw><a href=https://rdrr.io/r/base/NULL.html>is.null</a></span>(manager<span class=op>$</span>latest_checkpoint)) {</a>
<a class=sourceLine id=cb5-8 data-line-number=8>    tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/print.html>print</a></span>(<span class=kw><a href=https://rdrr.io/pkg/glue/man/glue.html>glue</a></span>(<span class=st>"Restored from {manager$latest_checkpoint}</span><span class=ch>\n</span><span class=st>"</span>))</a>
<a class=sourceLine id=cb5-9 data-line-number=9>  } <span class=cf>else</span> {</a>
<a class=sourceLine id=cb5-10 data-line-number=10>    tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/print.html>print</a></span>(<span class=st>"Initializing from scratch.</span><span class=ch>\n</span><span class=st>"</span>)</a>
<a class=sourceLine id=cb5-11 data-line-number=11>  }</a>
<a class=sourceLine id=cb5-12 data-line-number=12></a>
<a class=sourceLine id=cb5-13 data-line-number=13>  <span class=cf>for</span> (example <span class=cf>in</span> <span class=kw>dataset</span>()) {</a>
<a class=sourceLine id=cb5-14 data-line-number=14>    loss &lt;-<span class=st> </span><span class=kw>train_step</span>(model, example, opt)</a>
<a class=sourceLine id=cb5-15 data-line-number=15>    ckpt<span class=op>$</span>step<span class=op>$</span><span class=kw>assign_add</span>(<span class=dv>1</span>)</a>
<a class=sourceLine id=cb5-16 data-line-number=16>    <span class=cf>if</span> (ckpt<span class=op>$</span>step <span class=op>%%</span><span class=st> </span><span class=dv>10</span> <span class=op>==</span><span class=st> </span><span class=dv>0</span>) {</a>
<a class=sourceLine id=cb5-17 data-line-number=17>      save_path &lt;-<span class=st> </span>manager<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/save.html>save</a></span>()</a>
<a class=sourceLine id=cb5-18 data-line-number=18>      tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/print.html>print</a></span>(<span class=kw><a href=https://rdrr.io/pkg/glue/man/glue.html>glue</a></span>(<span class=st>"Saved checkpoint for step {as.numeric(ckpt$step)}: {as.character(save_path)}"</span>))</a>
<a class=sourceLine id=cb5-19 data-line-number=19>      tf<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/print.html>print</a></span>(<span class=kw><a href=https://rdrr.io/pkg/glue/man/glue.html>glue</a></span>(<span class=st>"loss: {round(as.numeric(loss), 2)}"</span>))</a>
<a class=sourceLine id=cb5-20 data-line-number=20>    }</a>
<a class=sourceLine id=cb5-21 data-line-number=21>  }</a>
<a class=sourceLine id=cb5-22 data-line-number=22>})</a>
<a class=sourceLine id=cb5-23 data-line-number=23></a>
<a class=sourceLine id=cb5-24 data-line-number=24><span class=kw>train_and_checkpoint</span>(model, manager, toy_dataset)</a></code></pre></div></div><div id=restore-and-continue-training class="section level4"><h4>Restore and continue training</h4><p>After the first you can pass a new model and manager, but pickup training exactly where you left off:</p><div class=sourceCode id=cb6><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb6-1 data-line-number=1>opt &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/optimizer_adam.html>optimizer_adam</a></span>(<span class=fl>0.1</span>)</a>
<a class=sourceLine id=cb6-2 data-line-number=2>net &lt;-<span class=st> </span><span class=kw>create_model</span>(<span class=dv>5</span>)</a>
<a class=sourceLine id=cb6-3 data-line-number=3>ckpt &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>(<span class=dt>step =</span> tf<span class=op>$</span><span class=kw>Variable</span>(<span class=dv>1</span>), <span class=dt>optimizer =</span> opt, <span class=dt>net =</span> net)</a>
<a class=sourceLine id=cb6-4 data-line-number=4>manager &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>CheckpointManager</span>(ckpt, <span class=st>'./tf_ckpts'</span>, <span class=dt>max_to_keep =</span> <span class=dv>3</span>)</a>
<a class=sourceLine id=cb6-5 data-line-number=5></a>
<a class=sourceLine id=cb6-6 data-line-number=6><span class=kw>train_and_checkpoint</span>(net, manager, toy_dataset)</a></code></pre></div><p>The <code>tf$train$CheckpointManager</code> object deletes old checkpoints. Above it’s configured to keep only the three most recent checkpoints.</p><div class=sourceCode id=cb7><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb7-1 data-line-number=1>manager<span class=op>$</span>checkpoints  <span class=co># List the three remaining checkpoints</span></a>
<a class=sourceLine id=cb7-2 data-line-number=2><span class=co>#&gt; [1] "./tf_ckpts/ckpt-18" "./tf_ckpts/ckpt-19" "./tf_ckpts/ckpt-20"</span></a></code></pre></div><p>These paths, e.g. ‘./tf_ckpts/ckpt-10’, are not files on disk. Instead they are prefixes for an index file and one or more data files which contain the variable values. These prefixes are grouped together in a single checkpoint file (‘./tf_ckpts/checkpoint’) where the <code>CheckpointManager</code> saves its state.</p><div class=sourceCode id=cb8><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb8-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/list.files.html>list.files</a></span>(<span class=st>"./tf_ckpts/"</span>)</a>
<a class=sourceLine id=cb8-2 data-line-number=2><span class=co>#&gt; [1] "checkpoint"                  "ckpt-18.data-00000-of-00001"</span></a>
<a class=sourceLine id=cb8-3 data-line-number=3><span class=co>#&gt; [3] "ckpt-18.index"               "ckpt-19.data-00000-of-00001"</span></a>
<a class=sourceLine id=cb8-4 data-line-number=4><span class=co>#&gt; [5] "ckpt-19.index"               "ckpt-20.data-00000-of-00001"</span></a>
<a class=sourceLine id=cb8-5 data-line-number=5><span class=co>#&gt; [7] "ckpt-20.index"</span></a></code></pre></div><p>TensorFlow matches variables to checkpointed values by traversing a directed graph with named edges, starting from the object being loaded. Edge names typically come from attribute names in objects, for example the “l1” in <code>self$l1 &lt;- layer_dense(units = size)</code>. <code>tf$train$Checkpoint</code> uses its keyword argument names, as in the “step” in <code>tf$train$CheckpointManager(step = ...)</code>.</p><p>The dependency graph from the example above looks like this:</p><p><img src=graph.svg></p><p>With the optimizer in red, regular variables in blue, and optimizer slot variables in orange. The other nodes, for example representing the <code>tf$train$Checkpoint</code>, are black.</p><p>Slot variables are part of the optimizer’s state, but are created for a specific variable. For example the <code>m</code> edges above correspond to momentum, which the Adam optimizer tracks for each variable. Slot variables are only saved in a checkpoint if the variable and the optimizer would both be saved, thus the dashed edges.</p><p>Calling <code>restore()</code> on a <code>tf$train$Checkpoint</code> object queues the requested restorations, restoring variable values as soon as there’s a matching path from the Checkpoint object. For example we can load just the kernel from the model we defined above by reconstructing one path to it through the network and the layer.</p><div class=sourceCode id=cb9><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb9-1 data-line-number=1>to_restore &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>Variable</span>(tf<span class=op>$</span><span class=kw>zeros</span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(5L)))</a>
<a class=sourceLine id=cb9-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(to_restore)  <span class=co># All zeros</span></a>
<a class=sourceLine id=cb9-3 data-line-number=3><span class=co>#&gt; [1] 0 0 0 0 0</span></a>
<a class=sourceLine id=cb9-4 data-line-number=4>fake_layer &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>(<span class=dt>bias =</span> to_restore)</a>
<a class=sourceLine id=cb9-5 data-line-number=5>fake_net &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>(<span class=dt>l1 =</span> fake_layer)</a>
<a class=sourceLine id=cb9-6 data-line-number=6>new_root &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>(<span class=dt>net =</span> fake_net)</a>
<a class=sourceLine id=cb9-7 data-line-number=7>status &lt;-<span class=st> </span>new_root<span class=op>$</span><span class=kw>restore</span>(tf<span class=op>$</span>train<span class=op>$</span><span class=kw>latest_checkpoint</span>(<span class=st>'./tf_ckpts/'</span>))</a>
<a class=sourceLine id=cb9-8 data-line-number=8><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(to_restore)  <span class=co># We get the restored value now</span></a>
<a class=sourceLine id=cb9-9 data-line-number=9><span class=co>#&gt; [1] 0.0308778 1.0408185 1.9840808 2.9422886 3.9628119</span></a></code></pre></div><p>The dependency graph for these new objects is a much smaller subgraph of the larger checkpoint we wrote above. It includes only the bias and a save counter that <code>tf$train$Checkpoint</code> uses to number checkpoints.</p><p><img src=small_graph.svg></p><p><code>restore()</code> returns a status object, which has optional assertions. All of the objects we’ve created in our new <code>Checkpoint</code> have been restored, so <code>status.assert_existing_objects_matched()</code> passes.</p><div class=sourceCode id=cb10><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb10-1 data-line-number=1>status<span class=op>$</span><span class=kw>assert_existing_objects_matched</span>()</a>
<a class=sourceLine id=cb10-2 data-line-number=2><span class=co>#&gt; &lt;tensorflow.python.training.tracking.util.CheckpointLoadStatus&gt;</span></a></code></pre></div><p>There are many objects in the checkpoint which haven’t matched, including the layer’s kernel and the optimizer’s variables. <code>status$assert_consumed()</code> only passes if the checkpoint and the program match exactly, and would throw an exception here.</p></div><div id=delayed-restorations class="section level4"><h4>Delayed restorations</h4><p>Layer objects in TensorFlow may delay the creation of variables to their first call, when input shapes are available. For example the shape of a Dense layer’s kernel depends on both the layer’s input and output shapes, and so the output shape required as a constructor argument is not enough information to create the variable on its own. Since calling a Layer also reads the variable’s value, a restore must happen between the variable’s creation and its first use.</p><p>To support this idiom, <code>tf$train$Checkpoint</code> queues restores which don’t yet have a matching variable.</p><div class=sourceCode id=cb11><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb11-1 data-line-number=1>delayed_restore &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>Variable</span>(tf<span class=op>$</span><span class=kw>zeros</span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(1L, 5L)))</a>
<a class=sourceLine id=cb11-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(delayed_restore)  <span class=co># Not restored; still zeros</span></a>
<a class=sourceLine id=cb11-3 data-line-number=3><span class=co>#&gt; [1] 0 0 0 0 0</span></a>
<a class=sourceLine id=cb11-4 data-line-number=4>fake_layer<span class=op>$</span>kernel &lt;-<span class=st> </span>delayed_restore</a>
<a class=sourceLine id=cb11-5 data-line-number=5><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(delayed_restore)  <span class=co># Restored</span></a>
<a class=sourceLine id=cb11-6 data-line-number=6><span class=co>#&gt; [1] 4.995093 4.982657 5.014721 5.007162 5.001130</span></a></code></pre></div></div><div id=manually-inspecting-checkpoints class="section level4"><h4>Manually inspecting checkpoints</h4><p><code>tf$train$list_variables</code> lists the checkpoint keys and shapes of variables in a checkpoint. Checkpoint keys are paths in the graph displayed above.</p><div class=sourceCode id=cb12><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb12-1 data-line-number=1>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>list_variables</span>(tf<span class=op>$</span>train<span class=op>$</span><span class=kw>latest_checkpoint</span>(<span class=st>'./tf_ckpts/'</span>))</a>
<a class=sourceLine id=cb12-2 data-line-number=2><span class=co>#&gt; [[1]]</span></a>
<a class=sourceLine id=cb12-3 data-line-number=3><span class=co>#&gt; [[1]][[1]]</span></a>
<a class=sourceLine id=cb12-4 data-line-number=4><span class=co>#&gt; [1] "_CHECKPOINTABLE_OBJECT_GRAPH"</span></a>
<a class=sourceLine id=cb12-5 data-line-number=5><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-6 data-line-number=6><span class=co>#&gt; [[1]][[2]]</span></a>
<a class=sourceLine id=cb12-7 data-line-number=7><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-8 data-line-number=8><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-9 data-line-number=9><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-10 data-line-number=10><span class=co>#&gt; [[2]]</span></a>
<a class=sourceLine id=cb12-11 data-line-number=11><span class=co>#&gt; [[2]][[1]]</span></a>
<a class=sourceLine id=cb12-12 data-line-number=12><span class=co>#&gt; [1] "net/l1/bias/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-13 data-line-number=13><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-14 data-line-number=14><span class=co>#&gt; [[2]][[2]]</span></a>
<a class=sourceLine id=cb12-15 data-line-number=15><span class=co>#&gt; [1] 5</span></a>
<a class=sourceLine id=cb12-16 data-line-number=16><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-17 data-line-number=17><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-18 data-line-number=18><span class=co>#&gt; [[3]]</span></a>
<a class=sourceLine id=cb12-19 data-line-number=19><span class=co>#&gt; [[3]][[1]]</span></a>
<a class=sourceLine id=cb12-20 data-line-number=20><span class=co>#&gt; [1] "net/l1/bias/.OPTIMIZER_SLOT/optimizer/m/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-21 data-line-number=21><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-22 data-line-number=22><span class=co>#&gt; [[3]][[2]]</span></a>
<a class=sourceLine id=cb12-23 data-line-number=23><span class=co>#&gt; [1] 5</span></a>
<a class=sourceLine id=cb12-24 data-line-number=24><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-25 data-line-number=25><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-26 data-line-number=26><span class=co>#&gt; [[4]]</span></a>
<a class=sourceLine id=cb12-27 data-line-number=27><span class=co>#&gt; [[4]][[1]]</span></a>
<a class=sourceLine id=cb12-28 data-line-number=28><span class=co>#&gt; [1] "net/l1/bias/.OPTIMIZER_SLOT/optimizer/v/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-29 data-line-number=29><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-30 data-line-number=30><span class=co>#&gt; [[4]][[2]]</span></a>
<a class=sourceLine id=cb12-31 data-line-number=31><span class=co>#&gt; [1] 5</span></a>
<a class=sourceLine id=cb12-32 data-line-number=32><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-33 data-line-number=33><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-34 data-line-number=34><span class=co>#&gt; [[5]]</span></a>
<a class=sourceLine id=cb12-35 data-line-number=35><span class=co>#&gt; [[5]][[1]]</span></a>
<a class=sourceLine id=cb12-36 data-line-number=36><span class=co>#&gt; [1] "net/l1/kernel/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-37 data-line-number=37><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-38 data-line-number=38><span class=co>#&gt; [[5]][[2]]</span></a>
<a class=sourceLine id=cb12-39 data-line-number=39><span class=co>#&gt; [1] 1 5</span></a>
<a class=sourceLine id=cb12-40 data-line-number=40><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-41 data-line-number=41><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-42 data-line-number=42><span class=co>#&gt; [[6]]</span></a>
<a class=sourceLine id=cb12-43 data-line-number=43><span class=co>#&gt; [[6]][[1]]</span></a>
<a class=sourceLine id=cb12-44 data-line-number=44><span class=co>#&gt; [1] "net/l1/kernel/.OPTIMIZER_SLOT/optimizer/m/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-45 data-line-number=45><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-46 data-line-number=46><span class=co>#&gt; [[6]][[2]]</span></a>
<a class=sourceLine id=cb12-47 data-line-number=47><span class=co>#&gt; [1] 1 5</span></a>
<a class=sourceLine id=cb12-48 data-line-number=48><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-49 data-line-number=49><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-50 data-line-number=50><span class=co>#&gt; [[7]]</span></a>
<a class=sourceLine id=cb12-51 data-line-number=51><span class=co>#&gt; [[7]][[1]]</span></a>
<a class=sourceLine id=cb12-52 data-line-number=52><span class=co>#&gt; [1] "net/l1/kernel/.OPTIMIZER_SLOT/optimizer/v/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-53 data-line-number=53><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-54 data-line-number=54><span class=co>#&gt; [[7]][[2]]</span></a>
<a class=sourceLine id=cb12-55 data-line-number=55><span class=co>#&gt; [1] 1 5</span></a>
<a class=sourceLine id=cb12-56 data-line-number=56><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-57 data-line-number=57><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-58 data-line-number=58><span class=co>#&gt; [[8]]</span></a>
<a class=sourceLine id=cb12-59 data-line-number=59><span class=co>#&gt; [[8]][[1]]</span></a>
<a class=sourceLine id=cb12-60 data-line-number=60><span class=co>#&gt; [1] "optimizer/beta_1/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-61 data-line-number=61><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-62 data-line-number=62><span class=co>#&gt; [[8]][[2]]</span></a>
<a class=sourceLine id=cb12-63 data-line-number=63><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-64 data-line-number=64><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-65 data-line-number=65><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-66 data-line-number=66><span class=co>#&gt; [[9]]</span></a>
<a class=sourceLine id=cb12-67 data-line-number=67><span class=co>#&gt; [[9]][[1]]</span></a>
<a class=sourceLine id=cb12-68 data-line-number=68><span class=co>#&gt; [1] "optimizer/beta_2/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-69 data-line-number=69><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-70 data-line-number=70><span class=co>#&gt; [[9]][[2]]</span></a>
<a class=sourceLine id=cb12-71 data-line-number=71><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-72 data-line-number=72><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-73 data-line-number=73><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-74 data-line-number=74><span class=co>#&gt; [[10]]</span></a>
<a class=sourceLine id=cb12-75 data-line-number=75><span class=co>#&gt; [[10]][[1]]</span></a>
<a class=sourceLine id=cb12-76 data-line-number=76><span class=co>#&gt; [1] "optimizer/decay/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-77 data-line-number=77><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-78 data-line-number=78><span class=co>#&gt; [[10]][[2]]</span></a>
<a class=sourceLine id=cb12-79 data-line-number=79><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-80 data-line-number=80><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-81 data-line-number=81><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-82 data-line-number=82><span class=co>#&gt; [[11]]</span></a>
<a class=sourceLine id=cb12-83 data-line-number=83><span class=co>#&gt; [[11]][[1]]</span></a>
<a class=sourceLine id=cb12-84 data-line-number=84><span class=co>#&gt; [1] "optimizer/iter/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-85 data-line-number=85><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-86 data-line-number=86><span class=co>#&gt; [[11]][[2]]</span></a>
<a class=sourceLine id=cb12-87 data-line-number=87><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-88 data-line-number=88><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-89 data-line-number=89><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-90 data-line-number=90><span class=co>#&gt; [[12]]</span></a>
<a class=sourceLine id=cb12-91 data-line-number=91><span class=co>#&gt; [[12]][[1]]</span></a>
<a class=sourceLine id=cb12-92 data-line-number=92><span class=co>#&gt; [1] "optimizer/learning_rate/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-93 data-line-number=93><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-94 data-line-number=94><span class=co>#&gt; [[12]][[2]]</span></a>
<a class=sourceLine id=cb12-95 data-line-number=95><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-96 data-line-number=96><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-97 data-line-number=97><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-98 data-line-number=98><span class=co>#&gt; [[13]]</span></a>
<a class=sourceLine id=cb12-99 data-line-number=99><span class=co>#&gt; [[13]][[1]]</span></a>
<a class=sourceLine id=cb12-100 data-line-number=100><span class=co>#&gt; [1] "save_counter/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-101 data-line-number=101><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-102 data-line-number=102><span class=co>#&gt; [[13]][[2]]</span></a>
<a class=sourceLine id=cb12-103 data-line-number=103><span class=co>#&gt; list()</span></a>
<a class=sourceLine id=cb12-104 data-line-number=104><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-105 data-line-number=105><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-106 data-line-number=106><span class=co>#&gt; [[14]]</span></a>
<a class=sourceLine id=cb12-107 data-line-number=107><span class=co>#&gt; [[14]][[1]]</span></a>
<a class=sourceLine id=cb12-108 data-line-number=108><span class=co>#&gt; [1] "step/.ATTRIBUTES/VARIABLE_VALUE"</span></a>
<a class=sourceLine id=cb12-109 data-line-number=109><span class=co>#&gt; </span></a>
<a class=sourceLine id=cb12-110 data-line-number=110><span class=co>#&gt; [[14]][[2]]</span></a>
<a class=sourceLine id=cb12-111 data-line-number=111><span class=co>#&gt; list()</span></a></code></pre></div></div><div id=list-and-dictionary-tracking class="section level4"><h4>List and dictionary tracking</h4><p>As with direct attribute assignments like <code>self$l1 &lt;- layer_dense(units = size)</code>, assigning lists and dictionaries to attributes will track their contents.</p><div class=sourceCode id=cb13><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb13-1 data-line-number=1>save &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>()</a>
<a class=sourceLine id=cb13-2 data-line-number=2>save<span class=op>$</span>listed &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(tf<span class=op>$</span><span class=kw>Variable</span>(<span class=dv>1</span>))</a>
<a class=sourceLine id=cb13-3 data-line-number=3>save<span class=op>$</span>listed<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/append.html>append</a></span>(tf<span class=op>$</span><span class=kw>Variable</span>(<span class=dv>2</span>))</a>
<a class=sourceLine id=cb13-4 data-line-number=4>save<span class=op>$</span>mapped &lt;-<span class=st> </span><span class=kw><a href=../../tensorflow/reference/reexports.html>dict</a></span>(<span class=dt>one =</span> save<span class=op>$</span>listed[<span class=dv>0</span>])</a>
<a class=sourceLine id=cb13-5 data-line-number=5>reticulate<span class=op>::</span><span class=kw><a href=https://rdrr.io/pkg/reticulate/man/py_set_item.html>py_set_item</a></span>(save<span class=op>$</span>mapped, <span class=st>"two"</span>, save<span class=op>$</span>listed[<span class=dv>1</span>])</a>
<a class=sourceLine id=cb13-6 data-line-number=6><span class=co>#save$mapped['two'] &lt;- save$listed[1]</span></a>
<a class=sourceLine id=cb13-7 data-line-number=7>save_path &lt;-<span class=st> </span>save<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/save.html>save</a></span>(<span class=st>'./tf_list_example'</span>)</a>
<a class=sourceLine id=cb13-8 data-line-number=8></a>
<a class=sourceLine id=cb13-9 data-line-number=9>restore &lt;-<span class=st> </span>tf<span class=op>$</span>train<span class=op>$</span><span class=kw>Checkpoint</span>()</a>
<a class=sourceLine id=cb13-10 data-line-number=10>v2 &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>Variable</span>(<span class=dv>0</span>)</a>
<a class=sourceLine id=cb13-11 data-line-number=11><span class=dv>0</span> <span class=op>==</span><span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(v2)  <span class=co># Not restored yet</span></a>
<a class=sourceLine id=cb13-12 data-line-number=12><span class=co>#&gt; [1] TRUE</span></a>
<a class=sourceLine id=cb13-13 data-line-number=13>restore<span class=op>$</span>mapped &lt;-<span class=st> </span><span class=kw><a href=../../tensorflow/reference/reexports.html>dict</a></span>(<span class=dt>two =</span> v2)</a>
<a class=sourceLine id=cb13-14 data-line-number=14>restore<span class=op>$</span><span class=kw>restore</span>(save_path)</a>
<a class=sourceLine id=cb13-15 data-line-number=15><span class=co>#&gt; &lt;tensorflow.python.training.tracking.util.CheckpointLoadStatus&gt;</span></a>
<a class=sourceLine id=cb13-16 data-line-number=16><span class=dv>2</span> <span class=op>==</span><span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(v2)</a>
<a class=sourceLine id=cb13-17 data-line-number=17><span class=co>#&gt; [1] TRUE</span></a></code></pre></div><p>You may notice wrapper objects for lists and dictionaries. These wrappers are checkpointable versions of the underlying data-structures. Just like the attribute based loading, these wrappers restore a variable’s value as soon as it’s added to the container.</p><div class=sourceCode id=cb14><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb14-1 data-line-number=1>restore<span class=op>$</span>listed &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>()</a>
<a class=sourceLine id=cb14-2 data-line-number=2><span class=kw><a href=https://rdrr.io/r/base/print.html>print</a></span>(restore<span class=op>$</span>listed)  <span class=co># ListWrapper([])</span></a>
<a class=sourceLine id=cb14-3 data-line-number=3><span class=co>#&gt; ListWrapper([])</span></a>
<a class=sourceLine id=cb14-4 data-line-number=4>v1 &lt;-<span class=st> </span>tf<span class=op>$</span><span class=kw>Variable</span>(<span class=fl>0.</span>)</a>
<a class=sourceLine id=cb14-5 data-line-number=5>restore<span class=op>$</span>listed<span class=op>$</span><span class=kw><a href=https://rdrr.io/r/base/append.html>append</a></span>(v1)  <span class=co># Restores v1, from restore() in the previous cell</span></a>
<a class=sourceLine id=cb14-6 data-line-number=6><span class=fl>1.</span> <span class=op>==</span><span class=st> </span><span class=kw><a href=https://rdrr.io/r/base/numeric.html>as.numeric</a></span>(v1)</a>
<a class=sourceLine id=cb14-7 data-line-number=7><span class=co>#&gt; [1] TRUE</span></a></code></pre></div><p>The same tracking is automatically applied to subclasses of tf.keras.Model, and may be used for example to track lists of layers.</p></div></div></div></div></div></div><footer>Copyright © 2015-2020 The TensorFlow Authors and RStudio, PBC.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>