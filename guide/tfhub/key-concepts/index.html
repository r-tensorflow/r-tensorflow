<!doctype html><html><head><script>theBaseUrl=location.origin+"/";</script><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><title>Key concepts</title><meta name=generator content="Hugo 0.58.3"><meta name=description content="Documentation for the TensorFlow for R interface"><link rel=canonical href=/guide/tfhub/key-concepts/><meta name=author content="J.J. Allaire"><meta property=og:url content=/guide/tfhub/key-concepts/><meta property=og:title content="TensorFlow for R"><meta name=apple-mobile-web-app-title content="TensorFlow for R"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><style>@font-face{font-family:icon;src:url(fonts/icon.eot?52m981);src:url(fonts/icon.eot?#iefix52m981) format('embedded-opentype'),url(fonts/icon.woff?52m981) format('woff'),url(fonts/icon.ttf?52m981) format('truetype'),url(fonts/icon.svg?52m981#icon) format('svg');font-weight:400;font-style:normal}</style><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/site-styles.css><script src=/js/vendor.js></script><script src=/js/app.js></script><link rel="shortcut icon" href=/images/favicon.png><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=single-page><nav data-gumshoe-header aria-label=Header id=header class=top-menu><div class=left><a href=/ data-parenturl class="top-menu-item site-title">TensorFlow for R</a>
<span class=logo-from>from</span>
<a href=/><div id=logo class=logo></div></a></div><div class=right><div class=top-menu-items id=top-menu-items><a href=/ data-parenturl=/ class=top-menu-item>Home</a>
<a href=/installation/ data-parenturl=/installation/ class=top-menu-item>Installation</a>
<a href=/tutorials/ data-parenturl=/tutorials/ class=top-menu-item>Tutorials</a>
<a href=/guide/ data-parenturl=/guide/ class=top-menu-item>Guide</a>
<a href=/deploy/ data-parenturl=/deploy/ class=top-menu-item>Deploy</a>
<a href=/tools/ data-parenturl=/tools/ class=top-menu-item>Tools</a>
<a href=/reference/keras data-parenturl=/reference/keras class=top-menu-item>API</a>
<a href=/learn/resources/ data-parenturl=/learn/resources/ class=top-menu-item>Learn</a>
<a href=/blog.html data-parenturl=/blog.html class=top-menu-item>Blog</a></div><a href=https://github.com/rstudio/tfhub class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a></div></nav><nav aria-label=Header id=mobile-header><a href=/>TensorFlow for R</a><div class=right><a href=https://github.com/rstudio/tfhub class=github-logo><i class="fa fa-lg fa-github" aria-hidden=true></i></a><div class=hamburger><i class="fa fa-lg fa-bars" aria-hidden=true></i></div></div></nav><div id=mobile-menu-container><ul id=mobile-menu><li><a href=/>Home</a></li><ul></ul><li><a href=/installation/>Installation</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Installing TensorFlow</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/>Quick start</a></li><li><a href=/installation/custom/>Custom Installation</a></li></ul><li><a href=/installation/gpu>Using a GPU</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/installation/gpu/>Overview</a></li><li><a href=/installation/gpu/local_gpu/>Local GPU</a></li><li><a href=/installation/gpu/cloud_server_gpu/>Cloud Server</a></li><li><a href=/installation/gpu/cloud_desktop_gpu/>Cloud Desktop</a></li></ul></ul><li><a href=/tutorials/>Tutorials</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/>Overview</a></li><li><a href>Beginners</a></li><li><a href=/tutorials/beginners/>Quickstart</a></li><li><a href=/tutorials/beginners/basic-ml/>Basic ML with Keras</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/basic-ml/>Overview</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_classification/>Image Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_regression/>Regression</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification/>Text Classification</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_basic_text_classification_with_tfhub/>Transfer learning with tfhub</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_overfit_underfit/>Overfitting and Underfitting</a></li><li><a href=/tutorials/beginners/basic-ml/tutorial_save_and_restore/>Save and Restore Models</a></li></ul><li><a href=/tutorials/beginners/load/load_csv/>Load and preprocess data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/beginners/load/load_csv/>Load CSV data</a></li><li><a href=/tutorials/beginners/load/load_image/>Load image data</a></li></ul><li><a href>Advanced</a></li><li><a href=/tutorials/advanced/>Quickstart</a></li><li><a href=/tutorials/advanced/customization/tensors-operations/>Customization</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/customization/tensors-operations/>Tensors and operations</a></li><li><a href=/tutorials/advanced/customization/custom-layers/>Custom layers</a></li><li><a href=/tutorials/advanced/customization/autodiff/>Automatic differentiation</a></li><li><a href=/tutorials/advanced/customization/custom-training/>Custom training</a></li></ul><li><a href=/tutorials/advanced/images/cnn/>Images</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/images/cnn/>Convolutional Neural Network</a></li><li><a href=/tutorials/advanced/images/transfer-learning-hub/>Transfer Learning with tfhub</a></li></ul><li><a href=/tutorials/advanced/structured/classify/>Structured data</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/structured/classify/>Classify structured data</a></li></ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tutorials/advanced/distributed/distributed_training_with_keras/>Distributed training with Keras</a></li></ul></ul><li><a href=/guide/>Guide</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/>Overview</a></li><li><a href>Keras</a></li><li><a href=/guide/keras/>Getting started</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/>Overview</a></li><li><a href=/guide/keras/guide_keras/>Keras basics</a></li><li><a href=/guide/keras/sequential_model/>Sequential API</a></li><li><a href=/guide/keras/functional_api/>Functional API</a></li><li><a href=/guide/keras/saving_serializing/>Saving and serializing models</a></li><li><a href=/guide/keras/faq/>Frequently Asked Questions</a></li></ul><li><a href=/guide/keras/custom_layers/>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/keras/custom_layers/>Custom Layers</a></li><li><a href=/guide/keras/custom_models/>Custom Models</a></li><li><a href=/guide/keras/training_callbacks/>Training Callbacks</a></li><li><a href=/guide/keras/applications/>Pre-Trained Models</a></li><li><a href=/guide/keras/training_visualization/>Training Visualization</a></li></ul><li><a href=/guide/keras/examples/>Examples</a></li><li><a href>TensorFlow Mechanics</a></li><li><a href=/guide/tensorflow/eager_execution>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/eager_execution/>Eager execution</a></li><li><a href=/guide/tensorflow/variable/>Variables</a></li><li><a href=/guide/tensorflow/tensors/>Tensors</a></li></ul><li><a href=/guide/tensorflow/ragged_tensors>Advanced</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tensorflow/ragged_tensors/>Ragged tensors</a></li></ul><li><a href>Data input pipeline</a></li><li><a href=/guide/tfdatasets/introduction>Overview</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/introduction/>Using Datasets</a></li></ul><li><a href=/guide/tfdatasets/feature_spec>Feature spec API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfdatasets/feature_spec/>Feature Spec interface</a></li><li><a href=/guide/tfdatasets/feature_columns/>Feature columns</a></li></ul><li><a href>TensorFlow Hub</a></li><li><a href=/guide/tfhub/intro>Basics</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/intro/>Overview</a></li><li><a href=/guide/tfhub/hub-with-keras/>Using with Keras</a></li></ul><li><a href=/guide/tfhub/key-concepts>Key concepts</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul><li><a href>Model saving</a></li><li><a href=/guide/saving/checkpoints>Checkpoints</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/checkpoints/>Checkpoints</a></li></ul><li><a href=/guide/saving/saved_model>Saved Model</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/guide/saving/saved_model/>Saved Model</a></li></ul></ul><li><a href=/deploy/>Deploy</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/deploy/>Overview</a></li><li><a href=/deploy/plumber/>Plumber</a></li><li><a href=/deploy/shiny/>Shiny</a></li><li><a href=/deploy/docker/>TensorFlow Serving</a></li><li><a href=/deploy/rsconnect/>RStudio Connect</a></li></ul><li><a href=/tools/>Tools</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/>Overview</a></li><li><a href=/tools/tfruns/>Training Runs</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/tools/tfruns/overview/>Introduction to tfruns</a></li><li><a href=/tools/tfruns/tuning/>Hyperparameter Tuning</a></li><li><a href=/tools/tfruns/managing/>Managing Training Runs</a></li></ul><li><a href=/tools/tensorboard/tensorboard/>TensorBoard</a></li></ul><li><a href=/reference/keras>API</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/reference/keras/>keras</a></li><li><a href=/reference/tensorflow/>tensorflow</a></li><li><a href=/reference/tfdatasets/>tfdatasets</a></li><li><a href=/reference/tfruns/>tfruns</a></li></ul><li><a href=/learn/resources/>Learn</a>
<i class="fa fa-chevron-right" aria-hidden=true></i></li><ul><li><a href=/learn/resources/>Resources</a></li></ul><li><a href=/blog.html>Blog</a></li><ul></ul></ul></div><div id=search-bar class=search-bar><p class=search-bar__icon><i class="fa fa-lg fa-search"></i></p><div class=search-bar__input><input type=text name=search class=st-default-search-input></div><div class=search-bar__exit><i class="fa fa-lg fa-times"></i></div><div class=inline-search-results><ul></ul></div></div></div><div class="page documentation"><div class=side-menu id=side-menu><ul class=side-menu-list data-parenturl=/ style=display:none></ul><ul class=side-menu-list data-parenturl=/installation/ style=display:none><li class=side-menu__item><a href=/installation/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Installing TensorFlow</p></a></li><li class=side-menu__item><a href=/installation/gpu class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Using a GPU</p></a></li></ul><ul class=side-menu-list data-parenturl=/tutorials/ style=display:none><li class=side-menu__item><a href=/tutorials/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Beginners</p></span></li><li class=side-menu__item><a href=/tutorials/beginners/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/basic-ml/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basic ML with Keras</p></a></li><li class=side-menu__item><a href=/tutorials/beginners/load/load_csv/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Load and preprocess data</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Advanced</p></span></li><li class=side-menu__item><a href=/tutorials/advanced/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Quickstart</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/customization/tensors-operations/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Customization</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/images/cnn/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Images</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/structured/classify/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Structured data</p></a></li><li class=side-menu__item><a href=/tutorials/advanced/distributed/distributed_training_with_keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Distributed training</p></a></li></ul><ul class=side-menu-list data-parenturl=/guide/ style=display:none><li class=side-menu__item><a href=/guide/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Keras</p></span></li><li class=side-menu__item><a href=/guide/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Getting started</p></a></li><li class=side-menu__item><a href=/guide/keras/custom_layers/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><a href=/guide/keras/examples/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Examples</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Mechanics</p></span></li><li class=side-menu__item><a href=/guide/tensorflow/eager_execution class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class=side-menu__item><a href=/guide/tensorflow/ragged_tensors class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Advanced</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Data input pipeline</p></span></li><li class=side-menu__item><a href=/guide/tfdatasets/introduction class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/guide/tfdatasets/feature_spec class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Feature spec API</p></a></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">TensorFlow Hub</p></span></li><li class=side-menu__item><a href=/guide/tfhub/intro class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Basics</p></a></li><li class="side-menu__item active"><a href=/guide/tfhub/key-concepts class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Key concepts</p></a><ul class=side-menu__sub><span style=display:none>guide</span><li class="side-menu__sub__item active"><a id=menu-link-/guide/tfhub/key-concepts/ class=side-menu__sub__item__text href=/guide/tfhub/key-concepts/ data-url=/guide/tfhub/key-concepts/>Key Concepts</a></li></ul></li><li class=side-menu__item><span class=side-menu__item__link><p class="side-menu__item__link__text side-menu__item__link__text__block">Model saving</p></span></li><li class=side-menu__item><a href=/guide/saving/checkpoints class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Checkpoints</p></a></li><li class=side-menu__item><a href=/guide/saving/saved_model class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Saved Model</p></a></li></ul><ul class=side-menu-list data-parenturl=/deploy/ style=display:none><li class=side-menu__item><a href=/deploy/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/deploy/plumber/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Plumber</p></a></li><li class=side-menu__item><a href=/deploy/shiny/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Shiny</p></a></li><li class=side-menu__item><a href=/deploy/docker/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorFlow Serving</p></a></li><li class=side-menu__item><a href=/deploy/rsconnect/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>RStudio Connect</p></a></li></ul><ul class=side-menu-list data-parenturl=/tools/ style=display:none><li class=side-menu__item><a href=/tools/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Overview</p></a></li><li class=side-menu__item><a href=/tools/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Training Runs</p></a></li><li class=side-menu__item><a href=/tools/tensorboard/tensorboard/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>TensorBoard</p></a></li></ul><ul class=side-menu-list data-parenturl=/reference/keras style=display:none><li class=side-menu__item><a href=/reference/keras/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>keras</p></a></li><li class=side-menu__item><a href=/reference/tensorflow/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tensorflow</p></a></li><li class=side-menu__item><a href=/reference/tfdatasets/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfdatasets</p></a></li><li class=side-menu__item><a href=/reference/tfruns/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>tfruns</p></a></li></ul><ul class=side-menu-list data-parenturl=/learn/resources/ style=display:none><li class=side-menu__item><a href=/learn/resources/ class=side-menu__item__link><img class=side-menu__item__link__icon src=/images/icons/block-retina.png alt><p class=side-menu__item__link__text>Resources</p></a></li></ul><ul class=side-menu-list data-parenturl=/blog.html style=display:none></ul></div><div class=content><h1 class=content-header>Key concepts</h1><div class=markdowned><div class=doc-page><div class=doc-page-index><ul id=gumshoe-container data-gumshoe></ul></div><div class=doc-page-body><div id=using-a-module class="section level2"><h2>Using a Module</h2><div id=instantiating-a-module class="section level3"><h3>Instantiating a Module</h3><p>A TensorFlow Hub module is imported into a TensorFlow program by creating a Module object from a string with its URL or filesystem path, such as:</p><div class=sourceCode id=cb1><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb1-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(tfhub)</a>
<a class=sourceLine id=cb1-2 data-line-number=2>m &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/pkg/tfhub/man/hub_load.html>hub_load</a></span>(<span class=st>"path/to/a/module_dir"</span>)</a></code></pre></div><p>This adds the module’s variables to the current TensorFlow graph.</p></div><div id=caching-modules class="section level3"><h3>Caching Modules</h3><p>When creating a module from a URL, the module content is downloaded and cached in the local system temporary directory. The location where modules are cached can be overridden using TFHUB_CACHE_DIR environment variable.</p><p>For example, setting <code>TFHUB_CACHE_DIR</code> to <code>/my_module_cache</code>:</p><div class=sourceCode id=cb2><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb2-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/Sys.setenv.html>Sys.setenv</a></span>(<span class=dt>TFHUB_CACHE_DIR =</span> <span class=st>"/my_module_cache"</span>)</a></code></pre></div><p>and then creating a module from a URL:</p><div class=sourceCode id=cb3><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb3-1 data-line-number=1>m &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/pkg/tfhub/man/hub_load.html>hub_load</a></span>(<span class=st>"https://tfhub.dev/google/progan-128/1"</span>)</a></code></pre></div><p>results in downloading and unpacking the module into <code>/my_module_cache</code>.</p></div><div id=applying-a-module class="section level3"><h3>Applying a Module</h3><p>Once instantiated, a module m can be called zero or more times like a Python function from tensor inputs to tensor outputs:</p><div class=sourceCode id=cb4><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb4-1 data-line-number=1>y &lt;-<span class=st> </span><span class=kw>m</span>(x)</a></code></pre></div><p>Each such call adds operations to the current TensorFlow graph to compute <code>y</code> from <code>x</code>. If this involves variables with trained weights, these are shared between all applications.</p><p>Modules can define multiple named signatures in order to allow being applied in more than one way (similar to how Python objects have methods). A module’s documentation should describe the available signatures. The call above applies the signature named “default”. Any signature can be selected by passing its name to the optional <code>signature=</code> argument.</p><p>If a signature has multiple inputs, they must be passed as a dict, with the keys defined by the signature. Likewise, if a signature has multiple outputs, these can be retrieved as a dict by passing as_dict=True, under the keys defined by the signature. (The key <code>"default"</code> is for the single output returned if <code>as_dict=FALSE</code>) So the most general form of applying a Module looks like:</p><div class=sourceCode id=cb5><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb5-1 data-line-number=1>outputs &lt;-<span class=st> </span><span class=kw>m</span>(<span class=kw><a href=https://rdrr.io/r/base/list.html>list</a></span>(<span class=dt>apples=</span>x1, <span class=dt>oranges=</span>x2), <span class=dt>signature=</span><span class=st>"fruit_to_pet"</span>, <span class=dt>as_dict=</span><span class=ot>TRUE</span>)</a>
<a class=sourceLine id=cb5-2 data-line-number=2>y1 =<span class=st> </span>outputs<span class=op>$</span>cats</a>
<a class=sourceLine id=cb5-3 data-line-number=3>y2 =<span class=st> </span>outputs<span class=op>$</span>dogs</a></code></pre></div><p>A caller must supply all inputs defined by a signature, but there is no requirement to use all of a module’s outputs. Module consumers should handle additional outputs gracefully.</p></div></div><div id=creating-a-new-module class="section level2"><h2>Creating a new Module</h2><div id=general-approach class="section level3"><h3>General approach</h3><p>A Hub Module is simply a TensorFlow graph in the SavedModel format. In order
to create a Module you can run the <code>export_savedmodel</code> function with any
TensorFlow object.</p><p>For example:</p><div class=sourceCode id=cb6><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb6-1 data-line-number=1><span class=kw><a href=https://rdrr.io/r/base/library.html>library</a></span>(keras)</a>
<a class=sourceLine id=cb6-2 data-line-number=2></a>
<a class=sourceLine id=cb6-3 data-line-number=3>mnist &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/dataset_mnist.html>dataset_mnist</a></span>()</a>
<a class=sourceLine id=cb6-4 data-line-number=4></a>
<a class=sourceLine id=cb6-5 data-line-number=5>input &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/layer_input.html>layer_input</a></span>(<span class=kw><a href=../../keras/reference/reexports.html>shape</a></span>(<span class=dv>28</span>,<span class=dv>28</span>), <span class=dt>dtype =</span> <span class=st>"int32"</span>)</a>
<a class=sourceLine id=cb6-6 data-line-number=6></a>
<a class=sourceLine id=cb6-7 data-line-number=7>output &lt;-<span class=st> </span>input <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb6-8 data-line-number=8><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_flatten.html>layer_flatten</a></span>() <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb6-9 data-line-number=9><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_lambda.html>layer_lambda</a></span>(tensorflow<span class=op>::</span><span class=kw><a href=../../tensorflow/reference/tf_function.html>tf_function</a></span>(<span class=cf>function</span>(x) tf<span class=op>$</span><span class=kw>cast</span>(x, tf<span class=op>$</span>float32)<span class=op>/</span><span class=dv>255</span>)) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb6-10 data-line-number=10><span class=st>  </span><span class=kw><a href=../../keras/reference/layer_dense.html>layer_dense</a></span>(<span class=dt>units =</span> <span class=dv>10</span>, <span class=dt>activation =</span> <span class=st>"softmax"</span>)</a>
<a class=sourceLine id=cb6-11 data-line-number=11></a>
<a class=sourceLine id=cb6-12 data-line-number=12>model &lt;-<span class=st> </span><span class=kw><a href=../../keras/reference/keras_model.html>keras_model</a></span>(input, output)</a>
<a class=sourceLine id=cb6-13 data-line-number=13></a>
<a class=sourceLine id=cb6-14 data-line-number=14>model <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb6-15 data-line-number=15><span class=st>  </span><span class=kw><a href=../../keras/reference/reexports.html>compile</a></span>(</a>
<a class=sourceLine id=cb6-16 data-line-number=16>    <span class=dt>loss =</span> <span class=st>"sparse_categorical_crossentropy"</span>,</a>
<a class=sourceLine id=cb6-17 data-line-number=17>    <span class=dt>optimizer =</span> <span class=st>"adam"</span>,</a>
<a class=sourceLine id=cb6-18 data-line-number=18>    <span class=dt>metrics =</span> <span class=st>"acc"</span></a>
<a class=sourceLine id=cb6-19 data-line-number=19>  )</a>
<a class=sourceLine id=cb6-20 data-line-number=20></a>
<a class=sourceLine id=cb6-21 data-line-number=21>model <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb6-22 data-line-number=22><span class=st>  </span><span class=kw><a href=../../keras/reference/reexports.html>fit</a></span>(<span class=dt>x =</span> mnist<span class=op>$</span>train<span class=op>$</span>x, <span class=dt>y =</span> mnist<span class=op>$</span>train<span class=op>$</span>y, <span class=dt>validation_split =</span> <span class=fl>0.2</span>, <span class=dt>epochs =</span><span class=dv>1</span> )</a>
<a class=sourceLine id=cb6-23 data-line-number=23></a>
<a class=sourceLine id=cb6-24 data-line-number=24><span class=kw><a href=../../keras/reference/save_model_tf.html>save_model_tf</a></span>(model, <span class=st>"my_module/"</span>, <span class=dt>include_optimizer =</span> <span class=ot>FALSE</span>)</a></code></pre></div><p>After exporting the model to the SavedModel format you can load it using <code>hub_load</code>,
and use it for predictions for example:</p><div class=sourceCode id=cb7><pre class="sourceCode r"><code class="sourceCode r"><a class=sourceLine id=cb7-1 data-line-number=1>module &lt;-<span class=st> </span><span class=kw><a href=https://rdrr.io/pkg/tfhub/man/hub_load.html>hub_load</a></span>(<span class=st>"my_module/"</span>)</a>
<a class=sourceLine id=cb7-2 data-line-number=2></a>
<a class=sourceLine id=cb7-3 data-line-number=3>predictions &lt;-<span class=st> </span><span class=kw>module</span>(mnist<span class=op>$</span>test<span class=op>$</span>x) <span class=op>%&gt;%</span><span class=st> </span></a>
<a class=sourceLine id=cb7-4 data-line-number=4><span class=st>  </span>tf<span class=op>$</span><span class=kw>argmax</span>(<span class=dt>axis =</span> 1L) </a>
<a class=sourceLine id=cb7-5 data-line-number=5></a>
<a class=sourceLine id=cb7-6 data-line-number=6><span class=kw><a href=https://rdrr.io/r/base/mean.html>mean</a></span>(<span class=kw><a href=https://rdrr.io/r/base/integer.html>as.integer</a></span>(predictions) <span class=op>==</span><span class=st> </span>mnist<span class=op>$</span>test<span class=op>$</span>y)</a></code></pre></div><p>Exporting a module serializes its definition together with the current state of
its variables in session into the passed path. This can be used when exporting a
module for the first time, as well as when exporting a fine tuned module.</p><p>Module publishers should implement a <a href=https://www.tensorflow.org/hub/common_signatures/index>common signature</a> when possible, so that consumers can easily exchange modules and find the best one for their problem.</p></div></div><div id=fine-tuning class="section level2"><h2>Fine-Tuning</h2><p>Training the variables of an imported module together with those of the model around it is called fine-tuning. Fine-tuning can result in better quality, but adds new complications. We advise consumers to look into fine-tuning only after exploring simpler quality tweaks.</p><div id=for-consumers class="section level3"><h3>For consumers</h3><p>To enable fine-tuning, instantiate the module with <code>hub_module(..., trainable = TRUE)</code> to make its variables trainable and import TensorFlow’s <code>REGULARIZATION_LOSSES</code>. If the module has multiple graph variants, make sure to pick the one appropriate for training. Usually, that’s the one
with tags <code>{"train"}</code>.</p><p>Choose a training regime that does not ruin the pre-trained weights, for example,
a lower learning rate than for training from scratch.</p></div><div id=for-publishers class="section level3"><h3>For publishers</h3><p>To make fine-tuning easier for consumers, please be mindful of the following:</p><ul><li><p>Fine-tuning needs regularization. Your module is exported with the <code>REGULARIZATION_LOSSES</code> collection, which is what puts your choice of <code><a href=../../keras/reference/layer_dense.html>layer_dense(..., kernel_regularizer=...)</a></code> etc. into what the consumer gets from <code>tf$losses$get_regularization_losses()</code>. Prefer this way of defining L1/L2 regularization losses.</p></li><li><p>In the publisher model, avoid defining L1/L2 regularization via the <code>l1_</code> and <code>l2_regularization_strength</code> parameters of <code>tf$train$FtrlOptimizer</code>, <code>tf$train$ProximalGradientDescentOptimizer</code>, and other proximal optimizers. These are not exported alongside the module, and setting regularization strengths globally may not be appropriate for the consumer. Except for L1 regularization in wide (i.e. sparse linear) or wide &amp; deep models, it should be possible to use individual regularization losses instead.</p></li><li><p>If you use dropout, batch normalization, or similar training techniques, set dropout rate and other hyperparameters to values that make sense across many expected uses.</p></li></ul></div></div><div id=hosting-a-module class="section level2"><h2>Hosting a Module</h2><p>TensorFlow Hub supports HTTP based distribution of modules. In particular the protocol allows to use the URL identifying the module both as the documentation of the module and the endpoint to fetch the module.</p><div id=protocol class="section level3"><h3>Protocol</h3><p>When a URL such as <code>https://example.com/module</code> is used to identify a module to load or instantiate, the module resolver will attempt to download a compressed tar ball from the URL after appending a query parameter <code>?tf-hub-format=compressed</code>.</p><p>The query param is to be interpreted as a comma separated list of the module formats that the client is interested in. For now only the <code>"compressed"</code> format is defined.</p><p>The compressed format indicates that the client expects a <code>tar.gz</code> archive with the module contents. The root of the archive is the root of the module directory and should contain a module e.g.:</p><pre><code># Create a compressed module from an exported module directory.
$ tar -cz -f module.tar.gz --owner=0 --group=0 -C /tmp/export-module/ .

# Inspect files inside a compressed module
$ tar -tf module.tar.gz
./
./tfhub_module.pb
./variables/
./variables/variables.data-00000-of-00001
./variables/variables.index
./assets/
./saved_model.pb</code></pre></div></div></div></div></div><footer>Copyright © 2015-2019 The TensorFlow Authors and RStudio, Inc.
<script type=text/javascript>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');_st('install','Ne8tbLfE121Pkj3xMr_G','2.0.0');</script></footer></div></div></body></html>